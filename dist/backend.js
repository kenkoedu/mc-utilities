var Lu=Object.defineProperty;var Du=(e,t,r)=>t in e?Lu(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var tn=(e,t,r)=>Du(e,typeof t!="symbol"?t+"":t,r);var rn=(e,t)=>{const r=t!=null&&t.length?{}:null;if(r)for(const n of t)r[n.part.charCodeAt(0)]=n;return{part:e,store:null,inert:r,params:null,wildcardStore:null}},lc=(e,t)=>({...e,part:t}),mc=e=>({name:e,store:null,inert:null}),ur,pc=(ur=class{constructor(t={}){tn(this,"root",{});tn(this,"history",[]);tn(this,"deferred",[]);tn(this,"lazyFind",(t,r)=>this.config.lazy?(this.build(),this.find(t,r)):this.find);this.config=t,t.lazy&&(this.find=this.lazyFind)}build(){if(this.config.lazy){for(const[t,r,n]of this.deferred)this.add(t,r,n,{lazy:!1,ignoreHistory:!0});this.deferred=[],this.find=(t,r)=>{const n=this.root[t];return n?xi(r,r.length,n,0):null}}}add(t,r,n,{ignoreError:i=!1,ignoreHistory:o=!1,lazy:s=this.config.lazy}={}){if(s)return this.find=this.lazyFind,this.deferred.push([t,r,n]),n;if(typeof r!="string")throw new TypeError("Route path must be a string");r===""?r="/":r[0]!=="/"&&(r=`/${r}`);const c=r[r.length-1]==="*",u=r.match(ur.regex.optionalParams);if(u){const l=r.replaceAll("?","");this.add(t,l,n,{ignoreError:i,ignoreHistory:o,lazy:s});for(let h=0;h<u.length;h++){let a=r.replace("/"+u[h],"");this.add(t,a,n,{ignoreError:!0,ignoreHistory:o,lazy:s})}return n}if(u&&(r=r.replaceAll("?","")),this.history.find(([l,h,a])=>l===t&&h===r))return n;(c||u&&r.charCodeAt(r.length-1)===63)&&(r=r.slice(0,-1)),o||this.history.push([t,r,n]);const f=r.split(ur.regex.static),p=r.match(ur.regex.params)||[];f[f.length-1]===""&&f.pop();let m;this.root[t]?m=this.root[t]:m=this.root[t]=rn("/");let g=0;for(let l=0;l<f.length;++l){let h=f[l];if(l>0){const a=p[g++].slice(1);if(m.params===null)m.params=mc(a);else if(m.params.name!==a){if(i)return n;throw new Error(`Cannot create route "${r}" with parameter "${a}" because a route already exists with a different parameter name ("${m.params.name}") in the same location`)}const x=m.params;if(x.inert===null){m=x.inert=rn(h);continue}m=x.inert}for(let a=0;;){if(a===h.length){if(a<m.part.length){const x=lc(m,m.part.slice(a));Object.assign(m,rn(h,[x]))}break}if(a===m.part.length){m.inert===null&&(m.inert={});const x=m.inert[h.charCodeAt(a)];if(x){m=x,h=h.slice(a),a=0;continue}const P=rn(h.slice(a));m.inert[h.charCodeAt(a)]=P,m=P;break}if(h[a]!==m.part[a]){const x=lc(m,m.part.slice(a)),P=rn(h.slice(a));Object.assign(m,rn(m.part.slice(0,a),[x,P])),m=P;break}++a}}if(g<p.length){const h=p[g].slice(1);if(m.params===null)m.params=mc(h);else if(m.params.name!==h){if(i)return n;throw new Error(`Cannot create route "${r}" with parameter "${h}" because a route already exists with a different parameter name ("${m.params.name}") in the same location`)}return m.params.store===null&&(m.params.store=n),m.params.store}return c?(m.wildcardStore===null&&(m.wildcardStore=n),m.wildcardStore):(m.store===null&&(m.store=n),m.store)}find(t,r){const n=this.root[t];return n?xi(r,r.length,n,0):null}},tn(ur,"regex",{static:/:.+?(?=\/|$)/,params:/:.+?(?=\/|$)/g,optionalParams:/:.+?\?(?=\/|$)/g}),ur),xi=(e,t,r,n)=>{const i=r.part,o=i.length,s=n+o;if(o>1){if(s>t)return null;if(o<15){for(let c=1,u=n+1;c<o;++c,++u)if(i.charCodeAt(c)!==e.charCodeAt(u))return null}else if(e.slice(n,s)!==i)return null}if(s===t)return r.store!==null?{store:r.store,params:{}}:r.wildcardStore!==null?{store:r.wildcardStore,params:{"*":""}}:null;if(r.inert!==null){const c=r.inert[e.charCodeAt(s)];if(c!==void 0){const u=xi(e,t,c,s);if(u!==null)return u}}if(r.params!==null){const{store:c,name:u,inert:f}=r.params,p=e.indexOf("/",s);if(p!==s){if(p===-1||p>=t){if(c!==null){const m={};return m[u]=e.substring(s,t),{store:c,params:m}}}else if(f!==null){const m=xi(e,t,f,p);if(m!==null)return m.params[u]=e.substring(s,p),m}}}return r.wildcardStore!==null?{store:r.wildcardStore,params:{"*":e.substring(s,t)}}:null};function Bu(e){return je(e)&&!xt(e)&&!Gn(e)&&Symbol.asyncIterator in e}function xt(e){return Array.isArray(e)}function rf(e){return typeof e=="bigint"}function Jn(e){return typeof e=="boolean"}function Ao(e){return e instanceof globalThis.Date}function _u(e){return typeof e=="function"}function qu(e){return je(e)&&!xt(e)&&!Gn(e)&&Symbol.iterator in e}function Ku(e){return e===null}function er(e){return typeof e=="number"}function je(e){return typeof e=="object"&&e!==null}function nf(e){return e instanceof globalThis.RegExp}function Fe(e){return typeof e=="string"}function Hu(e){return typeof e=="symbol"}function Gn(e){return e instanceof globalThis.Uint8Array}function Ae(e){return e===void 0}function zu(e){return e.map(t=>wi(t))}function Ju(e){return new Date(e.getTime())}function Gu(e){return new Uint8Array(e)}function Wu(e){return new RegExp(e.source,e.flags)}function Yu(e){const t={};for(const r of Object.getOwnPropertyNames(e))t[r]=wi(e[r]);for(const r of Object.getOwnPropertySymbols(e))t[r]=wi(e[r]);return t}function wi(e){return xt(e)?zu(e):Ao(e)?Ju(e):Gn(e)?Gu(e):nf(e)?Wu(e):je(e)?Yu(e):e}function It(e){return wi(e)}function Po(e,t){return It(t===void 0?e:{...t,...e})}function of(e){return Ie(e)&&globalThis.Symbol.asyncIterator in e}function sf(e){return Ie(e)&&globalThis.Symbol.iterator in e}function cf(e){return e instanceof globalThis.Promise}function Wn(e){return e instanceof Date&&globalThis.Number.isFinite(e.getTime())}function Qu(e){return e instanceof globalThis.Map}function Zu(e){return e instanceof globalThis.Set}function Xu(e){return globalThis.ArrayBuffer.isView(e)}function So(e){return e instanceof globalThis.Uint8Array}function Q(e,t){return t in e}function Ie(e){return e!==null&&typeof e=="object"}function Ee(e){return globalThis.Array.isArray(e)&&!globalThis.ArrayBuffer.isView(e)}function Ut(e){return e===void 0}function Ni(e){return e===null}function Ti(e){return typeof e=="boolean"}function W(e){return typeof e=="number"}function ff(e){return globalThis.Number.isInteger(e)}function sr(e){return typeof e=="bigint"}function gt(e){return typeof e=="string"}function Mi(e){return typeof e=="function"}function Ui(e){return typeof e=="symbol"}function jo(e){return sr(e)||Ti(e)||Ni(e)||W(e)||gt(e)||Ui(e)||Ut(e)}var Pe;(function(e){e.InstanceMode="default",e.ExactOptionalPropertyTypes=!1,e.AllowArrayObject=!1,e.AllowNaN=!1,e.AllowNullVoid=!1;function t(s,c){return e.ExactOptionalPropertyTypes?c in s:s[c]!==void 0}e.IsExactOptionalProperty=t;function r(s){const c=Ie(s);return e.AllowArrayObject?c:c&&!Ee(s)}e.IsObjectLike=r;function n(s){return r(s)&&!(s instanceof Date)&&!(s instanceof Uint8Array)}e.IsRecordLike=n;function i(s){return e.AllowNaN?W(s):Number.isFinite(s)}e.IsNumberLike=i;function o(s){const c=Ut(s);return e.AllowNullVoid?c||s===null:c}e.IsVoidLike=o})(Pe||(Pe={}));function Vu(e){return globalThis.Object.freeze(e).map(t=>Ri(t))}function vu(e){const t={};for(const r of Object.getOwnPropertyNames(e))t[r]=Ri(e[r]);for(const r of Object.getOwnPropertySymbols(e))t[r]=Ri(e[r]);return globalThis.Object.freeze(t)}function Ri(e){return xt(e)?Vu(e):Ao(e)?e:Gn(e)?e:nf(e)?e:je(e)?vu(e):e}function A(e,t){const r=t!==void 0?{...t,...e}:e;switch(Pe.InstanceMode){case"freeze":return Ri(r);case"clone":return It(r);default:return r}}class ke extends Error{constructor(t){super(t)}}const rt=Symbol.for("TypeBox.Transform"),Yn=Symbol.for("TypeBox.Readonly"),mr=Symbol.for("TypeBox.Optional"),ki=Symbol.for("TypeBox.Hint"),R=Symbol.for("TypeBox.Kind");function Eo(e){return je(e)&&e[Yn]==="Readonly"}function Ir(e){return je(e)&&e[mr]==="Optional"}function uf(e){return v(e,"Any")}function af(e){return v(e,"Argument")}function pn(e){return v(e,"Array")}function Li(e){return v(e,"AsyncIterator")}function Di(e){return v(e,"BigInt")}function Qn(e){return v(e,"Boolean")}function yn(e){return v(e,"Computed")}function gn(e){return v(e,"Constructor")}function ea(e){return v(e,"Date")}function hn(e){return v(e,"Function")}function $n(e){return v(e,"Integer")}function kt(e){return v(e,"Intersect")}function Bi(e){return v(e,"Iterator")}function v(e,t){return je(e)&&R in e&&e[R]===t}function df(e){return Jn(e)||er(e)||Fe(e)}function zr(e){return v(e,"Literal")}function Jr(e){return v(e,"MappedKey")}function St(e){return v(e,"MappedResult")}function Zn(e){return v(e,"Never")}function ta(e){return v(e,"Not")}function Co(e){return v(e,"Null")}function bn(e){return v(e,"Number")}function Zt(e){return v(e,"Object")}function _i(e){return v(e,"Promise")}function qi(e){return v(e,"Record")}function ht(e){return v(e,"Ref")}function lf(e){return v(e,"RegExp")}function Xn(e){return v(e,"String")}function No(e){return v(e,"Symbol")}function Gr(e){return v(e,"TemplateLiteral")}function ra(e){return v(e,"This")}function pe(e){return je(e)&&rt in e}function Wr(e){return v(e,"Tuple")}function Vn(e){return v(e,"Undefined")}function Ke(e){return v(e,"Union")}function na(e){return v(e,"Uint8Array")}function ia(e){return v(e,"Unknown")}function oa(e){return v(e,"Unsafe")}function sa(e){return v(e,"Void")}function On(e){return je(e)&&R in e&&Fe(e[R])}function st(e){return uf(e)||af(e)||pn(e)||Qn(e)||Di(e)||Li(e)||yn(e)||gn(e)||ea(e)||hn(e)||$n(e)||kt(e)||Bi(e)||zr(e)||Jr(e)||St(e)||Zn(e)||ta(e)||Co(e)||bn(e)||Zt(e)||_i(e)||qi(e)||ht(e)||lf(e)||Xn(e)||No(e)||Gr(e)||ra(e)||Wr(e)||Vn(e)||Ke(e)||na(e)||ia(e)||oa(e)||sa(e)||On(e)}const ca=["Argument","Any","Array","AsyncIterator","BigInt","Boolean","Computed","Constructor","Date","Enum","Function","Integer","Intersect","Iterator","Literal","MappedKey","MappedResult","Not","Null","Number","Object","Promise","Record","Ref","RegExp","String","Symbol","TemplateLiteral","This","Tuple","Undefined","Union","Uint8Array","Unknown","Void"];function mf(e){try{return new RegExp(e),!0}catch{return!1}}function To(e){if(!Fe(e))return!1;for(let t=0;t<e.length;t++){const r=e.charCodeAt(t);if(r>=7&&r<=13||r===27||r===127)return!1}return!0}function pf(e){return Mo(e)||be(e)}function Pn(e){return Ae(e)||rf(e)}function de(e){return Ae(e)||er(e)}function Mo(e){return Ae(e)||Jn(e)}function fe(e){return Ae(e)||Fe(e)}function fa(e){return Ae(e)||Fe(e)&&To(e)&&mf(e)}function ua(e){return Ae(e)||Fe(e)&&To(e)}function yf(e){return Ae(e)||be(e)}function Ii(e){return je(e)&&e[mr]==="Optional"}function zt(e){return ee(e,"Any")&&fe(e.$id)}function aa(e){return ee(e,"Argument")&&er(e.index)}function Yr(e){return ee(e,"Array")&&e.type==="array"&&fe(e.$id)&&be(e.items)&&de(e.minItems)&&de(e.maxItems)&&Mo(e.uniqueItems)&&yf(e.contains)&&de(e.minContains)&&de(e.maxContains)}function Uo(e){return ee(e,"AsyncIterator")&&e.type==="AsyncIterator"&&fe(e.$id)&&be(e.items)}function Ki(e){return ee(e,"BigInt")&&e.type==="bigint"&&fe(e.$id)&&Pn(e.exclusiveMaximum)&&Pn(e.exclusiveMinimum)&&Pn(e.maximum)&&Pn(e.minimum)&&Pn(e.multipleOf)}function Qr(e){return ee(e,"Boolean")&&e.type==="boolean"&&fe(e.$id)}function da(e){return ee(e,"Computed")&&Fe(e.target)&&xt(e.parameters)&&e.parameters.every(t=>be(t))}function Hi(e){return ee(e,"Constructor")&&e.type==="Constructor"&&fe(e.$id)&&xt(e.parameters)&&e.parameters.every(t=>be(t))&&be(e.returns)}function zi(e){return ee(e,"Date")&&e.type==="Date"&&fe(e.$id)&&de(e.exclusiveMaximumTimestamp)&&de(e.exclusiveMinimumTimestamp)&&de(e.maximumTimestamp)&&de(e.minimumTimestamp)&&de(e.multipleOfTimestamp)}function Ji(e){return ee(e,"Function")&&e.type==="Function"&&fe(e.$id)&&xt(e.parameters)&&e.parameters.every(t=>be(t))&&be(e.returns)}function pr(e){return ee(e,"Integer")&&e.type==="integer"&&fe(e.$id)&&de(e.exclusiveMaximum)&&de(e.exclusiveMinimum)&&de(e.maximum)&&de(e.minimum)&&de(e.multipleOf)}function gf(e){return je(e)&&Object.entries(e).every(([t,r])=>To(t)&&be(r))}function Zr(e){return ee(e,"Intersect")&&!(Fe(e.type)&&e.type!=="object")&&xt(e.allOf)&&e.allOf.every(t=>be(t)&&!ha(t))&&fe(e.type)&&(Mo(e.unevaluatedProperties)||yf(e.unevaluatedProperties))&&fe(e.$id)}function ko(e){return ee(e,"Iterator")&&e.type==="Iterator"&&fe(e.$id)&&be(e.items)}function ee(e,t){return je(e)&&R in e&&e[R]===t}function hf(e){return Fr(e)&&Fe(e.const)}function $f(e){return Fr(e)&&er(e.const)}function bf(e){return Fr(e)&&Jn(e.const)}function Fr(e){return ee(e,"Literal")&&fe(e.$id)&&la(e.const)}function la(e){return Jn(e)||er(e)||Fe(e)}function ma(e){return ee(e,"MappedKey")&&xt(e.keys)&&e.keys.every(t=>er(t)||Fe(t))}function pa(e){return ee(e,"MappedResult")&&gf(e.properties)}function Ar(e){return ee(e,"Never")&&je(e.not)&&Object.getOwnPropertyNames(e.not).length===0}function un(e){return ee(e,"Not")&&be(e.not)}function Lo(e){return ee(e,"Null")&&e.type==="null"&&fe(e.$id)}function yt(e){return ee(e,"Number")&&e.type==="number"&&fe(e.$id)&&de(e.exclusiveMaximum)&&de(e.exclusiveMinimum)&&de(e.maximum)&&de(e.minimum)&&de(e.multipleOf)}function Oe(e){return ee(e,"Object")&&e.type==="object"&&fe(e.$id)&&gf(e.properties)&&pf(e.additionalProperties)&&de(e.minProperties)&&de(e.maxProperties)}function Do(e){return ee(e,"Promise")&&e.type==="Promise"&&fe(e.$id)&&be(e.item)}function Ze(e){return ee(e,"Record")&&e.type==="object"&&fe(e.$id)&&pf(e.additionalProperties)&&je(e.patternProperties)&&(t=>{const r=Object.getOwnPropertyNames(t.patternProperties);return r.length===1&&mf(r[0])&&je(t.patternProperties)&&be(t.patternProperties[r[0]])})(e)}function ya(e){return ee(e,"Ref")&&fe(e.$id)&&Fe(e.$ref)}function Ln(e){return ee(e,"RegExp")&&fe(e.$id)&&Fe(e.source)&&Fe(e.flags)&&de(e.maxLength)&&de(e.minLength)}function Jt(e){return ee(e,"String")&&e.type==="string"&&fe(e.$id)&&de(e.minLength)&&de(e.maxLength)&&fa(e.pattern)&&ua(e.format)}function Dn(e){return ee(e,"Symbol")&&e.type==="symbol"&&fe(e.$id)}function Bn(e){return ee(e,"TemplateLiteral")&&e.type==="string"&&Fe(e.pattern)&&e.pattern[0]==="^"&&e.pattern[e.pattern.length-1]==="$"}function ga(e){return ee(e,"This")&&fe(e.$id)&&Fe(e.$ref)}function ha(e){return je(e)&&rt in e}function Gi(e){return ee(e,"Tuple")&&e.type==="array"&&fe(e.$id)&&er(e.minItems)&&er(e.maxItems)&&e.minItems===e.maxItems&&(Ae(e.items)&&Ae(e.additionalItems)&&e.minItems===0||xt(e.items)&&e.items.every(t=>be(t)))}function _r(e){return ee(e,"Undefined")&&e.type==="undefined"&&fe(e.$id)}function ar(e){return ee(e,"Union")&&fe(e.$id)&&je(e)&&xt(e.anyOf)&&e.anyOf.every(t=>be(t))}function vn(e){return ee(e,"Uint8Array")&&e.type==="Uint8Array"&&fe(e.$id)&&de(e.minByteLength)&&de(e.maxByteLength)}function Gt(e){return ee(e,"Unknown")&&fe(e.$id)}function $a(e){return ee(e,"Unsafe")}function Wi(e){return ee(e,"Void")&&e.type==="void"&&fe(e.$id)}function ba(e){return je(e)&&R in e&&Fe(e[R])&&!ca.includes(e[R])}function be(e){return je(e)&&(zt(e)||aa(e)||Yr(e)||Qr(e)||Ki(e)||Uo(e)||da(e)||Hi(e)||zi(e)||Ji(e)||pr(e)||Zr(e)||ko(e)||Fr(e)||ma(e)||pa(e)||Ar(e)||un(e)||Lo(e)||yt(e)||Oe(e)||Do(e)||Ze(e)||ya(e)||Ln(e)||Jt(e)||Dn(e)||Bn(e)||ga(e)||Gi(e)||_r(e)||ar(e)||vn(e)||Gt(e)||$a(e)||Wi(e)||ba(e))}const Oa="(true|false)",$i="(0|[1-9][0-9]*)",Of="(.*)",xa="(?!.*)",qr=`^${$i}$`,Kr=`^${Of}$`,wa=`^${xa}$`,Bo=new Map;function Xt(e){return Bo.has(e)}function dr(e,t){Bo.set(e,t)}function _o(e){return Bo.get(e)}const qo=new Map;function Rr(e){return qo.has(e)}function xf(e,t){qo.set(e,t)}function Ko(e){return qo.get(e)}function Ra(e,t){return e.includes(t)}function Ia(e){return[...new Set(e)]}function Fa(e,t){return e.filter(r=>t.includes(r))}function Aa(e,t){return e.reduce((r,n)=>Fa(r,n),t)}function Pa(e){return e.length===1?e[0]:e.length>1?Aa(e.slice(1),e[0]):[]}function Sa(e){const t=[];for(const r of e)t.push(...r);return t}function _n(e){return A({[R]:"Any"},e)}function Ho(e,t){return A({[R]:"Array",type:"array",items:e},t)}function ja(e){return A({[R]:"Argument",index:e})}function zo(e,t){return A({[R]:"AsyncIterator",type:"AsyncIterator",items:e},t)}function Me(e,t,r){return A({[R]:"Computed",target:e,parameters:t},r)}function Ea(e,t){const{[t]:r,...n}=e;return n}function Ft(e,t){return t.reduce((r,n)=>Ea(r,n),e)}function xe(e){return A({[R]:"Never",not:{}},e)}function Xe(e){return A({[R]:"MappedResult",properties:e})}function Jo(e,t,r){return A({[R]:"Constructor",type:"Constructor",parameters:e,returns:t},r)}function ei(e,t,r){return A({[R]:"Function",type:"Function",parameters:e,returns:t},r)}function mo(e,t){return A({[R]:"Union",anyOf:e},t)}function Ca(e){return e.some(t=>Ir(t))}function yc(e){return e.map(t=>Ir(t)?Na(t):t)}function Na(e){return Ft(e,[mr])}function Ta(e,t){return Ca(e)?jr(mo(yc(e),t)):mo(yc(e),t)}function xn(e,t){return e.length===1?A(e[0],t):e.length===0?xe(t):Ta(e,t)}function Ve(e,t){return e.length===0?xe(t):e.length===1?A(e[0],t):mo(e,t)}class gc extends ke{}function Ma(e){return e.replace(/\\\$/g,"$").replace(/\\\*/g,"*").replace(/\\\^/g,"^").replace(/\\\|/g,"|").replace(/\\\(/g,"(").replace(/\\\)/g,")")}function Go(e,t,r){return e[t]===r&&e.charCodeAt(t-1)!==92}function fr(e,t){return Go(e,t,"(")}function qn(e,t){return Go(e,t,")")}function wf(e,t){return Go(e,t,"|")}function Ua(e){if(!(fr(e,0)&&qn(e,e.length-1)))return!1;let t=0;for(let r=0;r<e.length;r++)if(fr(e,r)&&(t+=1),qn(e,r)&&(t-=1),t===0&&r!==e.length-1)return!1;return!0}function ka(e){return e.slice(1,e.length-1)}function La(e){let t=0;for(let r=0;r<e.length;r++)if(fr(e,r)&&(t+=1),qn(e,r)&&(t-=1),wf(e,r)&&t===0)return!0;return!1}function Da(e){for(let t=0;t<e.length;t++)if(fr(e,t))return!0;return!1}function Ba(e){let[t,r]=[0,0];const n=[];for(let o=0;o<e.length;o++)if(fr(e,o)&&(t+=1),qn(e,o)&&(t-=1),wf(e,o)&&t===0){const s=e.slice(r,o);s.length>0&&n.push(an(s)),r=o+1}const i=e.slice(r);return i.length>0&&n.push(an(i)),n.length===0?{type:"const",const:""}:n.length===1?n[0]:{type:"or",expr:n}}function _a(e){function t(i,o){if(!fr(i,o))throw new gc("TemplateLiteralParser: Index must point to open parens");let s=0;for(let c=o;c<i.length;c++)if(fr(i,c)&&(s+=1),qn(i,c)&&(s-=1),s===0)return[o,c];throw new gc("TemplateLiteralParser: Unclosed group parens in expression")}function r(i,o){for(let s=o;s<i.length;s++)if(fr(i,s))return[o,s];return[o,i.length]}const n=[];for(let i=0;i<e.length;i++)if(fr(e,i)){const[o,s]=t(e,i),c=e.slice(o,s+1);n.push(an(c)),i=s}else{const[o,s]=r(e,i),c=e.slice(o,s);c.length>0&&n.push(an(c)),i=s-1}return n.length===0?{type:"const",const:""}:n.length===1?n[0]:{type:"and",expr:n}}function an(e){return Ua(e)?an(ka(e)):La(e)?Ba(e):Da(e)?_a(e):{type:"const",const:Ma(e)}}function Wo(e){return an(e.slice(1,e.length-1))}class qa extends ke{}function Ka(e){return e.type==="or"&&e.expr.length===2&&e.expr[0].type==="const"&&e.expr[0].const==="0"&&e.expr[1].type==="const"&&e.expr[1].const==="[1-9][0-9]*"}function Ha(e){return e.type==="or"&&e.expr.length===2&&e.expr[0].type==="const"&&e.expr[0].const==="true"&&e.expr[1].type==="const"&&e.expr[1].const==="false"}function za(e){return e.type==="const"&&e.const===".*"}function Kn(e){return Ka(e)||za(e)?!1:Ha(e)?!0:e.type==="and"?e.expr.every(t=>Kn(t)):e.type==="or"?e.expr.every(t=>Kn(t)):e.type==="const"?!0:(()=>{throw new qa("Unknown expression type")})()}function Rf(e){const t=Wo(e.pattern);return Kn(t)}class Ja extends ke{}function*If(e){if(e.length===1)return yield*e[0];for(const t of e[0])for(const r of If(e.slice(1)))yield`${t}${r}`}function*Ga(e){return yield*If(e.expr.map(t=>[...Yi(t)]))}function*Wa(e){for(const t of e.expr)yield*Yi(t)}function*Ya(e){return yield e.const}function*Yi(e){return e.type==="and"?yield*Ga(e):e.type==="or"?yield*Wa(e):e.type==="const"?yield*Ya(e):(()=>{throw new Ja("Unknown expression")})()}function Yo(e){const t=Wo(e.pattern);return Kn(t)?[...Yi(t)]:[]}function Se(e,t){return A({[R]:"Literal",const:e,type:typeof e},t)}function Ff(e){return A({[R]:"Boolean",type:"boolean"},e)}function Qo(e){return A({[R]:"BigInt",type:"bigint"},e)}function Xr(e){return A({[R]:"Number",type:"number"},e)}function Hr(e){return A({[R]:"String",type:"string"},e)}function*Qa(e){const t=e.trim().replace(/"|'/g,"");return t==="boolean"?yield Ff():t==="number"?yield Xr():t==="bigint"?yield Qo():t==="string"?yield Hr():yield(()=>{const r=t.split("|").map(n=>Se(n.trim()));return r.length===0?xe():r.length===1?r[0]:xn(r)})()}function*Za(e){if(e[1]!=="{"){const t=Se("$"),r=po(e.slice(1));return yield*[t,...r]}for(let t=2;t<e.length;t++)if(e[t]==="}"){const r=Qa(e.slice(2,t)),n=po(e.slice(t+1));return yield*[...r,...n]}yield Se(e)}function*po(e){for(let t=0;t<e.length;t++)if(e[t]==="$"){const r=Se(e.slice(0,t)),n=Za(e.slice(t));return yield*[r,...n]}yield Se(e)}function Xa(e){return[...po(e)]}class Va extends ke{}function va(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Af(e,t){return Gr(e)?e.pattern.slice(1,e.pattern.length-1):Ke(e)?`(${e.anyOf.map(r=>Af(r,t)).join("|")})`:bn(e)?`${t}${$i}`:$n(e)?`${t}${$i}`:Di(e)?`${t}${$i}`:Xn(e)?`${t}${Of}`:zr(e)?`${t}${va(e.const.toString())}`:Qn(e)?`${t}${Oa}`:(()=>{throw new Va(`Unexpected Kind '${e[R]}'`)})()}function hc(e){return`^${e.map(t=>Af(t,"")).join("")}$`}function Fi(e){const r=Yo(e).map(n=>Se(n));return xn(r)}function Pf(e,t){const r=Fe(e)?hc(Xa(e)):hc(e);return A({[R]:"TemplateLiteral",type:"string",pattern:r},t)}function ed(e){return Yo(e).map(r=>r.toString())}function td(e){const t=[];for(const r of e)t.push(...Pr(r));return t}function rd(e){return[e.toString()]}function Pr(e){return[...new Set(Gr(e)?ed(e):Ke(e)?td(e.anyOf):zr(e)?rd(e.const):bn(e)?["[number]"]:$n(e)?["[number]"]:[])]}function nd(e,t,r){const n={};for(const i of Object.getOwnPropertyNames(t))n[i]=Qi(e,Pr(t[i]),r);return n}function id(e,t,r){return nd(e,t.properties,r)}function od(e,t,r){const n=id(e,t,r);return Xe(n)}function Sf(e,t){return e.map(r=>jf(r,t))}function sd(e){return e.filter(t=>!Zn(t))}function cd(e,t){return Nf(sd(Sf(e,t)))}function fd(e){return e.some(t=>Zn(t))?[]:e}function ud(e,t){return xn(fd(Sf(e,t)))}function ad(e,t){return t in e?e[t]:t==="[number]"?xn(e):xe()}function dd(e,t){return t==="[number]"?e:xe()}function ld(e,t){return t in e?e[t]:xe()}function jf(e,t){return kt(e)?cd(e.allOf,t):Ke(e)?ud(e.anyOf,t):Wr(e)?ad(e.items??[],t):pn(e)?dd(e.items,t):Zt(e)?ld(e.properties,t):xe()}function Zo(e,t){return t.map(r=>jf(e,r))}function $c(e,t){return xn(Zo(e,t))}function Qi(e,t,r){if(ht(e)||ht(t)){const n="Index types using Ref parameters require both Type and Key to be of TSchema";if(!st(e)||!st(t))throw new ke(n);return Me("Index",[e,t])}return St(t)?od(e,t,r):Jr(t)?gd(e,t,r):A(st(t)?$c(e,Pr(t)):$c(e,t),r)}function md(e,t,r){return{[t]:Qi(e,[t],It(r))}}function pd(e,t,r){return t.reduce((n,i)=>({...n,...md(e,i,r)}),{})}function yd(e,t,r){return pd(e,t.keys,r)}function gd(e,t,r){const n=yd(e,t,r);return Xe(n)}function Xo(e,t){return A({[R]:"Iterator",type:"Iterator",items:e},t)}function hd(e){const t=[];for(let r in e)Ir(e[r])||t.push(r);return t}function $d(e,t){const r=hd(e),n=r.length>0?{[R]:"Object",type:"object",properties:e,required:r}:{[R]:"Object",type:"object",properties:e};return A(n,t)}var qe=$d;function Ef(e,t){return A({[R]:"Promise",type:"Promise",item:e},t)}function bd(e){return A(Ft(e,[Yn]))}function Od(e){return A({...e,[Yn]:"Readonly"})}function xd(e,t){return t===!1?bd(e):Od(e)}function Sr(e,t){const r=t??!0;return St(e)?Id(e,r):xd(e,r)}function wd(e,t){const r={};for(const n of globalThis.Object.getOwnPropertyNames(e))r[n]=Sr(e[n],t);return r}function Rd(e,t){return wd(e.properties,t)}function Id(e,t){const r=Rd(e,t);return Xe(r)}function wn(e,t){return A(e.length>0?{[R]:"Tuple",type:"array",items:e,additionalItems:!1,minItems:e.length,maxItems:e.length}:{[R]:"Tuple",type:"array",minItems:e.length,maxItems:e.length},t)}function Cf(e,t){return e in t?Et(e,t[e]):Xe(t)}function Fd(e){return{[e]:Se(e)}}function Ad(e){const t={};for(const r of e)t[r]=Se(r);return t}function Pd(e,t){return Ra(t,e)?Fd(e):Ad(t)}function Sd(e,t){const r=Pd(e,t);return Cf(e,r)}function Sn(e,t){return t.map(r=>Et(e,r))}function jd(e,t){const r={};for(const n of globalThis.Object.getOwnPropertyNames(t))r[n]=Et(e,t[n]);return r}function Et(e,t){const r={...t};return Ir(t)?jr(Et(e,Ft(t,[mr]))):Eo(t)?Sr(Et(e,Ft(t,[Yn]))):St(t)?Cf(e,t.properties):Jr(t)?Sd(e,t.keys):gn(t)?Jo(Sn(e,t.parameters),Et(e,t.returns),r):hn(t)?ei(Sn(e,t.parameters),Et(e,t.returns),r):Li(t)?zo(Et(e,t.items),r):Bi(t)?Xo(Et(e,t.items),r):kt(t)?Er(Sn(e,t.allOf),r):Ke(t)?Ve(Sn(e,t.anyOf),r):Wr(t)?wn(Sn(e,t.items??[]),r):Zt(t)?qe(jd(e,t.properties),r):pn(t)?Ho(Et(e,t.items),r):_i(t)?Ef(Et(e,t.item),r):t}function Ed(e,t){const r={};for(const n of e)r[n]=Et(n,t);return r}function Cd(e,t,r){const n=st(e)?Pr(e):e,i=t({[R]:"MappedKey",keys:n}),o=Ed(n,i);return qe(o,r)}function Nd(e){return A(Ft(e,[mr]))}function Td(e){return A({...e,[mr]:"Optional"})}function Md(e,t){return t===!1?Nd(e):Td(e)}function jr(e,t){const r=t??!0;return St(e)?Ld(e,r):Md(e,r)}function Ud(e,t){const r={};for(const n of globalThis.Object.getOwnPropertyNames(e))r[n]=jr(e[n],t);return r}function kd(e,t){return Ud(e.properties,t)}function Ld(e,t){const r=kd(e,t);return Xe(r)}function yo(e,t={}){const r=e.every(i=>Zt(i)),n=st(t.unevaluatedProperties)?{unevaluatedProperties:t.unevaluatedProperties}:{};return A(t.unevaluatedProperties===!1||st(t.unevaluatedProperties)||r?{...n,[R]:"Intersect",type:"object",allOf:e}:{...n,[R]:"Intersect",allOf:e},t)}function Dd(e){return e.every(t=>Ir(t))}function Bd(e){return Ft(e,[mr])}function bc(e){return e.map(t=>Ir(t)?Bd(t):t)}function _d(e,t){return Dd(e)?jr(yo(bc(e),t)):yo(bc(e),t)}function Nf(e,t={}){if(e.length===1)return A(e[0],t);if(e.length===0)return xe(t);if(e.some(r=>pe(r)))throw new Error("Cannot intersect transform types");return _d(e,t)}function Er(e,t){if(e.length===1)return A(e[0],t);if(e.length===0)return xe(t);if(e.some(r=>pe(r)))throw new Error("Cannot intersect transform types");return yo(e,t)}function Rn(...e){const[t,r]=typeof e[0]=="string"?[e[0],e[1]]:[e[0].$id,e[1]];if(typeof t!="string")throw new ke("Ref: $ref must be a string");return A({[R]:"Ref",$ref:t},r)}function qd(e,t){return Me("Awaited",[Me(e,t)])}function Kd(e){return Me("Awaited",[Rn(e)])}function Hd(e){return Er(Tf(e))}function zd(e){return Ve(Tf(e))}function Jd(e){return Zi(e)}function Tf(e){return e.map(t=>Zi(t))}function Zi(e,t){return A(yn(e)?qd(e.target,e.parameters):kt(e)?Hd(e.allOf):Ke(e)?zd(e.anyOf):_i(e)?Jd(e.item):ht(e)?Kd(e.$ref):e,t)}function Mf(e){const t=[];for(const r of e)t.push(Cr(r));return t}function Gd(e){const t=Mf(e);return Sa(t)}function Wd(e){const t=Mf(e);return Pa(t)}function Yd(e){return e.map((t,r)=>r.toString())}function Qd(e){return["[number]"]}function Zd(e){return globalThis.Object.getOwnPropertyNames(e)}function Xd(e){return go?globalThis.Object.getOwnPropertyNames(e).map(r=>r[0]==="^"&&r[r.length-1]==="$"?r.slice(1,r.length-1):r):[]}function Cr(e){return kt(e)?Gd(e.allOf):Ke(e)?Wd(e.anyOf):Wr(e)?Yd(e.items??[]):pn(e)?Qd(e.items):Zt(e)?Zd(e.properties):qi(e)?Xd(e.patternProperties):[]}let go=!1;function dn(e){go=!0;const t=Cr(e);return go=!1,`^(${t.map(n=>`(${n})`).join("|")})$`}function Vd(e,t){return Me("KeyOf",[Me(e,t)])}function vd(e){return Me("KeyOf",[Rn(e)])}function el(e,t){const r=Cr(e),n=tl(r),i=xn(n);return A(i,t)}function tl(e){return e.map(t=>t==="[number]"?Xr():Se(t))}function Vo(e,t){return yn(e)?Vd(e.target,e.parameters):ht(e)?vd(e.$ref):St(e)?il(e,t):el(e,t)}function rl(e,t){const r={};for(const n of globalThis.Object.getOwnPropertyNames(e))r[n]=Vo(e[n],It(t));return r}function nl(e,t){return rl(e.properties,t)}function il(e,t){const r=nl(e,t);return Xe(r)}function Uf(e){const t=Cr(e),r=Zo(e,t);return t.map((n,i)=>[t[i],r[i]])}function ol(e){const t=[];for(const r of e)t.push(...Cr(r));return Ia(t)}function sl(e){return e.filter(t=>!Zn(t))}function cl(e,t){const r=[];for(const n of e)r.push(...Zo(n,[t]));return sl(r)}function fl(e,t){const r={};for(const n of t)r[n]=Nf(cl(e,n));return r}function ul(e,t){const r=ol(e),n=fl(e,r);return qe(n,t)}function kf(e){return A({[R]:"Date",type:"Date"},e)}function Lf(e){return A({[R]:"Null",type:"null"},e)}function Df(e){return A({[R]:"Symbol",type:"symbol"},e)}function Bf(e){return A({[R]:"Undefined",type:"undefined"},e)}function _f(e){return A({[R]:"Uint8Array",type:"Uint8Array"},e)}function Xi(e){return A({[R]:"Unknown"},e)}function al(e){return e.map(t=>vo(t,!1))}function dl(e){const t={};for(const r of globalThis.Object.getOwnPropertyNames(e))t[r]=Sr(vo(e[r],!1));return t}function yi(e,t){return t===!0?e:Sr(e)}function vo(e,t){return Bu(e)||qu(e)?yi(_n(),t):xt(e)?Sr(wn(al(e))):Gn(e)?_f():Ao(e)?kf():je(e)?yi(qe(dl(e)),t):_u(e)?yi(ei([],Xi()),t):Ae(e)?Bf():Ku(e)?Lf():Hu(e)?Df():rf(e)?Qo():er(e)||Jn(e)||Fe(e)?Se(e):qe({})}function ll(e,t){return A(vo(e,!0),t)}function ml(e,t){return gn(e)?wn(e.parameters,t):xe(t)}function pl(e,t){if(Ae(e))throw new Error("Enum undefined or empty");const r=globalThis.Object.getOwnPropertyNames(e).filter(o=>isNaN(o)).map(o=>e[o]),i=[...new Set(r)].map(o=>Se(o));return Ve(i,{...t,[ki]:"Enum"})}class yl extends ke{}var b;(function(e){e[e.Union=0]="Union",e[e.True=1]="True",e[e.False=2]="False"})(b||(b={}));function Tt(e){return e===b.False?e:b.True}function In(e){throw new yl(e)}function Ce(e){return Ar(e)||Zr(e)||ar(e)||Gt(e)||zt(e)}function Ne(e,t){return Ar(t)?Hf():Zr(t)?Vi(e,t):ar(t)?ts(e,t):Gt(t)?Wf():zt(t)?es():In("StructuralRight")}function es(e,t){return b.True}function gl(e,t){return Zr(t)?Vi(e,t):ar(t)&&t.anyOf.some(r=>zt(r)||Gt(r))?b.True:ar(t)?b.Union:Gt(t)||zt(t)?b.True:b.Union}function hl(e,t){return Gt(e)?b.False:zt(e)?b.Union:Ar(e)?b.True:b.False}function $l(e,t){return Oe(t)&&vi(t)?b.True:Ce(t)?Ne(e,t):Yr(t)?Tt(ce(e.items,t.items)):b.False}function bl(e,t){return Ce(t)?Ne(e,t):Uo(t)?Tt(ce(e.items,t.items)):b.False}function Ol(e,t){return Ce(t)?Ne(e,t):Oe(t)?it(e,t):Ze(t)?Lt(e,t):Ki(t)?b.True:b.False}function qf(e,t){return bf(e)||Qr(e)?b.True:b.False}function xl(e,t){return Ce(t)?Ne(e,t):Oe(t)?it(e,t):Ze(t)?Lt(e,t):Qr(t)?b.True:b.False}function wl(e,t){return Ce(t)?Ne(e,t):Oe(t)?it(e,t):Hi(t)?e.parameters.length>t.parameters.length?b.False:e.parameters.every((r,n)=>Tt(ce(t.parameters[n],r))===b.True)?Tt(ce(e.returns,t.returns)):b.False:b.False}function Rl(e,t){return Ce(t)?Ne(e,t):Oe(t)?it(e,t):Ze(t)?Lt(e,t):zi(t)?b.True:b.False}function Il(e,t){return Ce(t)?Ne(e,t):Oe(t)?it(e,t):Ji(t)?e.parameters.length>t.parameters.length?b.False:e.parameters.every((r,n)=>Tt(ce(t.parameters[n],r))===b.True)?Tt(ce(e.returns,t.returns)):b.False:b.False}function Kf(e,t){return Fr(e)&&er(e.const)||yt(e)||pr(e)?b.True:b.False}function Fl(e,t){return pr(t)||yt(t)?b.True:Ce(t)?Ne(e,t):Oe(t)?it(e,t):Ze(t)?Lt(e,t):b.False}function Vi(e,t){return t.allOf.every(r=>ce(e,r)===b.True)?b.True:b.False}function Al(e,t){return e.allOf.some(r=>ce(r,t)===b.True)?b.True:b.False}function Pl(e,t){return Ce(t)?Ne(e,t):ko(t)?Tt(ce(e.items,t.items)):b.False}function Sl(e,t){return Fr(t)&&t.const===e.const?b.True:Ce(t)?Ne(e,t):Oe(t)?it(e,t):Ze(t)?Lt(e,t):Jt(t)?Gf(e):yt(t)?zf(e):pr(t)?Kf(e):Qr(t)?qf(e):b.False}function Hf(e,t){return b.False}function jl(e,t){return b.True}function Oc(e){let[t,r]=[e,0];for(;un(t);)t=t.not,r+=1;return r%2===0?t:Xi()}function El(e,t){return un(e)?ce(Oc(e),t):un(t)?ce(e,Oc(t)):In("Invalid fallthrough for Not")}function Cl(e,t){return Ce(t)?Ne(e,t):Oe(t)?it(e,t):Ze(t)?Lt(e,t):Lo(t)?b.True:b.False}function zf(e,t){return $f(e)||yt(e)||pr(e)?b.True:b.False}function Nl(e,t){return Ce(t)?Ne(e,t):Oe(t)?it(e,t):Ze(t)?Lt(e,t):pr(t)||yt(t)?b.True:b.False}function $t(e,t){return Object.getOwnPropertyNames(e.properties).length===t}function xc(e){return vi(e)}function wc(e){return $t(e,0)||$t(e,1)&&"description"in e.properties&&ar(e.properties.description)&&e.properties.description.anyOf.length===2&&(Jt(e.properties.description.anyOf[0])&&_r(e.properties.description.anyOf[1])||Jt(e.properties.description.anyOf[1])&&_r(e.properties.description.anyOf[0]))}function io(e){return $t(e,0)}function Rc(e){return $t(e,0)}function Tl(e){return $t(e,0)}function Ml(e){return $t(e,0)}function Ul(e){return vi(e)}function kl(e){const t=Xr();return $t(e,0)||$t(e,1)&&"length"in e.properties&&Tt(ce(e.properties.length,t))===b.True}function Ll(e){return $t(e,0)}function vi(e){const t=Xr();return $t(e,0)||$t(e,1)&&"length"in e.properties&&Tt(ce(e.properties.length,t))===b.True}function Dl(e){const t=ei([_n()],_n());return $t(e,0)||$t(e,1)&&"then"in e.properties&&Tt(ce(e.properties.then,t))===b.True}function Jf(e,t){return ce(e,t)===b.False||Ii(e)&&!Ii(t)?b.False:b.True}function it(e,t){return Gt(e)?b.False:zt(e)?b.Union:Ar(e)||hf(e)&&xc(t)||$f(e)&&io(t)||bf(e)&&Rc(t)||Dn(e)&&wc(t)||Ki(e)&&Tl(t)||Jt(e)&&xc(t)||Dn(e)&&wc(t)||yt(e)&&io(t)||pr(e)&&io(t)||Qr(e)&&Rc(t)||vn(e)&&Ul(t)||zi(e)&&Ml(t)||Hi(e)&&Ll(t)||Ji(e)&&kl(t)?b.True:Ze(e)&&Jt(ho(e))?t[ki]==="Record"?b.True:b.False:Ze(e)&&yt(ho(e))?$t(t,0)?b.True:b.False:b.False}function Bl(e,t){return Ce(t)?Ne(e,t):Ze(t)?Lt(e,t):Oe(t)?(()=>{for(const r of Object.getOwnPropertyNames(t.properties)){if(!(r in e.properties)&&!Ii(t.properties[r]))return b.False;if(Ii(t.properties[r]))return b.True;if(Jf(e.properties[r],t.properties[r])===b.False)return b.False}return b.True})():b.False}function _l(e,t){return Ce(t)?Ne(e,t):Oe(t)&&Dl(t)?b.True:Do(t)?Tt(ce(e.item,t.item)):b.False}function ho(e){return qr in e.patternProperties?Xr():Kr in e.patternProperties?Hr():In("Unknown record key pattern")}function $o(e){return qr in e.patternProperties?e.patternProperties[qr]:Kr in e.patternProperties?e.patternProperties[Kr]:In("Unable to get record value schema")}function Lt(e,t){const[r,n]=[ho(t),$o(t)];return hf(e)&&yt(r)&&Tt(ce(e,n))===b.True?b.True:vn(e)&&yt(r)||Jt(e)&&yt(r)||Yr(e)&&yt(r)?ce(e,n):Oe(e)?(()=>{for(const i of Object.getOwnPropertyNames(e.properties))if(Jf(n,e.properties[i])===b.False)return b.False;return b.True})():b.False}function ql(e,t){return Ce(t)?Ne(e,t):Oe(t)?it(e,t):Ze(t)?ce($o(e),$o(t)):b.False}function Kl(e,t){const r=Ln(e)?Hr():e,n=Ln(t)?Hr():t;return ce(r,n)}function Gf(e,t){return Fr(e)&&Fe(e.const)||Jt(e)?b.True:b.False}function Hl(e,t){return Ce(t)?Ne(e,t):Oe(t)?it(e,t):Ze(t)?Lt(e,t):Jt(t)?b.True:b.False}function zl(e,t){return Ce(t)?Ne(e,t):Oe(t)?it(e,t):Ze(t)?Lt(e,t):Dn(t)?b.True:b.False}function Jl(e,t){return Bn(e)?ce(Fi(e),t):Bn(t)?ce(e,Fi(t)):In("Invalid fallthrough for TemplateLiteral")}function Gl(e,t){return Yr(t)&&e.items!==void 0&&e.items.every(r=>ce(r,t.items)===b.True)}function Wl(e,t){return Ar(e)?b.True:Gt(e)?b.False:zt(e)?b.Union:b.False}function Yl(e,t){return Ce(t)?Ne(e,t):Oe(t)&&vi(t)||Yr(t)&&Gl(e,t)?b.True:Gi(t)?Ae(e.items)&&!Ae(t.items)||!Ae(e.items)&&Ae(t.items)?b.False:Ae(e.items)&&!Ae(t.items)||e.items.every((r,n)=>ce(r,t.items[n])===b.True)?b.True:b.False:b.False}function Ql(e,t){return Ce(t)?Ne(e,t):Oe(t)?it(e,t):Ze(t)?Lt(e,t):vn(t)?b.True:b.False}function Zl(e,t){return Ce(t)?Ne(e,t):Oe(t)?it(e,t):Ze(t)?Lt(e,t):Wi(t)?vl(e):_r(t)?b.True:b.False}function ts(e,t){return t.anyOf.some(r=>ce(e,r)===b.True)?b.True:b.False}function Xl(e,t){return e.anyOf.every(r=>ce(r,t)===b.True)?b.True:b.False}function Wf(e,t){return b.True}function Vl(e,t){return Ar(t)?Hf():Zr(t)?Vi(e,t):ar(t)?ts(e,t):zt(t)?es():Jt(t)?Gf(e):yt(t)?zf(e):pr(t)?Kf(e):Qr(t)?qf(e):Yr(t)?hl(e):Gi(t)?Wl(e):Oe(t)?it(e,t):Gt(t)?b.True:b.False}function vl(e,t){return _r(e)||_r(e)?b.True:b.False}function em(e,t){return Zr(t)?Vi(e,t):ar(t)?ts(e,t):Gt(t)?Wf():zt(t)?es():Oe(t)?it(e,t):Wi(t)?b.True:b.False}function ce(e,t){return Bn(e)||Bn(t)?Jl(e,t):Ln(e)||Ln(t)?Kl(e,t):un(e)||un(t)?El(e,t):zt(e)?gl(e,t):Yr(e)?$l(e,t):Ki(e)?Ol(e,t):Qr(e)?xl(e,t):Uo(e)?bl(e,t):Hi(e)?wl(e,t):zi(e)?Rl(e,t):Ji(e)?Il(e,t):pr(e)?Fl(e,t):Zr(e)?Al(e,t):ko(e)?Pl(e,t):Fr(e)?Sl(e,t):Ar(e)?jl():Lo(e)?Cl(e,t):yt(e)?Nl(e,t):Oe(e)?Bl(e,t):Ze(e)?ql(e,t):Jt(e)?Hl(e,t):Dn(e)?zl(e,t):Gi(e)?Yl(e,t):Do(e)?_l(e,t):vn(e)?Ql(e,t):_r(e)?Zl(e,t):ar(e)?Xl(e,t):Gt(e)?Vl(e,t):Wi(e)?em(e,t):In(`Unknown left type operand '${e[R]}'`)}function ti(e,t){return ce(e,t)}function tm(e,t,r,n,i){const o={};for(const s of globalThis.Object.getOwnPropertyNames(e))o[s]=rs(e[s],t,r,n,It(i));return o}function rm(e,t,r,n,i){return tm(e.properties,t,r,n,i)}function nm(e,t,r,n,i){const o=rm(e,t,r,n,i);return Xe(o)}function im(e,t,r,n){const i=ti(e,t);return i===b.Union?Ve([r,n]):i===b.True?r:n}function rs(e,t,r,n,i){return St(e)?nm(e,t,r,n,i):Jr(e)?A(fm(e,t,r,n,i)):A(im(e,t,r,n),i)}function om(e,t,r,n,i){return{[e]:rs(Se(e),t,r,n,It(i))}}function sm(e,t,r,n,i){return e.reduce((o,s)=>({...o,...om(s,t,r,n,i)}),{})}function cm(e,t,r,n,i){return sm(e.keys,t,r,n,i)}function fm(e,t,r,n,i){const o=cm(e,t,r,n,i);return Xe(o)}function um(e){return e.allOf.every(t=>Fn(t))}function am(e){return e.anyOf.some(t=>Fn(t))}function dm(e){return!Fn(e.not)}function Fn(e){return e[R]==="Intersect"?um(e):e[R]==="Union"?am(e):e[R]==="Not"?dm(e):e[R]==="Undefined"}function lm(e,t){return ns(Fi(e),t)}function mm(e,t){const r=e.filter(n=>ti(n,t)===b.False);return r.length===1?r[0]:Ve(r)}function ns(e,t,r={}){return Gr(e)?A(lm(e,t),r):St(e)?A(gm(e,t),r):A(Ke(e)?mm(e.anyOf,t):ti(e,t)!==b.False?xe():e,r)}function pm(e,t){const r={};for(const n of globalThis.Object.getOwnPropertyNames(e))r[n]=ns(e[n],t);return r}function ym(e,t){return pm(e.properties,t)}function gm(e,t){const r=ym(e,t);return Xe(r)}function hm(e,t){return is(Fi(e),t)}function $m(e,t){const r=e.filter(n=>ti(n,t)!==b.False);return r.length===1?r[0]:Ve(r)}function is(e,t,r){return Gr(e)?A(hm(e,t),r):St(e)?A(xm(e,t),r):A(Ke(e)?$m(e.anyOf,t):ti(e,t)!==b.False?e:xe(),r)}function bm(e,t){const r={};for(const n of globalThis.Object.getOwnPropertyNames(e))r[n]=is(e[n],t);return r}function Om(e,t){return bm(e.properties,t)}function xm(e,t){const r=Om(e,t);return Xe(r)}function wm(e,t){return gn(e)?A(e.returns,t):xe(t)}function Yf(e){return Sr(jr(e))}function Vr(e,t,r){return A({[R]:"Record",type:"object",patternProperties:{[e]:t}},r)}function os(e,t,r){const n={};for(const i of e)n[i]=t;return qe(n,{...r,[ki]:"Record"})}function Rm(e,t,r){return Rf(e)?os(Pr(e),t,r):Vr(e.pattern,t,r)}function Im(e,t,r){return os(Pr(Ve(e)),t,r)}function Fm(e,t,r){return os([e.toString()],t,r)}function Am(e,t,r){return Vr(e.source,t,r)}function Pm(e,t,r){const n=Ae(e.pattern)?Kr:e.pattern;return Vr(n,t,r)}function Sm(e,t,r){return Vr(Kr,t,r)}function jm(e,t,r){return Vr(wa,t,r)}function Em(e,t,r){return qe({true:t,false:t},r)}function Cm(e,t,r){return Vr(qr,t,r)}function Nm(e,t,r){return Vr(qr,t,r)}function Qf(e,t,r={}){return Ke(e)?Im(e.anyOf,t,r):Gr(e)?Rm(e,t,r):zr(e)?Fm(e.const,t,r):Qn(e)?Em(e,t,r):$n(e)?Cm(e,t,r):bn(e)?Nm(e,t,r):lf(e)?Am(e,t,r):Xn(e)?Pm(e,t,r):uf(e)?Sm(e,t,r):Zn(e)?jm(e,t,r):xe(r)}function ss(e){return globalThis.Object.getOwnPropertyNames(e.patternProperties)[0]}function Tm(e){const t=ss(e);return t===Kr?Hr():t===qr?Xr():Hr({pattern:t})}function Zf(e){return e.patternProperties[ss(e)]}function Mm(e,t){return t.parameters=ri(e,t.parameters),t.returns=Wt(e,t.returns),t}function Um(e,t){return t.parameters=ri(e,t.parameters),t.returns=Wt(e,t.returns),t}function km(e,t){return t.allOf=ri(e,t.allOf),t}function Lm(e,t){return t.anyOf=ri(e,t.anyOf),t}function Dm(e,t){return Ae(t.items)||(t.items=ri(e,t.items)),t}function Bm(e,t){return t.items=Wt(e,t.items),t}function _m(e,t){return t.items=Wt(e,t.items),t}function qm(e,t){return t.items=Wt(e,t.items),t}function Km(e,t){return t.item=Wt(e,t.item),t}function Hm(e,t){const r=Wm(e,t.properties);return{...t,...qe(r)}}function zm(e,t){const r=Wt(e,Tm(t)),n=Wt(e,Zf(t)),i=Qf(r,n);return{...t,...i}}function Jm(e,t){return t.index in e?e[t.index]:Xi()}function Gm(e,t){const r=Eo(t),n=Ir(t),i=Wt(e,t);return r&&n?Yf(i):r&&!n?Sr(i):!r&&n?jr(i):i}function Wm(e,t){return globalThis.Object.getOwnPropertyNames(t).reduce((r,n)=>({...r,[n]:Gm(e,t[n])}),{})}function ri(e,t){return t.map(r=>Wt(e,r))}function Wt(e,t){return gn(t)?Mm(e,t):hn(t)?Um(e,t):kt(t)?km(e,t):Ke(t)?Lm(e,t):Wr(t)?Dm(e,t):pn(t)?Bm(e,t):Li(t)?_m(e,t):Bi(t)?qm(e,t):_i(t)?Km(e,t):Zt(t)?Hm(e,t):qi(t)?zm(e,t):af(t)?Jm(e,t):t}function Ym(e,t){return Wt(t,Po(e))}function Qm(e){return A({[R]:"Integer",type:"integer"},e)}function Zm(e,t,r){return{[e]:An(Se(e),t,It(r))}}function Xm(e,t,r){return e.reduce((i,o)=>({...i,...Zm(o,t,r)}),{})}function Vm(e,t,r){return Xm(e.keys,t,r)}function vm(e,t,r){const n=Vm(e,t,r);return Xe(n)}function ep(e){const[t,r]=[e.slice(0,1),e.slice(1)];return[t.toLowerCase(),r].join("")}function tp(e){const[t,r]=[e.slice(0,1),e.slice(1)];return[t.toUpperCase(),r].join("")}function rp(e){return e.toUpperCase()}function np(e){return e.toLowerCase()}function ip(e,t,r){const n=Wo(e.pattern);if(!Kn(n))return{...e,pattern:Xf(e.pattern,t)};const s=[...Yi(n)].map(f=>Se(f)),c=Vf(s,t),u=Ve(c);return Pf([u],r)}function Xf(e,t){return typeof e=="string"?t==="Uncapitalize"?ep(e):t==="Capitalize"?tp(e):t==="Uppercase"?rp(e):t==="Lowercase"?np(e):e:e.toString()}function Vf(e,t){return e.map(r=>An(r,t))}function An(e,t,r={}){return Jr(e)?vm(e,t,r):Gr(e)?ip(e,t,r):Ke(e)?Ve(Vf(e.anyOf,t),r):zr(e)?Se(Xf(e.const,t),r):A(e,r)}function op(e,t={}){return An(e,"Capitalize",t)}function sp(e,t={}){return An(e,"Lowercase",t)}function cp(e,t={}){return An(e,"Uncapitalize",t)}function fp(e,t={}){return An(e,"Uppercase",t)}function up(e,t,r){const n={};for(const i of globalThis.Object.getOwnPropertyNames(e))n[i]=eo(e[i],t,It(r));return n}function ap(e,t,r){return up(e.properties,t,r)}function dp(e,t,r){const n=ap(e,t,r);return Xe(n)}function lp(e,t){return e.map(r=>cs(r,t))}function mp(e,t){return e.map(r=>cs(r,t))}function pp(e,t){const{[t]:r,...n}=e;return n}function yp(e,t){return t.reduce((r,n)=>pp(r,n),e)}function gp(e,t){const r=Ft(e,[rt,"$id","required","properties"]),n=yp(e.properties,t);return qe(n,r)}function hp(e){const t=e.reduce((r,n)=>df(n)?[...r,Se(n)]:r,[]);return Ve(t)}function cs(e,t){return kt(e)?Er(lp(e.allOf,t)):Ke(e)?Ve(mp(e.anyOf,t)):Zt(e)?gp(e,t):qe({})}function eo(e,t,r){const n=xt(t)?hp(t):t,i=st(t)?Pr(t):t,o=ht(e),s=ht(t);return St(e)?dp(e,i,r):Jr(t)?xp(e,t,r):o&&s?Me("Omit",[e,n],r):!o&&s?Me("Omit",[e,n],r):o&&!s?Me("Omit",[e,n],r):A({...cs(e,i),...r})}function $p(e,t,r){return{[t]:eo(e,[t],It(r))}}function bp(e,t,r){return t.reduce((n,i)=>({...n,...$p(e,i,r)}),{})}function Op(e,t,r){return bp(e,t.keys,r)}function xp(e,t,r){const n=Op(e,t,r);return Xe(n)}function wp(e,t,r){const n={};for(const i of globalThis.Object.getOwnPropertyNames(e))n[i]=to(e[i],t,It(r));return n}function Rp(e,t,r){return wp(e.properties,t,r)}function Ip(e,t,r){const n=Rp(e,t,r);return Xe(n)}function Fp(e,t){return e.map(r=>fs(r,t))}function Ap(e,t){return e.map(r=>fs(r,t))}function Pp(e,t){const r={};for(const n of t)n in e&&(r[n]=e[n]);return r}function Sp(e,t){const r=Ft(e,[rt,"$id","required","properties"]),n=Pp(e.properties,t);return qe(n,r)}function jp(e){const t=e.reduce((r,n)=>df(n)?[...r,Se(n)]:r,[]);return Ve(t)}function fs(e,t){return kt(e)?Er(Fp(e.allOf,t)):Ke(e)?Ve(Ap(e.anyOf,t)):Zt(e)?Sp(e,t):qe({})}function to(e,t,r){const n=xt(t)?jp(t):t,i=st(t)?Pr(t):t,o=ht(e),s=ht(t);return St(e)?Ip(e,i,r):Jr(t)?Tp(e,t,r):o&&s?Me("Pick",[e,n],r):!o&&s?Me("Pick",[e,n],r):o&&!s?Me("Pick",[e,n],r):A({...fs(e,i),...r})}function Ep(e,t,r){return{[t]:to(e,[t],It(r))}}function Cp(e,t,r){return t.reduce((n,i)=>({...n,...Ep(e,i,r)}),{})}function Np(e,t,r){return Cp(e,t.keys,r)}function Tp(e,t,r){const n=Np(e,t,r);return Xe(n)}function Mp(e,t){return Me("Partial",[Me(e,t)])}function Up(e){return Me("Partial",[Rn(e)])}function kp(e){const t={};for(const r of globalThis.Object.getOwnPropertyNames(e))t[r]=jr(e[r]);return t}function Lp(e){const t=Ft(e,[rt,"$id","required","properties"]),r=kp(e.properties);return qe(r,t)}function Ic(e){return e.map(t=>vf(t))}function vf(e){return yn(e)?Mp(e.target,e.parameters):ht(e)?Up(e.$ref):kt(e)?Er(Ic(e.allOf)):Ke(e)?Ve(Ic(e.anyOf)):Zt(e)?Lp(e):Di(e)||Qn(e)||$n(e)||zr(e)||Co(e)||bn(e)||Xn(e)||No(e)||Vn(e)?e:qe({})}function us(e,t){return St(e)?_p(e,t):A({...vf(e),...t})}function Dp(e,t){const r={};for(const n of globalThis.Object.getOwnPropertyNames(e))r[n]=us(e[n],It(t));return r}function Bp(e,t){return Dp(e.properties,t)}function _p(e,t){const r=Bp(e,t);return Xe(r)}function qp(e,t){return Me("Required",[Me(e,t)])}function Kp(e){return Me("Required",[Rn(e)])}function Hp(e){const t={};for(const r of globalThis.Object.getOwnPropertyNames(e))t[r]=Ft(e[r],[mr]);return t}function zp(e){const t=Ft(e,[rt,"$id","required","properties"]),r=Hp(e.properties);return qe(r,t)}function Fc(e){return e.map(t=>eu(t))}function eu(e){return yn(e)?qp(e.target,e.parameters):ht(e)?Kp(e.$ref):kt(e)?Er(Fc(e.allOf)):Ke(e)?Ve(Fc(e.anyOf)):Zt(e)?zp(e):Di(e)||Qn(e)||$n(e)||zr(e)||Co(e)||bn(e)||Xn(e)||No(e)||Vn(e)?e:qe({})}function as(e,t){return St(e)?Wp(e,t):A({...eu(e),...t})}function Jp(e,t){const r={};for(const n of globalThis.Object.getOwnPropertyNames(e))r[n]=as(e[n],t);return r}function Gp(e,t){return Jp(e.properties,t)}function Wp(e,t){const r=Gp(e,t);return Xe(r)}function Yp(e,t){return t.map(r=>ht(r)?ds(e,r.$ref):At(e,r))}function ds(e,t){return t in e?ht(e[t])?ds(e,e[t].$ref):At(e,e[t]):xe()}function Qp(e){return Zi(e[0])}function Zp(e){return Qi(e[0],e[1])}function Xp(e){return Vo(e[0])}function Vp(e){return us(e[0])}function vp(e){return eo(e[0],e[1])}function ey(e){return to(e[0],e[1])}function ty(e){return as(e[0])}function ry(e,t,r){const n=Yp(e,r);return t==="Awaited"?Qp(n):t==="Index"?Zp(n):t==="KeyOf"?Xp(n):t==="Partial"?Vp(n):t==="Omit"?vp(n):t==="Pick"?ey(n):t==="Required"?ty(n):xe()}function ny(e,t){return Ho(At(e,t))}function iy(e,t){return zo(At(e,t))}function oy(e,t,r){return Jo(ni(e,t),At(e,r))}function sy(e,t,r){return ei(ni(e,t),At(e,r))}function cy(e,t){return Er(ni(e,t))}function fy(e,t){return Xo(At(e,t))}function uy(e,t){return qe(globalThis.Object.keys(t).reduce((r,n)=>({...r,[n]:At(e,t[n])}),{}))}function ay(e,t){const[r,n]=[At(e,Zf(t)),ss(t)],i=Po(t);return i.patternProperties[n]=r,i}function dy(e,t){return ht(t)?{...ds(e,t.$ref),[rt]:t[rt]}:t}function ly(e,t){return wn(ni(e,t))}function my(e,t){return Ve(ni(e,t))}function ni(e,t){return t.map(r=>At(e,r))}function At(e,t){return Ir(t)?A(At(e,Ft(t,[mr])),t):Eo(t)?A(At(e,Ft(t,[Yn])),t):pe(t)?A(dy(e,t),t):pn(t)?A(ny(e,t.items),t):Li(t)?A(iy(e,t.items),t):yn(t)?A(ry(e,t.target,t.parameters)):gn(t)?A(oy(e,t.parameters,t.returns),t):hn(t)?A(sy(e,t.parameters,t.returns),t):kt(t)?A(cy(e,t.allOf),t):Bi(t)?A(fy(e,t.items),t):Zt(t)?A(uy(e,t.properties),t):qi(t)?A(ay(e,t)):Wr(t)?A(ly(e,t.items||[]),t):Ke(t)?A(my(e,t.anyOf),t):t}function py(e,t){return t in e?At(e,e[t]):xe()}function yy(e){return globalThis.Object.getOwnPropertyNames(e).reduce((t,r)=>({...t,[r]:py(e,r)}),{})}class gy{constructor(t){const r=yy(t),n=this.WithIdentifiers(r);this.$defs=n}Import(t,r){const n={...this.$defs,[t]:A(this.$defs[t],r)};return A({[R]:"Import",$defs:n,$ref:t})}WithIdentifiers(t){return globalThis.Object.getOwnPropertyNames(t).reduce((r,n)=>({...r,[n]:{...t[n],$id:n}}),{})}}function hy(e){return new gy(e)}function $y(e,t){return A({[R]:"Not",not:e},t)}function by(e,t){return hn(e)?wn(e.parameters,t):xe()}let Oy=0;function xy(e,t={}){Ae(t.$id)&&(t.$id=`T${Oy++}`);const r=Po(e({[R]:"This",$ref:`${t.$id}`}));return r.$id=t.$id,A({[ki]:"Recursive",...r},t)}function wy(e,t){const r=Fe(e)?new globalThis.RegExp(e):e;return A({[R]:"RegExp",type:"RegExp",source:r.source,flags:r.flags},t)}function Ry(e){return kt(e)?e.allOf:Ke(e)?e.anyOf:Wr(e)?e.items??[]:[]}function Iy(e){return Ry(e)}function Fy(e,t){return hn(e)?A(e.returns,t):xe(t)}class Ay{constructor(t){this.schema=t}Decode(t){return new Py(this.schema,t)}}class Py{constructor(t,r){this.schema=t,this.decode=r}EncodeTransform(t,r){const o={Encode:s=>r[rt].Encode(t(s)),Decode:s=>this.decode(r[rt].Decode(s))};return{...r,[rt]:o}}EncodeSchema(t,r){const n={Decode:this.decode,Encode:t};return{...r,[rt]:n}}Encode(t){return pe(this.schema)?this.EncodeTransform(t,this.schema):this.EncodeSchema(t,this.schema)}}function Sy(e){return new Ay(e)}function tu(e={}){return A({[R]:e[R]??"Unsafe"},e)}function jy(e){return A({[R]:"Void",type:"void"},e)}const Ey=Object.freeze(Object.defineProperty({__proto__:null,Any:_n,Argument:ja,Array:Ho,AsyncIterator:zo,Awaited:Zi,BigInt:Qo,Boolean:Ff,Capitalize:op,Composite:ul,Const:ll,Constructor:Jo,ConstructorParameters:ml,Date:kf,Enum:pl,Exclude:ns,Extends:rs,Extract:is,Function:ei,Index:Qi,InstanceType:wm,Instantiate:Ym,Integer:Qm,Intersect:Er,Iterator:Xo,KeyOf:Vo,Literal:Se,Lowercase:sp,Mapped:Cd,Module:hy,Never:xe,Not:$y,Null:Lf,Number:Xr,Object:qe,Omit:eo,Optional:jr,Parameters:by,Partial:us,Pick:to,Promise:Ef,Readonly:Sr,ReadonlyOptional:Yf,Record:Qf,Recursive:xy,Ref:Rn,RegExp:wy,Required:as,Rest:Iy,ReturnType:Fy,String:Hr,Symbol:Df,TemplateLiteral:Pf,Transform:Sy,Tuple:wn,Uint8Array:_f,Uncapitalize:cp,Undefined:Bf,Union:Ve,Unknown:Xi,Unsafe:tu,Uppercase:fp,Void:jy},Symbol.toStringTag,{value:"Module"})),Tr=Ey;function Cy(e){switch(e.errorType){case $.ArrayContains:return"Expected array to contain at least one matching value";case $.ArrayMaxContains:return`Expected array to contain no more than ${e.schema.maxContains} matching values`;case $.ArrayMinContains:return`Expected array to contain at least ${e.schema.minContains} matching values`;case $.ArrayMaxItems:return`Expected array length to be less or equal to ${e.schema.maxItems}`;case $.ArrayMinItems:return`Expected array length to be greater or equal to ${e.schema.minItems}`;case $.ArrayUniqueItems:return"Expected array elements to be unique";case $.Array:return"Expected array";case $.AsyncIterator:return"Expected AsyncIterator";case $.BigIntExclusiveMaximum:return`Expected bigint to be less than ${e.schema.exclusiveMaximum}`;case $.BigIntExclusiveMinimum:return`Expected bigint to be greater than ${e.schema.exclusiveMinimum}`;case $.BigIntMaximum:return`Expected bigint to be less or equal to ${e.schema.maximum}`;case $.BigIntMinimum:return`Expected bigint to be greater or equal to ${e.schema.minimum}`;case $.BigIntMultipleOf:return`Expected bigint to be a multiple of ${e.schema.multipleOf}`;case $.BigInt:return"Expected bigint";case $.Boolean:return"Expected boolean";case $.DateExclusiveMinimumTimestamp:return`Expected Date timestamp to be greater than ${e.schema.exclusiveMinimumTimestamp}`;case $.DateExclusiveMaximumTimestamp:return`Expected Date timestamp to be less than ${e.schema.exclusiveMaximumTimestamp}`;case $.DateMinimumTimestamp:return`Expected Date timestamp to be greater or equal to ${e.schema.minimumTimestamp}`;case $.DateMaximumTimestamp:return`Expected Date timestamp to be less or equal to ${e.schema.maximumTimestamp}`;case $.DateMultipleOfTimestamp:return`Expected Date timestamp to be a multiple of ${e.schema.multipleOfTimestamp}`;case $.Date:return"Expected Date";case $.Function:return"Expected function";case $.IntegerExclusiveMaximum:return`Expected integer to be less than ${e.schema.exclusiveMaximum}`;case $.IntegerExclusiveMinimum:return`Expected integer to be greater than ${e.schema.exclusiveMinimum}`;case $.IntegerMaximum:return`Expected integer to be less or equal to ${e.schema.maximum}`;case $.IntegerMinimum:return`Expected integer to be greater or equal to ${e.schema.minimum}`;case $.IntegerMultipleOf:return`Expected integer to be a multiple of ${e.schema.multipleOf}`;case $.Integer:return"Expected integer";case $.IntersectUnevaluatedProperties:return"Unexpected property";case $.Intersect:return"Expected all values to match";case $.Iterator:return"Expected Iterator";case $.Literal:return`Expected ${typeof e.schema.const=="string"?`'${e.schema.const}'`:e.schema.const}`;case $.Never:return"Never";case $.Not:return"Value should not match";case $.Null:return"Expected null";case $.NumberExclusiveMaximum:return`Expected number to be less than ${e.schema.exclusiveMaximum}`;case $.NumberExclusiveMinimum:return`Expected number to be greater than ${e.schema.exclusiveMinimum}`;case $.NumberMaximum:return`Expected number to be less or equal to ${e.schema.maximum}`;case $.NumberMinimum:return`Expected number to be greater or equal to ${e.schema.minimum}`;case $.NumberMultipleOf:return`Expected number to be a multiple of ${e.schema.multipleOf}`;case $.Number:return"Expected number";case $.Object:return"Expected object";case $.ObjectAdditionalProperties:return"Unexpected property";case $.ObjectMaxProperties:return`Expected object to have no more than ${e.schema.maxProperties} properties`;case $.ObjectMinProperties:return`Expected object to have at least ${e.schema.minProperties} properties`;case $.ObjectRequiredProperty:return"Expected required property";case $.Promise:return"Expected Promise";case $.RegExp:return"Expected string to match regular expression";case $.StringFormatUnknown:return`Unknown format '${e.schema.format}'`;case $.StringFormat:return`Expected string to match '${e.schema.format}' format`;case $.StringMaxLength:return`Expected string length less or equal to ${e.schema.maxLength}`;case $.StringMinLength:return`Expected string length greater or equal to ${e.schema.minLength}`;case $.StringPattern:return`Expected string to match '${e.schema.pattern}'`;case $.String:return"Expected string";case $.Symbol:return"Expected symbol";case $.TupleLength:return`Expected tuple to have ${e.schema.maxItems||0} elements`;case $.Tuple:return"Expected tuple";case $.Uint8ArrayMaxByteLength:return`Expected byte length less or equal to ${e.schema.maxByteLength}`;case $.Uint8ArrayMinByteLength:return`Expected byte length greater or equal to ${e.schema.minByteLength}`;case $.Uint8Array:return"Expected Uint8Array";case $.Undefined:return"Expected undefined";case $.Union:return"Expected union value";case $.Void:return"Expected void";case $.Kind:return`Expected kind '${e.schema[R]}'`;default:return"Unknown error type"}}let Ny=Cy;function Ty(){return Ny}class My extends ke{constructor(t){super(`Unable to dereference schema with $id '${t.$ref}'`),this.schema=t}}function Uy(e,t){const r=t.find(n=>n.$id===e.$ref);if(r===void 0)throw new My(e);return He(r,t)}function vr(e,t){return!gt(e.$id)||t.some(r=>r.$id===e.$id)||t.push(e),t}function He(e,t){return e[R]==="This"||e[R]==="Ref"?Uy(e,t):e}class ky extends ke{constructor(t){super("Unable to hash value"),this.value=t}}var Pt;(function(e){e[e.Undefined=0]="Undefined",e[e.Null=1]="Null",e[e.Boolean=2]="Boolean",e[e.Number=3]="Number",e[e.String=4]="String",e[e.Object=5]="Object",e[e.Array=6]="Array",e[e.Date=7]="Date",e[e.Uint8Array=8]="Uint8Array",e[e.Symbol=9]="Symbol",e[e.BigInt=10]="BigInt"})(Pt||(Pt={}));let on=BigInt("14695981039346656037");const[Ly,Dy]=[BigInt("1099511628211"),BigInt("18446744073709551616")],By=Array.from({length:256}).map((e,t)=>BigInt(t)),ru=new Float64Array(1),nu=new DataView(ru.buffer),iu=new Uint8Array(ru.buffer);function*_y(e){const t=e===0?1:Math.ceil(Math.floor(Math.log2(e)+1)/8);for(let r=0;r<t;r++)yield e>>8*(t-1-r)&255}function qy(e){nt(Pt.Array);for(const t of e)ln(t)}function Ky(e){nt(Pt.Boolean),nt(e?1:0)}function Hy(e){nt(Pt.BigInt),nu.setBigInt64(0,e);for(const t of iu)nt(t)}function zy(e){nt(Pt.Date),ln(e.getTime())}function Jy(e){nt(Pt.Null)}function Gy(e){nt(Pt.Number),nu.setFloat64(0,e);for(const t of iu)nt(t)}function Wy(e){nt(Pt.Object);for(const t of globalThis.Object.getOwnPropertyNames(e).sort())ln(t),ln(e[t])}function Yy(e){nt(Pt.String);for(let t=0;t<e.length;t++)for(const r of _y(e.charCodeAt(t)))nt(r)}function Qy(e){nt(Pt.Symbol),ln(e.description)}function Zy(e){nt(Pt.Uint8Array);for(let t=0;t<e.length;t++)nt(e[t])}function Xy(e){return nt(Pt.Undefined)}function ln(e){if(Ee(e))return qy(e);if(Ti(e))return Ky(e);if(sr(e))return Hy(e);if(Wn(e))return zy(e);if(Ni(e))return Jy();if(W(e))return Gy(e);if(Ie(e))return Wy(e);if(gt(e))return Yy(e);if(Ui(e))return Qy(e);if(So(e))return Zy(e);if(Ut(e))return Xy();throw new ky(e)}function nt(e){on=on^By[e],on=on*Ly%Dy}function ls(e){return on=BigInt("14695981039346656037"),ln(e),on}class Vy extends ke{constructor(t){super("Unknown type"),this.schema=t}}function vy(e){return e[R]==="Any"||e[R]==="Unknown"}function V(e){return e!==void 0}function eg(e,t,r){return!0}function tg(e,t,r){return!0}function rg(e,t,r){if(!Ee(r)||V(e.minItems)&&!(r.length>=e.minItems)||V(e.maxItems)&&!(r.length<=e.maxItems)||!r.every(o=>Be(e.items,t,o))||e.uniqueItems===!0&&!function(){const o=new Set;for(const s of r){const c=ls(s);if(o.has(c))return!1;o.add(c)}return!0}())return!1;if(!(V(e.contains)||W(e.minContains)||W(e.maxContains)))return!0;const n=V(e.contains)?e.contains:xe(),i=r.reduce((o,s)=>Be(n,t,s)?o+1:o,0);return!(i===0||W(e.minContains)&&i<e.minContains||W(e.maxContains)&&i>e.maxContains)}function ng(e,t,r){return of(r)}function ig(e,t,r){return!(!sr(r)||V(e.exclusiveMaximum)&&!(r<e.exclusiveMaximum)||V(e.exclusiveMinimum)&&!(r>e.exclusiveMinimum)||V(e.maximum)&&!(r<=e.maximum)||V(e.minimum)&&!(r>=e.minimum)||V(e.multipleOf)&&r%e.multipleOf!==BigInt(0))}function og(e,t,r){return Ti(r)}function sg(e,t,r){return Be(e.returns,t,r.prototype)}function cg(e,t,r){return!(!Wn(r)||V(e.exclusiveMaximumTimestamp)&&!(r.getTime()<e.exclusiveMaximumTimestamp)||V(e.exclusiveMinimumTimestamp)&&!(r.getTime()>e.exclusiveMinimumTimestamp)||V(e.maximumTimestamp)&&!(r.getTime()<=e.maximumTimestamp)||V(e.minimumTimestamp)&&!(r.getTime()>=e.minimumTimestamp)||V(e.multipleOfTimestamp)&&r.getTime()%e.multipleOfTimestamp!==0)}function fg(e,t,r){return Mi(r)}function ug(e,t,r){const n=globalThis.Object.values(e.$defs),i=e.$defs[e.$ref];return Be(i,[...t,...n],r)}function ag(e,t,r){return!(!ff(r)||V(e.exclusiveMaximum)&&!(r<e.exclusiveMaximum)||V(e.exclusiveMinimum)&&!(r>e.exclusiveMinimum)||V(e.maximum)&&!(r<=e.maximum)||V(e.minimum)&&!(r>=e.minimum)||V(e.multipleOf)&&r%e.multipleOf!==0)}function dg(e,t,r){const n=e.allOf.every(i=>Be(i,t,r));if(e.unevaluatedProperties===!1){const i=new RegExp(dn(e)),o=Object.getOwnPropertyNames(r).every(s=>i.test(s));return n&&o}else if(st(e.unevaluatedProperties)){const i=new RegExp(dn(e)),o=Object.getOwnPropertyNames(r).every(s=>i.test(s)||Be(e.unevaluatedProperties,t,r[s]));return n&&o}else return n}function lg(e,t,r){return sf(r)}function mg(e,t,r){return r===e.const}function pg(e,t,r){return!1}function yg(e,t,r){return!Be(e.not,t,r)}function gg(e,t,r){return Ni(r)}function hg(e,t,r){return!(!Pe.IsNumberLike(r)||V(e.exclusiveMaximum)&&!(r<e.exclusiveMaximum)||V(e.exclusiveMinimum)&&!(r>e.exclusiveMinimum)||V(e.minimum)&&!(r>=e.minimum)||V(e.maximum)&&!(r<=e.maximum)||V(e.multipleOf)&&r%e.multipleOf!==0)}function $g(e,t,r){if(!Pe.IsObjectLike(r)||V(e.minProperties)&&!(Object.getOwnPropertyNames(r).length>=e.minProperties)||V(e.maxProperties)&&!(Object.getOwnPropertyNames(r).length<=e.maxProperties))return!1;const n=Object.getOwnPropertyNames(e.properties);for(const i of n){const o=e.properties[i];if(e.required&&e.required.includes(i)){if(!Be(o,t,r[i])||(Fn(o)||vy(o))&&!(i in r))return!1}else if(Pe.IsExactOptionalProperty(r,i)&&!Be(o,t,r[i]))return!1}if(e.additionalProperties===!1){const i=Object.getOwnPropertyNames(r);return e.required&&e.required.length===n.length&&i.length===n.length?!0:i.every(o=>n.includes(o))}else return typeof e.additionalProperties=="object"?Object.getOwnPropertyNames(r).every(o=>n.includes(o)||Be(e.additionalProperties,t,r[o])):!0}function bg(e,t,r){return cf(r)}function Og(e,t,r){if(!Pe.IsRecordLike(r)||V(e.minProperties)&&!(Object.getOwnPropertyNames(r).length>=e.minProperties)||V(e.maxProperties)&&!(Object.getOwnPropertyNames(r).length<=e.maxProperties))return!1;const[n,i]=Object.entries(e.patternProperties)[0],o=new RegExp(n),s=Object.entries(r).every(([f,p])=>o.test(f)?Be(i,t,p):!0),c=typeof e.additionalProperties=="object"?Object.entries(r).every(([f,p])=>o.test(f)?!0:Be(e.additionalProperties,t,p)):!0,u=e.additionalProperties===!1?Object.getOwnPropertyNames(r).every(f=>o.test(f)):!0;return s&&c&&u}function xg(e,t,r){return Be(He(e,t),t,r)}function wg(e,t,r){const n=new RegExp(e.source,e.flags);return V(e.minLength)&&!(r.length>=e.minLength)||V(e.maxLength)&&!(r.length<=e.maxLength)?!1:n.test(r)}function Rg(e,t,r){return!gt(r)||V(e.minLength)&&!(r.length>=e.minLength)||V(e.maxLength)&&!(r.length<=e.maxLength)||V(e.pattern)&&!new RegExp(e.pattern).test(r)?!1:V(e.format)?Xt(e.format)?_o(e.format)(r):!1:!0}function Ig(e,t,r){return Ui(r)}function Fg(e,t,r){return gt(r)&&new RegExp(e.pattern).test(r)}function Ag(e,t,r){return Be(He(e,t),t,r)}function Pg(e,t,r){if(!Ee(r)||e.items===void 0&&r.length!==0||r.length!==e.maxItems)return!1;if(!e.items)return!0;for(let n=0;n<e.items.length;n++)if(!Be(e.items[n],t,r[n]))return!1;return!0}function Sg(e,t,r){return Ut(r)}function jg(e,t,r){return e.anyOf.some(n=>Be(n,t,r))}function Eg(e,t,r){return!(!So(r)||V(e.maxByteLength)&&!(r.length<=e.maxByteLength)||V(e.minByteLength)&&!(r.length>=e.minByteLength))}function Cg(e,t,r){return!0}function Ng(e,t,r){return Pe.IsVoidLike(r)}function Tg(e,t,r){return Rr(e[R])?Ko(e[R])(e,r):!1}function Be(e,t,r){const n=V(e.$id)?vr(e,t):t,i=e;switch(i[R]){case"Any":return eg();case"Argument":return tg();case"Array":return rg(i,n,r);case"AsyncIterator":return ng(i,n,r);case"BigInt":return ig(i,n,r);case"Boolean":return og(i,n,r);case"Constructor":return sg(i,n,r);case"Date":return cg(i,n,r);case"Function":return fg(i,n,r);case"Import":return ug(i,n,r);case"Integer":return ag(i,n,r);case"Intersect":return dg(i,n,r);case"Iterator":return lg(i,n,r);case"Literal":return mg(i,n,r);case"Never":return pg();case"Not":return yg(i,n,r);case"Null":return gg(i,n,r);case"Number":return hg(i,n,r);case"Object":return $g(i,n,r);case"Promise":return bg(i,n,r);case"Record":return Og(i,n,r);case"Ref":return xg(i,n,r);case"RegExp":return wg(i,n,r);case"String":return Rg(i,n,r);case"Symbol":return Ig(i,n,r);case"TemplateLiteral":return Fg(i,n,r);case"This":return Ag(i,n,r);case"Tuple":return Pg(i,n,r);case"Undefined":return Sg(i,n,r);case"Union":return jg(i,n,r);case"Uint8Array":return Eg(i,n,r);case"Unknown":return Cg();case"Void":return Ng(i,n,r);default:if(!Rr(i[R]))throw new Vy(i);return Tg(i,n,r)}}function ge(...e){return e.length===3?Be(e[0],e[1],e[2]):Be(e[0],[],e[1])}var $;(function(e){e[e.ArrayContains=0]="ArrayContains",e[e.ArrayMaxContains=1]="ArrayMaxContains",e[e.ArrayMaxItems=2]="ArrayMaxItems",e[e.ArrayMinContains=3]="ArrayMinContains",e[e.ArrayMinItems=4]="ArrayMinItems",e[e.ArrayUniqueItems=5]="ArrayUniqueItems",e[e.Array=6]="Array",e[e.AsyncIterator=7]="AsyncIterator",e[e.BigIntExclusiveMaximum=8]="BigIntExclusiveMaximum",e[e.BigIntExclusiveMinimum=9]="BigIntExclusiveMinimum",e[e.BigIntMaximum=10]="BigIntMaximum",e[e.BigIntMinimum=11]="BigIntMinimum",e[e.BigIntMultipleOf=12]="BigIntMultipleOf",e[e.BigInt=13]="BigInt",e[e.Boolean=14]="Boolean",e[e.DateExclusiveMaximumTimestamp=15]="DateExclusiveMaximumTimestamp",e[e.DateExclusiveMinimumTimestamp=16]="DateExclusiveMinimumTimestamp",e[e.DateMaximumTimestamp=17]="DateMaximumTimestamp",e[e.DateMinimumTimestamp=18]="DateMinimumTimestamp",e[e.DateMultipleOfTimestamp=19]="DateMultipleOfTimestamp",e[e.Date=20]="Date",e[e.Function=21]="Function",e[e.IntegerExclusiveMaximum=22]="IntegerExclusiveMaximum",e[e.IntegerExclusiveMinimum=23]="IntegerExclusiveMinimum",e[e.IntegerMaximum=24]="IntegerMaximum",e[e.IntegerMinimum=25]="IntegerMinimum",e[e.IntegerMultipleOf=26]="IntegerMultipleOf",e[e.Integer=27]="Integer",e[e.IntersectUnevaluatedProperties=28]="IntersectUnevaluatedProperties",e[e.Intersect=29]="Intersect",e[e.Iterator=30]="Iterator",e[e.Kind=31]="Kind",e[e.Literal=32]="Literal",e[e.Never=33]="Never",e[e.Not=34]="Not",e[e.Null=35]="Null",e[e.NumberExclusiveMaximum=36]="NumberExclusiveMaximum",e[e.NumberExclusiveMinimum=37]="NumberExclusiveMinimum",e[e.NumberMaximum=38]="NumberMaximum",e[e.NumberMinimum=39]="NumberMinimum",e[e.NumberMultipleOf=40]="NumberMultipleOf",e[e.Number=41]="Number",e[e.ObjectAdditionalProperties=42]="ObjectAdditionalProperties",e[e.ObjectMaxProperties=43]="ObjectMaxProperties",e[e.ObjectMinProperties=44]="ObjectMinProperties",e[e.ObjectRequiredProperty=45]="ObjectRequiredProperty",e[e.Object=46]="Object",e[e.Promise=47]="Promise",e[e.RegExp=48]="RegExp",e[e.StringFormatUnknown=49]="StringFormatUnknown",e[e.StringFormat=50]="StringFormat",e[e.StringMaxLength=51]="StringMaxLength",e[e.StringMinLength=52]="StringMinLength",e[e.StringPattern=53]="StringPattern",e[e.String=54]="String",e[e.Symbol=55]="Symbol",e[e.TupleLength=56]="TupleLength",e[e.Tuple=57]="Tuple",e[e.Uint8ArrayMaxByteLength=58]="Uint8ArrayMaxByteLength",e[e.Uint8ArrayMinByteLength=59]="Uint8ArrayMinByteLength",e[e.Uint8Array=60]="Uint8Array",e[e.Undefined=61]="Undefined",e[e.Union=62]="Union",e[e.Void=63]="Void"})($||($={}));class Mg extends ke{constructor(t){super("Unknown type"),this.schema=t}}function or(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}function X(e){return e!==void 0}class ou{constructor(t){this.iterator=t}[Symbol.iterator](){return this.iterator}First(){const t=this.iterator.next();return t.done?void 0:t.value}}function j(e,t,r,n,i=[]){return{type:e,schema:t,path:r,value:n,message:Ty()({errorType:e,path:r,schema:t,value:n,errors:i}),errors:i}}function*Ug(e,t,r,n){}function*kg(e,t,r,n){}function*Lg(e,t,r,n){if(!Ee(n))return yield j($.Array,e,r,n);X(e.minItems)&&!(n.length>=e.minItems)&&(yield j($.ArrayMinItems,e,r,n)),X(e.maxItems)&&!(n.length<=e.maxItems)&&(yield j($.ArrayMaxItems,e,r,n));for(let s=0;s<n.length;s++)yield*_e(e.items,t,`${r}/${s}`,n[s]);if(e.uniqueItems===!0&&!function(){const s=new Set;for(const c of n){const u=ls(c);if(s.has(u))return!1;s.add(u)}return!0}()&&(yield j($.ArrayUniqueItems,e,r,n)),!(X(e.contains)||X(e.minContains)||X(e.maxContains)))return;const i=X(e.contains)?e.contains:xe(),o=n.reduce((s,c,u)=>_e(i,t,`${r}${u}`,c).next().done===!0?s+1:s,0);o===0&&(yield j($.ArrayContains,e,r,n)),W(e.minContains)&&o<e.minContains&&(yield j($.ArrayMinContains,e,r,n)),W(e.maxContains)&&o>e.maxContains&&(yield j($.ArrayMaxContains,e,r,n))}function*Dg(e,t,r,n){of(n)||(yield j($.AsyncIterator,e,r,n))}function*Bg(e,t,r,n){if(!sr(n))return yield j($.BigInt,e,r,n);X(e.exclusiveMaximum)&&!(n<e.exclusiveMaximum)&&(yield j($.BigIntExclusiveMaximum,e,r,n)),X(e.exclusiveMinimum)&&!(n>e.exclusiveMinimum)&&(yield j($.BigIntExclusiveMinimum,e,r,n)),X(e.maximum)&&!(n<=e.maximum)&&(yield j($.BigIntMaximum,e,r,n)),X(e.minimum)&&!(n>=e.minimum)&&(yield j($.BigIntMinimum,e,r,n)),X(e.multipleOf)&&n%e.multipleOf!==BigInt(0)&&(yield j($.BigIntMultipleOf,e,r,n))}function*_g(e,t,r,n){Ti(n)||(yield j($.Boolean,e,r,n))}function*qg(e,t,r,n){yield*_e(e.returns,t,r,n.prototype)}function*Kg(e,t,r,n){if(!Wn(n))return yield j($.Date,e,r,n);X(e.exclusiveMaximumTimestamp)&&!(n.getTime()<e.exclusiveMaximumTimestamp)&&(yield j($.DateExclusiveMaximumTimestamp,e,r,n)),X(e.exclusiveMinimumTimestamp)&&!(n.getTime()>e.exclusiveMinimumTimestamp)&&(yield j($.DateExclusiveMinimumTimestamp,e,r,n)),X(e.maximumTimestamp)&&!(n.getTime()<=e.maximumTimestamp)&&(yield j($.DateMaximumTimestamp,e,r,n)),X(e.minimumTimestamp)&&!(n.getTime()>=e.minimumTimestamp)&&(yield j($.DateMinimumTimestamp,e,r,n)),X(e.multipleOfTimestamp)&&n.getTime()%e.multipleOfTimestamp!==0&&(yield j($.DateMultipleOfTimestamp,e,r,n))}function*Hg(e,t,r,n){Mi(n)||(yield j($.Function,e,r,n))}function*zg(e,t,r,n){const i=globalThis.Object.values(e.$defs),o=e.$defs[e.$ref];yield*_e(o,[...t,...i],r,n)}function*Jg(e,t,r,n){if(!ff(n))return yield j($.Integer,e,r,n);X(e.exclusiveMaximum)&&!(n<e.exclusiveMaximum)&&(yield j($.IntegerExclusiveMaximum,e,r,n)),X(e.exclusiveMinimum)&&!(n>e.exclusiveMinimum)&&(yield j($.IntegerExclusiveMinimum,e,r,n)),X(e.maximum)&&!(n<=e.maximum)&&(yield j($.IntegerMaximum,e,r,n)),X(e.minimum)&&!(n>=e.minimum)&&(yield j($.IntegerMinimum,e,r,n)),X(e.multipleOf)&&n%e.multipleOf!==0&&(yield j($.IntegerMultipleOf,e,r,n))}function*Gg(e,t,r,n){let i=!1;for(const o of e.allOf)for(const s of _e(o,t,r,n))i=!0,yield s;if(i)return yield j($.Intersect,e,r,n);if(e.unevaluatedProperties===!1){const o=new RegExp(dn(e));for(const s of Object.getOwnPropertyNames(n))o.test(s)||(yield j($.IntersectUnevaluatedProperties,e,`${r}/${s}`,n))}if(typeof e.unevaluatedProperties=="object"){const o=new RegExp(dn(e));for(const s of Object.getOwnPropertyNames(n))if(!o.test(s)){const c=_e(e.unevaluatedProperties,t,`${r}/${s}`,n[s]).next();c.done||(yield c.value)}}}function*Wg(e,t,r,n){sf(n)||(yield j($.Iterator,e,r,n))}function*Yg(e,t,r,n){n!==e.const&&(yield j($.Literal,e,r,n))}function*Qg(e,t,r,n){yield j($.Never,e,r,n)}function*Zg(e,t,r,n){_e(e.not,t,r,n).next().done===!0&&(yield j($.Not,e,r,n))}function*Xg(e,t,r,n){Ni(n)||(yield j($.Null,e,r,n))}function*Vg(e,t,r,n){if(!Pe.IsNumberLike(n))return yield j($.Number,e,r,n);X(e.exclusiveMaximum)&&!(n<e.exclusiveMaximum)&&(yield j($.NumberExclusiveMaximum,e,r,n)),X(e.exclusiveMinimum)&&!(n>e.exclusiveMinimum)&&(yield j($.NumberExclusiveMinimum,e,r,n)),X(e.maximum)&&!(n<=e.maximum)&&(yield j($.NumberMaximum,e,r,n)),X(e.minimum)&&!(n>=e.minimum)&&(yield j($.NumberMinimum,e,r,n)),X(e.multipleOf)&&n%e.multipleOf!==0&&(yield j($.NumberMultipleOf,e,r,n))}function*vg(e,t,r,n){if(!Pe.IsObjectLike(n))return yield j($.Object,e,r,n);X(e.minProperties)&&!(Object.getOwnPropertyNames(n).length>=e.minProperties)&&(yield j($.ObjectMinProperties,e,r,n)),X(e.maxProperties)&&!(Object.getOwnPropertyNames(n).length<=e.maxProperties)&&(yield j($.ObjectMaxProperties,e,r,n));const i=Array.isArray(e.required)?e.required:[],o=Object.getOwnPropertyNames(e.properties),s=Object.getOwnPropertyNames(n);for(const c of i)s.includes(c)||(yield j($.ObjectRequiredProperty,e.properties[c],`${r}/${or(c)}`,void 0));if(e.additionalProperties===!1)for(const c of s)o.includes(c)||(yield j($.ObjectAdditionalProperties,e,`${r}/${or(c)}`,n[c]));if(typeof e.additionalProperties=="object")for(const c of s)o.includes(c)||(yield*_e(e.additionalProperties,t,`${r}/${or(c)}`,n[c]));for(const c of o){const u=e.properties[c];e.required&&e.required.includes(c)?(yield*_e(u,t,`${r}/${or(c)}`,n[c]),Fn(e)&&!(c in n)&&(yield j($.ObjectRequiredProperty,u,`${r}/${or(c)}`,void 0))):Pe.IsExactOptionalProperty(n,c)&&(yield*_e(u,t,`${r}/${or(c)}`,n[c]))}}function*eh(e,t,r,n){cf(n)||(yield j($.Promise,e,r,n))}function*th(e,t,r,n){if(!Pe.IsRecordLike(n))return yield j($.Object,e,r,n);X(e.minProperties)&&!(Object.getOwnPropertyNames(n).length>=e.minProperties)&&(yield j($.ObjectMinProperties,e,r,n)),X(e.maxProperties)&&!(Object.getOwnPropertyNames(n).length<=e.maxProperties)&&(yield j($.ObjectMaxProperties,e,r,n));const[i,o]=Object.entries(e.patternProperties)[0],s=new RegExp(i);for(const[c,u]of Object.entries(n))s.test(c)&&(yield*_e(o,t,`${r}/${or(c)}`,u));if(typeof e.additionalProperties=="object")for(const[c,u]of Object.entries(n))s.test(c)||(yield*_e(e.additionalProperties,t,`${r}/${or(c)}`,u));if(e.additionalProperties===!1){for(const[c,u]of Object.entries(n))if(!s.test(c))return yield j($.ObjectAdditionalProperties,e,`${r}/${or(c)}`,u)}}function*rh(e,t,r,n){yield*_e(He(e,t),t,r,n)}function*nh(e,t,r,n){if(!gt(n))return yield j($.String,e,r,n);if(X(e.minLength)&&!(n.length>=e.minLength)&&(yield j($.StringMinLength,e,r,n)),X(e.maxLength)&&!(n.length<=e.maxLength)&&(yield j($.StringMaxLength,e,r,n)),!new RegExp(e.source,e.flags).test(n))return yield j($.RegExp,e,r,n)}function*ih(e,t,r,n){if(!gt(n))return yield j($.String,e,r,n);X(e.minLength)&&!(n.length>=e.minLength)&&(yield j($.StringMinLength,e,r,n)),X(e.maxLength)&&!(n.length<=e.maxLength)&&(yield j($.StringMaxLength,e,r,n)),gt(e.pattern)&&(new RegExp(e.pattern).test(n)||(yield j($.StringPattern,e,r,n))),gt(e.format)&&(Xt(e.format)?_o(e.format)(n)||(yield j($.StringFormat,e,r,n)):yield j($.StringFormatUnknown,e,r,n))}function*oh(e,t,r,n){Ui(n)||(yield j($.Symbol,e,r,n))}function*sh(e,t,r,n){if(!gt(n))return yield j($.String,e,r,n);new RegExp(e.pattern).test(n)||(yield j($.StringPattern,e,r,n))}function*ch(e,t,r,n){yield*_e(He(e,t),t,r,n)}function*fh(e,t,r,n){if(!Ee(n))return yield j($.Tuple,e,r,n);if(e.items===void 0&&n.length!==0)return yield j($.TupleLength,e,r,n);if(n.length!==e.maxItems)return yield j($.TupleLength,e,r,n);if(e.items)for(let i=0;i<e.items.length;i++)yield*_e(e.items[i],t,`${r}/${i}`,n[i])}function*uh(e,t,r,n){Ut(n)||(yield j($.Undefined,e,r,n))}function*ah(e,t,r,n){if(ge(e,t,n))return;const i=e.anyOf.map(o=>new ou(_e(o,t,r,n)));yield j($.Union,e,r,n,i)}function*dh(e,t,r,n){if(!So(n))return yield j($.Uint8Array,e,r,n);X(e.maxByteLength)&&!(n.length<=e.maxByteLength)&&(yield j($.Uint8ArrayMaxByteLength,e,r,n)),X(e.minByteLength)&&!(n.length>=e.minByteLength)&&(yield j($.Uint8ArrayMinByteLength,e,r,n))}function*lh(e,t,r,n){}function*mh(e,t,r,n){Pe.IsVoidLike(n)||(yield j($.Void,e,r,n))}function*ph(e,t,r,n){Ko(e[R])(e,n)||(yield j($.Kind,e,r,n))}function*_e(e,t,r,n){const i=X(e.$id)?[...t,e]:t,o=e;switch(o[R]){case"Any":return yield*Ug();case"Argument":return yield*kg();case"Array":return yield*Lg(o,i,r,n);case"AsyncIterator":return yield*Dg(o,i,r,n);case"BigInt":return yield*Bg(o,i,r,n);case"Boolean":return yield*_g(o,i,r,n);case"Constructor":return yield*qg(o,i,r,n);case"Date":return yield*Kg(o,i,r,n);case"Function":return yield*Hg(o,i,r,n);case"Import":return yield*zg(o,i,r,n);case"Integer":return yield*Jg(o,i,r,n);case"Intersect":return yield*Gg(o,i,r,n);case"Iterator":return yield*Wg(o,i,r,n);case"Literal":return yield*Yg(o,i,r,n);case"Never":return yield*Qg(o,i,r,n);case"Not":return yield*Zg(o,i,r,n);case"Null":return yield*Xg(o,i,r,n);case"Number":return yield*Vg(o,i,r,n);case"Object":return yield*vg(o,i,r,n);case"Promise":return yield*eh(o,i,r,n);case"Record":return yield*th(o,i,r,n);case"Ref":return yield*rh(o,i,r,n);case"RegExp":return yield*nh(o,i,r,n);case"String":return yield*ih(o,i,r,n);case"Symbol":return yield*oh(o,i,r,n);case"TemplateLiteral":return yield*sh(o,i,r,n);case"This":return yield*ch(o,i,r,n);case"Tuple":return yield*fh(o,i,r,n);case"Undefined":return yield*uh(o,i,r,n);case"Union":return yield*ah(o,i,r,n);case"Uint8Array":return yield*dh(o,i,r,n);case"Unknown":return yield*lh();case"Void":return yield*mh(o,i,r,n);default:if(!Rr(o[R]))throw new Mg(e);return yield*ph(o,i,r,n)}}function wr(...e){const t=e.length===3?_e(e[0],e[1],"",e[2]):_e(e[0],[],"",e[1]);return new ou(t)}class su extends ke{constructor(t,r,n){super("Unable to decode value as it does not match the expected schema"),this.schema=t,this.value=r,this.error=n}}class cu extends ke{constructor(t,r,n,i){super(i instanceof Error?i.message:"Unknown error"),this.schema=t,this.path=r,this.value=n,this.error=i}}function he(e,t,r){try{return pe(e)?e[rt].Decode(r):r}catch(n){throw new cu(e,t,r,n)}}function yh(e,t,r,n){return Ee(n)?he(e,r,n.map((i,o)=>Vt(e.items,t,`${r}/${o}`,i))):he(e,r,n)}function gh(e,t,r,n){if(!Ie(n)||jo(n))return he(e,r,n);const i=Uf(e),o=i.map(p=>p[0]),s={...n};for(const[p,m]of i)p in s&&(s[p]=Vt(m,t,`${r}/${p}`,s[p]));if(!pe(e.unevaluatedProperties))return he(e,r,s);const c=Object.getOwnPropertyNames(s),u=e.unevaluatedProperties,f={...s};for(const p of c)o.includes(p)||(f[p]=he(u,`${r}/${p}`,f[p]));return he(e,r,f)}function hh(e,t,r,n){const i=globalThis.Object.values(e.$defs),o=e.$defs[e.$ref],s=Vt(o,[...t,...i],r,n);return he(e,r,s)}function $h(e,t,r,n){return he(e,r,Vt(e.not,t,r,n))}function bh(e,t,r,n){if(!Ie(n))return he(e,r,n);const i=Cr(e),o={...n};for(const f of i)Q(o,f)&&(Ut(o[f])&&(!Vn(e.properties[f])||Pe.IsExactOptionalProperty(o,f))||(o[f]=Vt(e.properties[f],t,`${r}/${f}`,o[f])));if(!st(e.additionalProperties))return he(e,r,o);const s=Object.getOwnPropertyNames(o),c=e.additionalProperties,u={...o};for(const f of s)i.includes(f)||(u[f]=he(c,`${r}/${f}`,u[f]));return he(e,r,u)}function Oh(e,t,r,n){if(!Ie(n))return he(e,r,n);const i=Object.getOwnPropertyNames(e.patternProperties)[0],o=new RegExp(i),s={...n};for(const p of Object.getOwnPropertyNames(n))o.test(p)&&(s[p]=Vt(e.patternProperties[i],t,`${r}/${p}`,s[p]));if(!st(e.additionalProperties))return he(e,r,s);const c=Object.getOwnPropertyNames(s),u=e.additionalProperties,f={...s};for(const p of c)o.test(p)||(f[p]=he(u,`${r}/${p}`,f[p]));return he(e,r,f)}function xh(e,t,r,n){const i=He(e,t);return he(e,r,Vt(i,t,r,n))}function wh(e,t,r,n){const i=He(e,t);return he(e,r,Vt(i,t,r,n))}function Rh(e,t,r,n){return Ee(n)&&Ee(e.items)?he(e,r,e.items.map((i,o)=>Vt(i,t,`${r}/${o}`,n[o]))):he(e,r,n)}function Ih(e,t,r,n){for(const i of e.anyOf){if(!ge(i,t,n))continue;const o=Vt(i,t,r,n);return he(e,r,o)}return he(e,r,n)}function Vt(e,t,r,n){const i=vr(e,t),o=e;switch(e[R]){case"Array":return yh(o,i,r,n);case"Import":return hh(o,i,r,n);case"Intersect":return gh(o,i,r,n);case"Not":return $h(o,i,r,n);case"Object":return bh(o,i,r,n);case"Record":return Oh(o,i,r,n);case"Ref":return xh(o,i,r,n);case"Symbol":return he(o,r,n);case"This":return wh(o,i,r,n);case"Tuple":return Rh(o,i,r,n);case"Union":return Ih(o,i,r,n);default:return he(o,r,n)}}function fu(e,t,r){return Vt(e,t,"",r)}class uu extends ke{constructor(t,r,n){super("The encoded value does not match the expected schema"),this.schema=t,this.value=r,this.error=n}}class Fh extends ke{constructor(t,r,n,i){super(`${i instanceof Error?i.message:"Unknown error"}`),this.schema=t,this.path=r,this.value=n,this.error=i}}function Qe(e,t,r){try{return pe(e)?e[rt].Encode(r):r}catch(n){throw new Fh(e,t,r,n)}}function Ah(e,t,r,n){const i=Qe(e,r,n);return Ee(i)?i.map((o,s)=>Yt(e.items,t,`${r}/${s}`,o)):i}function Ph(e,t,r,n){const i=globalThis.Object.values(e.$defs),o=e.$defs[e.$ref],s=Qe(e,r,n);return Yt(o,[...t,...i],r,s)}function Sh(e,t,r,n){const i=Qe(e,r,n);if(!Ie(n)||jo(n))return i;const o=Uf(e),s=o.map(m=>m[0]),c={...i};for(const[m,g]of o)m in c&&(c[m]=Yt(g,t,`${r}/${m}`,c[m]));if(!pe(e.unevaluatedProperties))return c;const u=Object.getOwnPropertyNames(c),f=e.unevaluatedProperties,p={...c};for(const m of u)s.includes(m)||(p[m]=Qe(f,`${r}/${m}`,p[m]));return p}function jh(e,t,r,n){return Qe(e.not,r,Qe(e,r,n))}function Eh(e,t,r,n){const i=Qe(e,r,n);if(!Ie(i))return i;const o=Cr(e),s={...i};for(const p of o)Q(s,p)&&(Ut(s[p])&&(!Vn(e.properties[p])||Pe.IsExactOptionalProperty(s,p))||(s[p]=Yt(e.properties[p],t,`${r}/${p}`,s[p])));if(!st(e.additionalProperties))return s;const c=Object.getOwnPropertyNames(s),u=e.additionalProperties,f={...s};for(const p of c)o.includes(p)||(f[p]=Qe(u,`${r}/${p}`,f[p]));return f}function Ch(e,t,r,n){const i=Qe(e,r,n);if(!Ie(n))return i;const o=Object.getOwnPropertyNames(e.patternProperties)[0],s=new RegExp(o),c={...i};for(const m of Object.getOwnPropertyNames(n))s.test(m)&&(c[m]=Yt(e.patternProperties[o],t,`${r}/${m}`,c[m]));if(!st(e.additionalProperties))return c;const u=Object.getOwnPropertyNames(c),f=e.additionalProperties,p={...c};for(const m of u)s.test(m)||(p[m]=Qe(f,`${r}/${m}`,p[m]));return p}function Nh(e,t,r,n){const i=He(e,t),o=Yt(i,t,r,n);return Qe(e,r,o)}function Th(e,t,r,n){const i=He(e,t),o=Yt(i,t,r,n);return Qe(e,r,o)}function Mh(e,t,r,n){const i=Qe(e,r,n);return Ee(e.items)?e.items.map((o,s)=>Yt(o,t,`${r}/${s}`,i[s])):[]}function Uh(e,t,r,n){for(const i of e.anyOf){if(!ge(i,t,n))continue;const o=Yt(i,t,r,n);return Qe(e,r,o)}for(const i of e.anyOf){const o=Yt(i,t,r,n);if(ge(e,t,o))return Qe(e,r,o)}return Qe(e,r,n)}function Yt(e,t,r,n){const i=vr(e,t),o=e;switch(e[R]){case"Array":return Ah(o,i,r,n);case"Import":return Ph(o,i,r,n);case"Intersect":return Sh(o,i,r,n);case"Not":return jh(o,i,r,n);case"Object":return Eh(o,i,r,n);case"Record":return Ch(o,i,r,n);case"Ref":return Nh(o,i,r,n);case"This":return Th(o,i,r,n);case"Tuple":return Mh(o,i,r,n);case"Union":return Uh(o,i,r,n);default:return Qe(o,r,n)}}function au(e,t,r){return Yt(e,t,"",r)}function kh(e,t){return pe(e)||Ue(e.items,t)}function Lh(e,t){return pe(e)||Ue(e.items,t)}function Dh(e,t){return pe(e)||Ue(e.returns,t)||e.parameters.some(r=>Ue(r,t))}function Bh(e,t){return pe(e)||Ue(e.returns,t)||e.parameters.some(r=>Ue(r,t))}function _h(e,t){return pe(e)||pe(e.unevaluatedProperties)||e.allOf.some(r=>Ue(r,t))}function qh(e,t){const r=globalThis.Object.getOwnPropertyNames(e.$defs).reduce((i,o)=>[...i,e.$defs[o]],[]),n=e.$defs[e.$ref];return pe(e)||Ue(n,[...r,...t])}function Kh(e,t){return pe(e)||Ue(e.items,t)}function Hh(e,t){return pe(e)||Ue(e.not,t)}function zh(e,t){return pe(e)||Object.values(e.properties).some(r=>Ue(r,t))||st(e.additionalProperties)&&Ue(e.additionalProperties,t)}function Jh(e,t){return pe(e)||Ue(e.item,t)}function Gh(e,t){const r=Object.getOwnPropertyNames(e.patternProperties)[0],n=e.patternProperties[r];return pe(e)||Ue(n,t)||st(e.additionalProperties)&&pe(e.additionalProperties)}function Wh(e,t){return pe(e)?!0:Ue(He(e,t),t)}function Yh(e,t){return pe(e)?!0:Ue(He(e,t),t)}function Qh(e,t){return pe(e)||!Ut(e.items)&&e.items.some(r=>Ue(r,t))}function Zh(e,t){return pe(e)||e.anyOf.some(r=>Ue(r,t))}function Ue(e,t){const r=vr(e,t),n=e;if(e.$id&&bo.has(e.$id))return!1;switch(e.$id&&bo.add(e.$id),e[R]){case"Array":return kh(n,r);case"AsyncIterator":return Lh(n,r);case"Constructor":return Dh(n,r);case"Function":return Bh(n,r);case"Import":return qh(n,r);case"Intersect":return _h(n,r);case"Iterator":return Kh(n,r);case"Not":return Hh(n,r);case"Object":return zh(n,r);case"Promise":return Jh(n,r);case"Record":return Gh(n,r);case"Ref":return Wh(n,r);case"This":return Yh(n,r);case"Tuple":return Qh(n,r);case"Union":return Zh(n,r);default:return pe(e)}}const bo=new Set;function ms(e,t){return bo.clear(),Ue(e,t)}class Xh{constructor(t,r,n,i){this.schema=t,this.references=r,this.checkFunc=n,this.code=i,this.hasTransform=ms(t,r)}Code(){return this.code}Schema(){return this.schema}References(){return this.references}Errors(t){return wr(this.schema,this.references,t)}Check(t){return this.checkFunc(t)}Decode(t){if(!this.checkFunc(t))throw new su(this.schema,t,this.Errors(t).First());return this.hasTransform?fu(this.schema,this.references,t):t}Encode(t){const r=this.hasTransform?au(this.schema,this.references,t):t;if(!this.checkFunc(r))throw new uu(this.schema,t,this.Errors(t).First());return r}}var cr;(function(e){function t(o){return o===36}e.DollarSign=t;function r(o){return o===95}e.IsUnderscore=r;function n(o){return o>=65&&o<=90||o>=97&&o<=122}e.IsAlpha=n;function i(o){return o>=48&&o<=57}e.IsNumeric=i})(cr||(cr={}));var Ai;(function(e){function t(o){return o.length===0?!1:cr.IsNumeric(o.charCodeAt(0))}function r(o){if(t(o))return!1;for(let s=0;s<o.length;s++){const c=o.charCodeAt(s);if(!(cr.IsAlpha(c)||cr.IsNumeric(c)||cr.DollarSign(c)||cr.IsUnderscore(c)))return!1}return!0}function n(o){return o.replace(/'/g,"\\'")}function i(o,s){return r(s)?`${o}.${s}`:`${o}['${n(s)}']`}e.Encode=i})(Ai||(Ai={}));var Oo;(function(e){function t(r){const n=[];for(let i=0;i<r.length;i++){const o=r.charCodeAt(i);cr.IsNumeric(o)||cr.IsAlpha(o)?n.push(r.charAt(i)):n.push(`_${o}_`)}return n.join("").replace(/__/g,"_")}e.Encode=t})(Oo||(Oo={}));var xo;(function(e){function t(r){return r.replace(/'/g,"\\'")}e.Escape=t})(xo||(xo={}));class Vh extends ke{constructor(t){super("Unknown type"),this.schema=t}}class Ac extends ke{constructor(t){super("Preflight validation check failed to guard for the given schema"),this.schema=t}}var Ur;(function(e){function t(s,c,u){return Pe.ExactOptionalPropertyTypes?`('${c}' in ${s} ? ${u} : true)`:`(${Ai.Encode(s,c)} !== undefined ? ${u} : true)`}e.IsExactOptionalProperty=t;function r(s){return Pe.AllowArrayObject?`(typeof ${s} === 'object' && ${s} !== null)`:`(typeof ${s} === 'object' && ${s} !== null && !Array.isArray(${s}))`}e.IsObjectLike=r;function n(s){return Pe.AllowArrayObject?`(typeof ${s} === 'object' && ${s} !== null && !(${s} instanceof Date) && !(${s} instanceof Uint8Array))`:`(typeof ${s} === 'object' && ${s} !== null && !Array.isArray(${s}) && !(${s} instanceof Date) && !(${s} instanceof Uint8Array))`}e.IsRecordLike=n;function i(s){return Pe.AllowNaN?`typeof ${s} === 'number'`:`Number.isFinite(${s})`}e.IsNumberLike=i;function o(s){return Pe.AllowNullVoid?`(${s} === undefined || ${s} === null)`:`${s} === undefined`}e.IsVoidLike=o})(Ur||(Ur={}));var mn;(function(e){function t(d){return d[R]==="Any"||d[R]==="Unknown"}function*r(d,S,y){yield"true"}function*n(d,S,y){yield"true"}function*i(d,S,y){yield`Array.isArray(${y})`;const[K,C]=[q("value","any"),q("acc","number")];W(d.maxItems)&&(yield`${y}.length <= ${d.maxItems}`),W(d.minItems)&&(yield`${y}.length >= ${d.minItems}`);const M=Je(d.items,S,"value");if(yield`${y}.every((${K}) => ${M})`,be(d.contains)||W(d.minContains)||W(d.maxContains)){const se=be(d.contains)?d.contains:xe(),Ge=Je(se,S,"value"),jt=W(d.minContains)?[`(count >= ${d.minContains})`]:[],at=W(d.maxContains)?[`(count <= ${d.maxContains})`]:[],wt=`const count = value.reduce((${C}, ${K}) => ${Ge} ? acc + 1 : acc, 0)`,Nr=["(count > 0)",...jt,...at].join(" && ");yield`((${K}) => { ${wt}; return ${Nr}})(${y})`}d.uniqueItems===!0&&(yield`((${K}) => { const set = new Set(); for(const element of value) { const hashed = hash(element); if(set.has(hashed)) { return false } else { set.add(hashed) } } return true } )(${y})`)}function*o(d,S,y){yield`(typeof value === 'object' && Symbol.asyncIterator in ${y})`}function*s(d,S,y){yield`(typeof ${y} === 'bigint')`,sr(d.exclusiveMaximum)&&(yield`${y} < BigInt(${d.exclusiveMaximum})`),sr(d.exclusiveMinimum)&&(yield`${y} > BigInt(${d.exclusiveMinimum})`),sr(d.maximum)&&(yield`${y} <= BigInt(${d.maximum})`),sr(d.minimum)&&(yield`${y} >= BigInt(${d.minimum})`),sr(d.multipleOf)&&(yield`(${y} % BigInt(${d.multipleOf})) === 0`)}function*c(d,S,y){yield`(typeof ${y} === 'boolean')`}function*u(d,S,y){yield*ie(d.returns,S,`${y}.prototype`)}function*f(d,S,y){yield`(${y} instanceof Date) && Number.isFinite(${y}.getTime())`,W(d.exclusiveMaximumTimestamp)&&(yield`${y}.getTime() < ${d.exclusiveMaximumTimestamp}`),W(d.exclusiveMinimumTimestamp)&&(yield`${y}.getTime() > ${d.exclusiveMinimumTimestamp}`),W(d.maximumTimestamp)&&(yield`${y}.getTime() <= ${d.maximumTimestamp}`),W(d.minimumTimestamp)&&(yield`${y}.getTime() >= ${d.minimumTimestamp}`),W(d.multipleOfTimestamp)&&(yield`(${y}.getTime() % ${d.multipleOfTimestamp}) === 0`)}function*p(d,S,y){yield`(typeof ${y} === 'function')`}function*m(d,S,y){const K=globalThis.Object.getOwnPropertyNames(d.$defs).reduce((C,M)=>[...C,d.$defs[M]],[]);yield*ie(Rn(d.$ref),[...S,...K],y)}function*g(d,S,y){yield`Number.isInteger(${y})`,W(d.exclusiveMaximum)&&(yield`${y} < ${d.exclusiveMaximum}`),W(d.exclusiveMinimum)&&(yield`${y} > ${d.exclusiveMinimum}`),W(d.maximum)&&(yield`${y} <= ${d.maximum}`),W(d.minimum)&&(yield`${y} >= ${d.minimum}`),W(d.multipleOf)&&(yield`(${y} % ${d.multipleOf}) === 0`)}function*l(d,S,y){const K=d.allOf.map(C=>Je(C,S,y)).join(" && ");if(d.unevaluatedProperties===!1){const C=ut(`${new RegExp(dn(d))};`),M=`Object.getOwnPropertyNames(${y}).every(key => ${C}.test(key))`;yield`(${K} && ${M})`}else if(be(d.unevaluatedProperties)){const C=ut(`${new RegExp(dn(d))};`),M=`Object.getOwnPropertyNames(${y}).every(key => ${C}.test(key) || ${Je(d.unevaluatedProperties,S,`${y}[key]`)})`;yield`(${K} && ${M})`}else yield`(${K})`}function*h(d,S,y){yield`(typeof value === 'object' && Symbol.iterator in ${y})`}function*a(d,S,y){typeof d.const=="number"||typeof d.const=="boolean"?yield`(${y} === ${d.const})`:yield`(${y} === '${xo.Escape(d.const)}')`}function*x(d,S,y){yield"false"}function*P(d,S,y){yield`(!${Je(d.not,S,y)})`}function*D(d,S,y){yield`(${y} === null)`}function*B(d,S,y){yield Ur.IsNumberLike(y),W(d.exclusiveMaximum)&&(yield`${y} < ${d.exclusiveMaximum}`),W(d.exclusiveMinimum)&&(yield`${y} > ${d.exclusiveMinimum}`),W(d.maximum)&&(yield`${y} <= ${d.maximum}`),W(d.minimum)&&(yield`${y} >= ${d.minimum}`),W(d.multipleOf)&&(yield`(${y} % ${d.multipleOf}) === 0`)}function*H(d,S,y){yield Ur.IsObjectLike(y),W(d.minProperties)&&(yield`Object.getOwnPropertyNames(${y}).length >= ${d.minProperties}`),W(d.maxProperties)&&(yield`Object.getOwnPropertyNames(${y}).length <= ${d.maxProperties}`);const K=Object.getOwnPropertyNames(d.properties);for(const C of K){const M=Ai.Encode(y,C),se=d.properties[C];if(d.required&&d.required.includes(C))yield*ie(se,S,M),(Fn(se)||t(se))&&(yield`('${C}' in ${y})`);else{const Ge=Je(se,S,M);yield Ur.IsExactOptionalProperty(y,C,Ge)}}if(d.additionalProperties===!1)if(d.required&&d.required.length===K.length)yield`Object.getOwnPropertyNames(${y}).length === ${K.length}`;else{const C=`[${K.map(M=>`'${M}'`).join(", ")}]`;yield`Object.getOwnPropertyNames(${y}).every(key => ${C}.includes(key))`}if(typeof d.additionalProperties=="object"){const C=Je(d.additionalProperties,S,`${y}[key]`),M=`[${K.map(se=>`'${se}'`).join(", ")}]`;yield`(Object.getOwnPropertyNames(${y}).every(key => ${M}.includes(key) || ${C}))`}}function*oe(d,S,y){yield`${y} instanceof Promise`}function*N(d,S,y){yield Ur.IsRecordLike(y),W(d.minProperties)&&(yield`Object.getOwnPropertyNames(${y}).length >= ${d.minProperties}`),W(d.maxProperties)&&(yield`Object.getOwnPropertyNames(${y}).length <= ${d.maxProperties}`);const[K,C]=Object.entries(d.patternProperties)[0],M=ut(`${new RegExp(K)}`),se=Je(C,S,"value"),Ge=be(d.additionalProperties)?Je(d.additionalProperties,S,y):d.additionalProperties===!1?"false":"true",jt=`(${M}.test(key) ? ${se} : ${Ge})`;yield`(Object.entries(${y}).every(([key, value]) => ${jt}))`}function*z(d,S,y){const K=He(d,S);if(ne.functions.has(d.$ref))return yield`${ft(d.$ref)}(${y})`;yield*ie(K,S,y)}function*E(d,S,y){const K=ut(`${new RegExp(d.source,d.flags)};`);yield`(typeof ${y} === 'string')`,W(d.maxLength)&&(yield`${y}.length <= ${d.maxLength}`),W(d.minLength)&&(yield`${y}.length >= ${d.minLength}`),yield`${K}.test(${y})`}function*U(d,S,y){yield`(typeof ${y} === 'string')`,W(d.maxLength)&&(yield`${y}.length <= ${d.maxLength}`),W(d.minLength)&&(yield`${y}.length >= ${d.minLength}`),d.pattern!==void 0&&(yield`${ut(`${new RegExp(d.pattern)};`)}.test(${y})`),d.format!==void 0&&(yield`format('${d.format}', ${y})`)}function*ue(d,S,y){yield`(typeof ${y} === 'symbol')`}function*we(d,S,y){yield`(typeof ${y} === 'string')`,yield`${ut(`${new RegExp(d.pattern)};`)}.test(${y})`}function*ze(d,S,y){yield`${ft(d.$ref)}(${y})`}function*le(d,S,y){if(yield`Array.isArray(${y})`,d.items===void 0)return yield`${y}.length === 0`;yield`(${y}.length === ${d.maxItems})`;for(let K=0;K<d.items.length;K++)yield`${Je(d.items[K],S,`${y}[${K}]`)}`}function*Z(d,S,y){yield`${y} === undefined`}function*_(d,S,y){yield`(${d.anyOf.map(C=>Je(C,S,y)).join(" || ")})`}function*T(d,S,y){yield`${y} instanceof Uint8Array`,W(d.maxByteLength)&&(yield`(${y}.length <= ${d.maxByteLength})`),W(d.minByteLength)&&(yield`(${y}.length >= ${d.minByteLength})`)}function*ve(d,S,y){yield"true"}function*rr(d,S,y){yield Ur.IsVoidLike(y)}function*me(d,S,y){const K=ne.instances.size;ne.instances.set(K,d),yield`kind('${d[R]}', ${K}, ${y})`}function*ie(d,S,y,K=!0){const C=gt(d.$id)?[...S,d]:S,M=d;if(K&&gt(d.$id)){const se=ft(d.$id);if(ne.functions.has(se))return yield`${se}(${y})`;{ne.functions.set(se,"<deferred>");const Ge=ye(se,d,S,"value",!1);return ne.functions.set(se,Ge),yield`${se}(${y})`}}switch(M[R]){case"Any":return yield*r();case"Argument":return yield*n();case"Array":return yield*i(M,C,y);case"AsyncIterator":return yield*o(M,C,y);case"BigInt":return yield*s(M,C,y);case"Boolean":return yield*c(M,C,y);case"Constructor":return yield*u(M,C,y);case"Date":return yield*f(M,C,y);case"Function":return yield*p(M,C,y);case"Import":return yield*m(M,C,y);case"Integer":return yield*g(M,C,y);case"Intersect":return yield*l(M,C,y);case"Iterator":return yield*h(M,C,y);case"Literal":return yield*a(M,C,y);case"Never":return yield*x();case"Not":return yield*P(M,C,y);case"Null":return yield*D(M,C,y);case"Number":return yield*B(M,C,y);case"Object":return yield*H(M,C,y);case"Promise":return yield*oe(M,C,y);case"Record":return yield*N(M,C,y);case"Ref":return yield*z(M,C,y);case"RegExp":return yield*E(M,C,y);case"String":return yield*U(M,C,y);case"Symbol":return yield*ue(M,C,y);case"TemplateLiteral":return yield*we(M,C,y);case"This":return yield*ze(M,C,y);case"Tuple":return yield*le(M,C,y);case"Undefined":return yield*Z(M,C,y);case"Union":return yield*_(M,C,y);case"Uint8Array":return yield*T(M,C,y);case"Unknown":return yield*ve();case"Void":return yield*rr(M,C,y);default:if(!Rr(M[R]))throw new Vh(d);return yield*me(M,C,y)}}const ne={language:"javascript",functions:new Map,variables:new Map,instances:new Map};function Je(d,S,y,K=!0){return`(${[...ie(d,S,y,K)].join(" && ")})`}function ft(d){return`check_${Oo.Encode(d)}`}function ut(d){const S=`local_${ne.variables.size}`;return ne.variables.set(S,`const ${S} = ${d}`),S}function ye(d,S,y,K,C=!0){const[M,se]=[`
`,wt=>"".padStart(wt," ")],Ge=q("value","any"),jt=J("boolean"),at=[...ie(S,y,K,C)].map(wt=>`${se(4)}${wt}`).join(` &&${M}`);return`function ${d}(${Ge})${jt} {${M}${se(2)}return (${M}${at}${M}${se(2)})
}`}function q(d,S){const y=ne.language==="typescript"?`: ${S}`:"";return`${d}${y}`}function J(d){return ne.language==="typescript"?`: ${d}`:""}function L(d,S,y){const K=ye("check",d,S,"value"),C=q("value","any"),M=J("boolean"),se=[...ne.functions.values()],Ge=[...ne.variables.values()],jt=gt(d.$id)?`return function check(${C})${M} {
  return ${ft(d.$id)}(value)
}`:`return ${K}`;return[...Ge,...se,jt].join(`
`)}function ae(...d){const S={language:"javascript"},[y,K,C]=d.length===2&&Ee(d[1])?[d[0],d[1],S]:d.length===2&&!Ee(d[1])?[d[0],[],d[1]]:d.length===3?[d[0],d[1],d[2]]:d.length===1?[d[0],[],S]:[null,[],S];if(ne.language=C.language,ne.variables.clear(),ne.functions.clear(),ne.instances.clear(),!be(y))throw new Ac(y);for(const M of K)if(!be(M))throw new Ac(M);return L(y,K)}e.Code=ae;function Le(d,S=[]){const y=ae(d,S,{language:"javascript"}),K=globalThis.Function("kind","format","hash",y),C=new Map(ne.instances);function M(at,wt,Nr){if(!Rr(at)||!C.has(wt))return!1;const ii=Ko(at),oi=C.get(wt);return ii(oi,Nr)}function se(at,wt){return Xt(at)?_o(at)(wt):!1}function Ge(at){return ls(at)}const jt=K(M,se,Ge);return new Xh(d,S,jt,y)}e.Compile=Le})(mn||(mn={}));function vh(e){const t={};for(const r of Object.getOwnPropertyNames(e))t[r]=lr(e[r]);for(const r of Object.getOwnPropertySymbols(e))t[r]=lr(e[r]);return t}function e$(e){return e.map(t=>lr(t))}function t$(e){return e.slice()}function r$(e){return new Map(lr([...e.entries()]))}function n$(e){return new Set(lr([...e.entries()]))}function i$(e){return new Date(e.toISOString())}function lr(e){if(Ee(e))return e$(e);if(Wn(e))return i$(e);if(Xu(e))return t$(e);if(Qu(e))return r$(e);if(Zu(e))return n$(e);if(Ie(e))return vh(e);if(jo(e))return e;throw new Error("ValueClone: Unable to clone value")}class Qt extends ke{constructor(t,r){super(r),this.schema=t}}function re(e){return Mi(e)?e():lr(e)}function o$(e,t){return Q(e,"default")?re(e.default):{}}function s$(e,t){return{}}function c$(e,t){if(e.uniqueItems===!0&&!Q(e,"default"))throw new Qt(e,"Array with the uniqueItems constraint requires a default value");if("contains"in e&&!Q(e,"default"))throw new Qt(e,"Array with the contains constraint requires a default value");return"default"in e?re(e.default):e.minItems!==void 0?Array.from({length:e.minItems}).map(r=>bt(e.items,t)):[]}function f$(e,t){return Q(e,"default")?re(e.default):async function*(){}()}function u$(e,t){return Q(e,"default")?re(e.default):BigInt(0)}function a$(e,t){return Q(e,"default")?re(e.default):!1}function d$(e,t){if(Q(e,"default"))return re(e.default);{const r=bt(e.returns,t);return typeof r=="object"&&!Array.isArray(r)?class{constructor(){for(const[n,i]of Object.entries(r)){const o=this;o[n]=i}}}:class{}}}function l$(e,t){return Q(e,"default")?re(e.default):e.minimumTimestamp!==void 0?new Date(e.minimumTimestamp):new Date}function m$(e,t){return Q(e,"default")?re(e.default):()=>bt(e.returns,t)}function p$(e,t){const r=globalThis.Object.values(e.$defs),n=e.$defs[e.$ref];return bt(n,[...t,...r])}function y$(e,t){return Q(e,"default")?re(e.default):e.minimum!==void 0?e.minimum:0}function g$(e,t){if(Q(e,"default"))return re(e.default);{const r=e.allOf.reduce((n,i)=>{const o=bt(i,t);return typeof o=="object"?{...n,...o}:o},{});if(!ge(e,t,r))throw new Qt(e,"Intersect produced invalid value. Consider using a default value.");return r}}function h$(e,t){return Q(e,"default")?re(e.default):function*(){}()}function $$(e,t){return Q(e,"default")?re(e.default):e.const}function b$(e,t){if(Q(e,"default"))return re(e.default);throw new Qt(e,"Never types cannot be created. Consider using a default value.")}function O$(e,t){if(Q(e,"default"))return re(e.default);throw new Qt(e,"Not types must have a default value")}function x$(e,t){return Q(e,"default")?re(e.default):null}function w$(e,t){return Q(e,"default")?re(e.default):e.minimum!==void 0?e.minimum:0}function R$(e,t){if(Q(e,"default"))return re(e.default);{const r=new Set(e.required),n={};for(const[i,o]of Object.entries(e.properties))r.has(i)&&(n[i]=bt(o,t));return n}}function I$(e,t){return Q(e,"default")?re(e.default):Promise.resolve(bt(e.item,t))}function F$(e,t){const[r,n]=Object.entries(e.patternProperties)[0];if(Q(e,"default"))return re(e.default);if(r===Kr||r===qr)return{};{const i=r.slice(1,r.length-1).split("|"),o={};for(const s of i)o[s]=bt(n,t);return o}}function A$(e,t){return Q(e,"default")?re(e.default):bt(He(e,t),t)}function P$(e,t){if(Q(e,"default"))return re(e.default);throw new Qt(e,"RegExp types cannot be created. Consider using a default value.")}function S$(e,t){if(e.pattern!==void 0){if(Q(e,"default"))return re(e.default);throw new Qt(e,"String types with patterns must specify a default value")}else if(e.format!==void 0){if(Q(e,"default"))return re(e.default);throw new Qt(e,"String types with formats must specify a default value")}else return Q(e,"default")?re(e.default):e.minLength!==void 0?Array.from({length:e.minLength}).map(()=>" ").join(""):""}function j$(e,t){return Q(e,"default")?re(e.default):"value"in e?Symbol.for(e.value):Symbol()}function E$(e,t){if(Q(e,"default"))return re(e.default);if(!Rf(e))throw new Qt(e,"Can only create template literals that produce a finite variants. Consider using a default value.");return Yo(e)[0]}function C$(e,t){if(du++>B$)throw new Qt(e,"Cannot create recursive type as it appears possibly infinite. Consider using a default.");return Q(e,"default")?re(e.default):bt(He(e,t),t)}function N$(e,t){return Q(e,"default")?re(e.default):e.items===void 0?[]:Array.from({length:e.minItems}).map((r,n)=>bt(e.items[n],t))}function T$(e,t){if(Q(e,"default"))return re(e.default)}function M$(e,t){if(Q(e,"default"))return re(e.default);if(e.anyOf.length===0)throw new Error("ValueCreate.Union: Cannot create Union with zero variants");return bt(e.anyOf[0],t)}function U$(e,t){return Q(e,"default")?re(e.default):e.minByteLength!==void 0?new Uint8Array(e.minByteLength):new Uint8Array(0)}function k$(e,t){return Q(e,"default")?re(e.default):{}}function L$(e,t){if(Q(e,"default"))return re(e.default)}function D$(e,t){if(Q(e,"default"))return re(e.default);throw new Error("User defined types must specify a default value")}function bt(e,t){const r=vr(e,t),n=e;switch(n[R]){case"Any":return o$(n);case"Argument":return s$();case"Array":return c$(n,r);case"AsyncIterator":return f$(n);case"BigInt":return u$(n);case"Boolean":return a$(n);case"Constructor":return d$(n,r);case"Date":return l$(n);case"Function":return m$(n,r);case"Import":return p$(n,r);case"Integer":return y$(n);case"Intersect":return g$(n,r);case"Iterator":return h$(n);case"Literal":return $$(n);case"Never":return b$(n);case"Not":return O$(n);case"Null":return x$(n);case"Number":return w$(n);case"Object":return R$(n,r);case"Promise":return I$(n,r);case"Record":return F$(n,r);case"Ref":return A$(n,r);case"RegExp":return P$(n);case"String":return S$(n);case"Symbol":return j$(n);case"TemplateLiteral":return E$(n);case"This":return C$(n,r);case"Tuple":return N$(n,r);case"Undefined":return T$(n);case"Union":return M$(n,r);case"Uint8Array":return U$(n);case"Unknown":return k$(n);case"Void":return L$(n);default:if(!Rr(n[R]))throw new Qt(n,"Unknown type");return D$(n)}}const B$=512;let du=0;function Hn(...e){return du=0,e.length===2?bt(e[0],e[1]):bt(e[0],[])}function _$(e){return On(e)&&e[R]!=="Unsafe"}function q$(e,t,r){return Ee(r)?r.map(n=>Ot(e.items,t,n)):r}function K$(e,t,r){const n=globalThis.Object.values(e.$defs),i=e.$defs[e.$ref];return Ot(i,[...t,...n],r)}function H$(e,t,r){const n=e.unevaluatedProperties,o=e.allOf.map(c=>Ot(c,t,lr(r))).reduce((c,u)=>Ie(u)?{...c,...u}:u,{});if(!Ie(r)||!Ie(o)||!On(n))return o;const s=Cr(e);for(const c of Object.getOwnPropertyNames(r))s.includes(c)||ge(n,t,r[c])&&(o[c]=Ot(n,t,r[c]));return o}function z$(e,t,r){if(!Ie(r)||Ee(r))return r;const n=e.additionalProperties;for(const i of Object.getOwnPropertyNames(r)){if(Q(e.properties,i)){r[i]=Ot(e.properties[i],t,r[i]);continue}if(On(n)&&ge(n,t,r[i])){r[i]=Ot(n,t,r[i]);continue}delete r[i]}return r}function J$(e,t,r){if(!Ie(r))return r;const n=e.additionalProperties,i=Object.getOwnPropertyNames(r),[o,s]=Object.entries(e.patternProperties)[0],c=new RegExp(o);for(const u of i){if(c.test(u)){r[u]=Ot(s,t,r[u]);continue}if(On(n)&&ge(n,t,r[u])){r[u]=Ot(n,t,r[u]);continue}delete r[u]}return r}function G$(e,t,r){return Ot(He(e,t),t,r)}function W$(e,t,r){return Ot(He(e,t),t,r)}function Y$(e,t,r){if(!Ee(r))return r;if(Ut(e.items))return[];const n=Math.min(r.length,e.items.length);for(let i=0;i<n;i++)r[i]=Ot(e.items[i],t,r[i]);return r.length>n?r.slice(0,n):r}function Q$(e,t,r){for(const n of e.anyOf)if(_$(n)&&ge(n,t,r))return Ot(n,t,r);return r}function Ot(e,t,r){const n=gt(e.$id)?vr(e,t):t,i=e;switch(i[R]){case"Array":return q$(i,n,r);case"Import":return K$(i,n,r);case"Intersect":return H$(i,n,r);case"Object":return z$(i,n,r);case"Record":return J$(i,n,r);case"Ref":return G$(i,n,r);case"This":return W$(i,n,r);case"Tuple":return Y$(i,n,r);case"Union":return Q$(i,n,r);default:return r}}function Pc(...e){return e.length===3?Ot(e[0],e[1],e[2]):Ot(e[0],[],e[1])}function Mn(...e){const[t,r,n]=e.length===3?[e[0],e[1],e[2]]:[e[0],[],e[1]];if(!ge(t,r,n))throw new su(t,n,wr(t,r,n).First());return ms(t,r)?fu(t,r,n):n}function yr(e,t){const r=Q(e,"default")?e.default:void 0,n=Mi(r)?r():lr(r);return Ut(t)?n:Ie(t)&&Ie(n)?Object.assign(n,t):t}function wo(e){return On(e)&&"default"in e}function Z$(e,t,r){if(Ee(r)){for(let i=0;i<r.length;i++)r[i]=ct(e.items,t,r[i]);return r}const n=yr(e,r);if(!Ee(n))return n;for(let i=0;i<n.length;i++)n[i]=ct(e.items,t,n[i]);return n}function X$(e,t,r){return Wn(r)?r:yr(e,r)}function V$(e,t,r){const n=globalThis.Object.values(e.$defs),i=e.$defs[e.$ref];return ct(i,[...t,...n],r)}function v$(e,t,r){const n=yr(e,r);return e.allOf.reduce((i,o)=>{const s=ct(o,t,n);return Ie(s)?{...i,...s}:s},{})}function eb(e,t,r){const n=yr(e,r);if(!Ie(n))return n;const i=Object.getOwnPropertyNames(e.properties);for(const o of i){const s=ct(e.properties[o],t,n[o]);Ut(s)||(n[o]=ct(e.properties[o],t,n[o]))}if(!wo(e.additionalProperties))return n;for(const o of Object.getOwnPropertyNames(n))i.includes(o)||(n[o]=ct(e.additionalProperties,t,n[o]));return n}function tb(e,t,r){const n=yr(e,r);if(!Ie(n))return n;const i=e.additionalProperties,[o,s]=Object.entries(e.patternProperties)[0],c=new RegExp(o);for(const u of Object.getOwnPropertyNames(n))c.test(u)&&wo(s)&&(n[u]=ct(s,t,n[u]));if(!wo(i))return n;for(const u of Object.getOwnPropertyNames(n))c.test(u)||(n[u]=ct(i,t,n[u]));return n}function rb(e,t,r){return ct(He(e,t),t,yr(e,r))}function nb(e,t,r){return ct(He(e,t),t,r)}function ib(e,t,r){const n=yr(e,r);if(!Ee(n)||Ut(e.items))return n;const[i,o]=[e.items,Math.max(e.items.length,n.length)];for(let s=0;s<o;s++)s<i.length&&(n[s]=ct(i[s],t,n[s]));return n}function ob(e,t,r){const n=yr(e,r);for(const i of e.anyOf){const o=ct(i,t,lr(n));if(ge(i,t,o))return o}return n}function ct(e,t,r){const n=vr(e,t),i=e;switch(i[R]){case"Array":return Z$(i,n,r);case"Date":return X$(i,n,r);case"Import":return V$(i,n,r);case"Intersect":return v$(i,n,r);case"Object":return eb(i,n,r);case"Record":return tb(i,n,r);case"Ref":return rb(i,n,r);case"This":return nb(i,n,r);case"Tuple":return ib(i,n,r);case"Union":return ob(i,n,r);default:return yr(i,r)}}function jn(...e){return e.length===3?ct(e[0],e[1],e[2]):ct(e[0],[],e[1])}function lu(...e){const[t,r,n]=e.length===3?[e[0],e[1],e[2]]:[e[0],[],e[1]],i=ms(t,r)?au(t,r,n):n;if(!ge(t,r,i))throw new uu(t,i,wr(t,r,i).First());return i}const ps={date:mu,time:Ro(!0),"date-time":Sc(!0),"iso-time":Ro(!1),"iso-date-time":Sc(!1),duration:/^P(?!$)((\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?|(\d+W)?)$/,uri:mb,"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,url:/^(?:https?|ftp):\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)(?:\.(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/,ipv6:/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,regex:Ob,uuid:/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,"json-pointer":/^(?:\/(?:[^~/]|~0|~1)*)*$/,"json-pointer-uri-fragment":/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,"relative-json-pointer":/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,byte:pb,int32:{type:"number",validate:hb},int64:{type:"number",validate:$b},float:{type:"number",validate:Ec},double:{type:"number",validate:Ec},password:!0,binary:!0};function sb(e){return e%4===0&&(e%100!==0||e%400===0)}const cb=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,fb=[0,31,28,31,30,31,30,31,31,30,31,30,31];function mu(e){const t=cb.exec(e);if(!t)return!1;const r=+t[1],n=+t[2],i=+t[3];return n>=1&&n<=12&&i>=1&&i<=(n===2&&sb(r)?29:fb[n])}const ub=/^(\d\d):(\d\d):(\d\d(?:\.\d+)?)(z|([+-])(\d\d)(?::?(\d\d))?)?$/i;function Ro(e){return function(r){const n=ub.exec(r);if(!n)return!1;const i=+n[1],o=+n[2],s=+n[3],c=n[4],u=n[5]==="-"?-1:1,f=+(n[6]||0),p=+(n[7]||0);if(f>23||p>59||e&&!c)return!1;if(i<=23&&o<=59&&s<60)return!0;const m=o-p*u,g=i-f*u-(m<0?1:0);return(g===23||g===-1)&&(m===59||m===-1)&&s<61}}const ab=/t|\s/i;function Sc(e){const t=Ro(e);return function(n){const i=n.split(ab);return i.length===2&&mu(i[0])&&t(i[1])}}const db=/\/|:/,lb=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function mb(e){return db.test(e)&&lb.test(e)}const jc=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/gm;function pb(e){return jc.lastIndex=0,jc.test(e)}const yb=-2147483648,gb=2**31-1;function hb(e){return Number.isInteger(e)&&e<=gb&&e>=yb}function $b(e){return Number.isInteger(e)}function Ec(){return!0}const bb=/[^\\]\\Z/;function Ob(e){if(bb.test(e))return!1;try{return new RegExp(e),!0}catch{return!1}}const Pi="toJSON"in new Headers,Cc=(e,t)=>{const r=new URL(e);return r.pathname=t,r.toString()},xb=e=>typeof e=="function"&&/^\s*class\s+/.test(e.toString())||e.toString&&e.toString().startsWith("[object ")&&e.toString()!=="[object Object]"||Mt(Object.getPrototypeOf(e)),oo=e=>e&&typeof e=="object"&&!Array.isArray(e),lt=(e,t,{skipKeys:r,override:n=!0}={})=>{if(!oo(e)||!oo(t))return e;for(const[i,o]of Object.entries(t))if(!(r!=null&&r.includes(i))){if(!oo(o)||!(i in e)||xb(o)){(n||!(i in e))&&(e[i]=o);continue}e[i]=lt(e[i],o,{skipKeys:r,override:n})}return e},wb=(e,t)=>{const r=lt(Object.assign({},e),t,{skipKeys:["properties"]});return"properties"in r&&delete r.properties,r},$e=(e=[],t=[])=>{if(!e)return;if(!t)return e;const r=[],n=[];Array.isArray(e)||(e=[e]),Array.isArray(t)||(t=[t]);for(const i of e)r.push(i),i.checksum&&n.push(i.checksum);for(const i of t)n.includes(i.checksum)||r.push(i);return r},Rb=["start","request","parse","transform","resolve","beforeHandle","afterHandle","mapResponse","afterResponse","trace","error","stop","body","headers","params","query","response","type","detail"],Ib=Rb.reduce((e,t)=>(e[t]=!0,e),{}),pu=(e,t)=>{const r=n=>typeof n=="object"&&Object.keys(n).every(ys);return r(e)&&r(t)?Object.assign(e,t):e&&!r(e)&&r(t)?Object.assign({200:e},t):t??e},En=(e,t)=>({body:(t==null?void 0:t.body)??(e==null?void 0:e.body),headers:(t==null?void 0:t.headers)??(e==null?void 0:e.headers),params:(t==null?void 0:t.params)??(e==null?void 0:e.params),query:(t==null?void 0:t.query)??(e==null?void 0:e.query),cookie:(t==null?void 0:t.cookie)??(e==null?void 0:e.cookie),response:pu(e==null?void 0:e.response,t==null?void 0:t.response)}),nr=(e,t)=>{const{resolve:r,...n}=e??{},{resolve:i,...o}=t??{};return{...n,...o,body:(t==null?void 0:t.body)??(e==null?void 0:e.body),headers:(t==null?void 0:t.headers)??(e==null?void 0:e.headers),params:(t==null?void 0:t.params)??(e==null?void 0:e.params),query:(t==null?void 0:t.query)??(e==null?void 0:e.query),cookie:(t==null?void 0:t.cookie)??(e==null?void 0:e.cookie),response:pu(e==null?void 0:e.response,t==null?void 0:t.response),type:(e==null?void 0:e.type)||(t==null?void 0:t.type),detail:lt((t==null?void 0:t.detail)??{},(e==null?void 0:e.detail)??{}),parse:$e(e==null?void 0:e.parse,t==null?void 0:t.parse),transform:$e(e==null?void 0:e.transform,t==null?void 0:t.transform),beforeHandle:$e($e(De(r,"resolve"),e==null?void 0:e.beforeHandle),$e(De(i,"resolve"),t==null?void 0:t.beforeHandle)),afterHandle:$e(e==null?void 0:e.afterHandle,t==null?void 0:t.afterHandle),mapResponse:$e(e==null?void 0:e.mapResponse,t==null?void 0:t.mapResponse),afterResponse:$e(e==null?void 0:e.afterResponse,t==null?void 0:t.afterResponse),trace:$e(e==null?void 0:e.trace,t==null?void 0:t.trace),error:$e(e==null?void 0:e.error,t==null?void 0:t.error)}},Io=(e,t,r=!0)=>{if(!Array.isArray(t))return t.original=e,We(e,t,r);for(const n of t)n.original=e,e=We(e,n,r);return e},We=(e,t,r=!0)=>{if(!e||t.untilObjectFound&&!r&&e.type==="object")return e;const n=t.from[R];if(e.oneOf){for(let s=0;s<e.oneOf.length;s++)e.oneOf[s]=We(e.oneOf[s],t,r);return e}if(e.anyOf){for(let s=0;s<e.anyOf.length;s++)e.anyOf[s]=We(e.anyOf[s],t,r);return e}if(e.allOf){for(let s=0;s<e.allOf.length;s++)e.allOf[s]=We(e.allOf[s],t,r);return e}if(e.not)return We(e.not,t,r);const i=r&&!!t.excludeRoot;if(e[R]===n){const{anyOf:s,oneOf:c,allOf:u,not:f,properties:p,items:m,...g}=e,l=t.to(g);if(!l)return e;let h;const a=x=>{if(p&&x.type==="object"){const D={};for(const[B,H]of Object.entries(p))D[B]=We(H,t,!1);return{...g,...x,properties:D}}if(m&&x.type==="array")return{...g,...x,items:We(m,t,!1)};const P={...g,...x};return delete P.required,p&&x.type==="string"&&x.format==="ObjectString"&&x.default==="{}"&&(h=I.ObjectString(p,g),P.default=JSON.stringify(Hn(I.Object(p))),P.properties=p),m&&x.type==="string"&&x.format==="ArrayString"&&x.default==="[]"&&(h=I.ArrayString(m,g),P.default=JSON.stringify(Hn(I.Array(m))),P.items=m),P};if(i){if(p){const x={};for(const[P,D]of Object.entries(p))x[P]=We(D,t,!1);return{...g,properties:x}}else if(m!=null&&m.map)return{...g,items:m.map(x=>We(x,t,!1))};return g}if(l.anyOf)for(let x=0;x<l.anyOf.length;x++)l.anyOf[x]=a(l.anyOf[x]);else if(l.oneOf)for(let x=0;x<l.oneOf.length;x++)l.oneOf[x]=a(l.oneOf[x]);else if(l.allOf)for(let x=0;x<l.allOf.length;x++)l.allOf[x]=a(l.allOf[x]);else l.not&&(l.not=a(l.not));if(h&&(l[rt]=h[rt]),l.anyOf||l.oneOf||l.allOf||l.not)return l;if(p){const x={};for(const[P,D]of Object.entries(p))x[P]=We(D,t,!1);return{...g,...l,properties:x}}else if(m!=null&&m.map)return{...g,...l,items:m.map(x=>We(x,t,!1))};return{...g,...l}}const o=e==null?void 0:e.properties;if(o&&r&&t.rootOnly!==!0)for(const[s,c]of Object.entries(o))switch(c[R]){case n:const{anyOf:u,oneOf:f,allOf:p,not:m,type:g,...l}=c,h=t.to(l);if(!h)return e;if(h.anyOf)for(let a=0;a<h.anyOf.length;a++)h.anyOf[a]={...l,...h.anyOf[a]};else if(h.oneOf)for(let a=0;a<h.oneOf.length;a++)h.oneOf[a]={...l,...h.oneOf[a]};else if(h.allOf)for(let a=0;a<h.allOf.length;a++)h.allOf[a]={...l,...h.allOf[a]};else h.not&&(h.not={...l,...h.not});o[s]={...l,...We(l,t,!1)};break;case"Object":case"Union":o[s]=We(c,t,!1);break;default:if(Array.isArray(c.items))for(let a=0;a<c.items.length;a++)c.items[a]=We(c.items[a],t,!1);else c.anyOf||c.oneOf||c.allOf||c.not?o[s]=We(c,t,!1):c.type==="array"&&(c.items=We(c.items,t,!1));break}return e},Un=e=>t=>{if(typeof t=="object")try{return Pc(e,structuredClone(t))}catch{try{return Pc(e,t)}catch{return t}}return t},mt=(e,{models:t={},dynamic:r=!1,modules:n,normalize:i=!1,additionalProperties:o=!1,coerce:s=!1,additionalCoerce:c=[]}={modules:I.Module({})})=>{var p,m;if(!e)return;let u;if(typeof e!="string")u=e;else{const g=e.endsWith("[]"),l=g?e.substring(0,e.length-2):e;u=n.Import(l)??t[l],g&&(u=I.Array(u))}if(!u)return;if((s||c)&&(s?u=Io(u,[{from:I.Ref(""),to:g=>n.Import(g.$ref)},{from:I.Number(),to:g=>I.Numeric(g),untilObjectFound:!0},{from:I.Boolean(),to:g=>I.BooleanString(g),untilObjectFound:!0},...Array.isArray(c)?c:[c]]):u=Io(u,[{from:I.Ref(""),to:g=>n.Import(g.$ref)},...Array.isArray(c)?c:[c]])),u.type==="object"&&!("additionalProperties"in u)&&(u.additionalProperties=o),r){const g={schema:u,references:"",checkFunc:()=>{},code:"",Check:l=>ge(u,l),Errors:l=>wr(u,l),Code:()=>"",Clean:Un(u),Decode:l=>Mn(u,l),Encode:l=>lu(u,l)};return i&&u.additionalProperties===!1&&(g.Clean=Un(u)),u.config&&(g.config=u.config,(p=g==null?void 0:g.schema)!=null&&p.config&&delete g.schema.config),g.parse=l=>{try{return g.Decode(l)}catch{throw[...g.Errors(l)].map(Ht)}},g.safeParse=l=>{var h;try{return{success:!0,data:g.Decode(l),error:null}}catch{const x=[...f.Errors(l)].map(Ht);return{success:!1,data:null,error:(h=x[0])==null?void 0:h.summary,errors:x}}},g}const f=mn.Compile(u,Object.values(t));return f.Clean=Un(u),u.config&&(f.config=u.config,(m=f==null?void 0:f.schema)!=null&&m.config&&delete f.schema.config),f.parse=g=>{try{return f.Decode(g)}catch{throw[...f.Errors(g)].map(Ht)}},f.safeParse=g=>{var l;try{return{success:!0,data:f.Decode(g),error:null}}catch{const a=[...f.Errors(g)].map(Ht);return{success:!1,data:null,error:(l=a[0])==null?void 0:l.summary,errors:a}}},f},Nc=(e,{models:t={},modules:r,dynamic:n=!1,normalize:i=!1,additionalProperties:o=!1})=>{if(!e)return;let s;if(typeof e!="string")s=e;else{const p=e.endsWith("[]"),m=p?e.substring(0,e.length-2):e;s=r.Import(m)??t[m],p&&(s=I.Array(s))}if(!s)return;const c=(p,m)=>{if(n)return{schema:p,references:"",checkFunc:()=>{},code:"",Check:l=>ge(p,l),Errors:l=>wr(p,l),Code:()=>"",Clean:Un(p),Decode:l=>Mn(p,l),Encode:l=>lu(p,l)};const g=mn.Compile(p,m);return i&&p.additionalProperties===!1&&(g.Clean=Un(p)),g},u=Object.values(t);if(R in s)return"additionalProperties"in s||(s.additionalProperties=o),{200:c(s,u)};const f={};return Object.keys(s).forEach(p=>{const m=s[+p];if(typeof m=="string"){if(m in t){const g=t[m];g.type==="object"&&"additionalProperties"in g,f[+p]=R in g?c(g,u):g}return}m.type==="object"&&!("additionalProperties"in m)&&(m.additionalProperties=o),f[+p]=R in m?c(m,u):m}),f},Fb=typeof Bun<"u",Ab=Fb&&typeof Bun.hash=="function",Cn=e=>{if(Ab)return Bun.hash(e);let t=9;for(let r=0;r<e.length;)t=Math.imul(t^e.charCodeAt(r++),9**9);return t=t^t>>>9};let so;const Mr=()=>(so||(so=[{from:I.Object({}),to:()=>I.ObjectString({}),excludeRoot:!0},{from:I.Array(I.Any()),to:()=>I.ArrayString(I.Any())}]),so);let co;const Tc=()=>(co||(co=[{from:I.Number(),to:e=>I.Numeric(e),rootOnly:!0},{from:I.Boolean(),to:e=>I.BooleanString(e),rootOnly:!0}]),co),yu=({validator:e,modules:t,defaultConfig:r={},config:n,dynamic:i,models:o})=>{let s=mt(e,{modules:t,dynamic:i,models:o,additionalProperties:!0,coerce:!0,additionalCoerce:Mr()});return Mt(r)&&(s?s.config=wb(s.config,n):(s=mt(I.Cookie({}),{modules:t,dynamic:i,models:o,additionalProperties:!0}),s.config=r)),s},Bt=(e,t)=>{if(!t)return;if(!Array.isArray(t)){const n=t;return e&&!n.checksum&&(n.checksum=e),n.scope==="scoped"&&(n.scope="local"),n}const r=[...t];for(const n of r)e&&!n.checksum&&(n.checksum=e),n.scope==="scoped"&&(n.scope="local");return r},Mc=(e,t,r)=>({start:$e(e.start,Bt(r,t==null?void 0:t.start)),request:$e(e.request,Bt(r,t==null?void 0:t.request)),parse:$e(e.parse,Bt(r,t==null?void 0:t.parse)),transform:$e(e.transform,Bt(r,t==null?void 0:t.transform)),beforeHandle:$e($e(De(e.resolve,"resolve"),e.beforeHandle),Bt(r,$e(De(t==null?void 0:t.resolve,"resolve"),t==null?void 0:t.beforeHandle))),afterHandle:$e(e.afterHandle,Bt(r,t==null?void 0:t.afterHandle)),mapResponse:$e(e.mapResponse,Bt(r,t==null?void 0:t.mapResponse)),afterResponse:$e(e.afterResponse,Bt(r,t==null?void 0:t.afterResponse)),trace:$e(e.trace,Bt(r,t==null?void 0:t.trace)),error:$e(e.error,Bt(r,t==null?void 0:t.error)),stop:$e(e.stop,Bt(r,t==null?void 0:t.stop))}),Pb=(e,t,{skipIfHasType:r=!1}={})=>{if(!e)return e;if(!Array.isArray(e))return r?e.scope??(e.scope=t):e.scope=t,e;for(const n of e)r?n.scope??(n.scope=t):n.scope=t;return e},gr=e=>{if(!e)return e;if(!Array.isArray(e))switch(e.scope){case"global":case"scoped":return{...e};default:return{fn:e}}const t=[];for(const r of e)switch(r.scope){case"global":case"scoped":t.push({...r});break}return t},Uc=e=>({...e,type:e==null?void 0:e.type,detail:e==null?void 0:e.detail,parse:gr(e==null?void 0:e.parse),transform:gr(e==null?void 0:e.transform),beforeHandle:gr(e==null?void 0:e.beforeHandle),afterHandle:gr(e==null?void 0:e.afterHandle),mapResponse:gr(e==null?void 0:e.mapResponse),afterResponse:gr(e==null?void 0:e.afterResponse),error:gr(e==null?void 0:e.error),trace:gr(e==null?void 0:e.trace)}),ro={Continue:100,"Switching Protocols":101,Processing:102,"Early Hints":103,OK:200,Created:201,Accepted:202,"Non-Authoritative Information":203,"No Content":204,"Reset Content":205,"Partial Content":206,"Multi-Status":207,"Already Reported":208,"Multiple Choices":300,"Moved Permanently":301,Found:302,"See Other":303,"Not Modified":304,"Temporary Redirect":307,"Permanent Redirect":308,"Bad Request":400,Unauthorized:401,"Payment Required":402,Forbidden:403,"Not Found":404,"Method Not Allowed":405,"Not Acceptable":406,"Proxy Authentication Required":407,"Request Timeout":408,Conflict:409,Gone:410,"Length Required":411,"Precondition Failed":412,"Payload Too Large":413,"URI Too Long":414,"Unsupported Media Type":415,"Range Not Satisfiable":416,"Expectation Failed":417,"I'm a teapot":418,"Misdirected Request":421,"Unprocessable Content":422,Locked:423,"Failed Dependency":424,"Too Early":425,"Upgrade Required":426,"Precondition Required":428,"Too Many Requests":429,"Request Header Fields Too Large":431,"Unavailable For Legal Reasons":451,"Internal Server Error":500,"Not Implemented":501,"Bad Gateway":502,"Service Unavailable":503,"Gateway Timeout":504,"HTTP Version Not Supported":505,"Variant Also Negotiates":506,"Insufficient Storage":507,"Loop Detected":508,"Not Extended":510,"Network Authentication Required":511},kc=Object.fromEntries(Object.entries(ro).map(([e,t])=>[t,e]));function Sb(e){let t=e;for(;t.endsWith("=");)t=t.slice(0,-1);return t}const Lc=new TextEncoder,Si=async(e,t)=>{if(typeof e!="string")throw new TypeError("Cookie value must be provided as a string.");if(t===null)throw new TypeError("Secret key must be provided.");const r=await crypto.subtle.importKey("raw",Lc.encode(t),{name:"HMAC",hash:"SHA-256"},!1,["sign"]),n=await crypto.subtle.sign("HMAC",r,Lc.encode(e));return e+"."+Sb(Buffer.from(n).toString("base64"))},Dc=async(e,t)=>{if(typeof e!="string")throw new TypeError("Signed cookie string must be provided.");if(t===null)throw new TypeError("Secret key must be provided.");const r=e.slice(0,e.lastIndexOf("."));return await Si(r,t)===e?r:!1},jb=(e,t,r)=>{if(!(!e||typeof e!="object"||!t))for(const[n,i]of Object.entries(t)){if(n in Ib||!(n in e))continue;const o=e[n];if(typeof o=="function"){const s=o(i);if(typeof s=="object")for(const[c,u]of Object.entries(s))r(c)({fn:u})}delete t[n]}},Eb=({globalHook:e,localHook:t})=>r=>(n,i)=>{if(typeof n=="function"&&(n={fn:n}),r==="resolve"&&(n={...n,subType:"resolve"}),"fn"in n||Array.isArray(n)){t[r]||(t[r]=[]),typeof t[r]=="function"&&(t[r]=[t[r]]),Array.isArray(n)?t[r]=t[r].concat(n):t[r].push(n);return}const{insert:o="after",stack:s="local"}=n;typeof i=="function"&&(i={fn:i}),s==="global"?Array.isArray(i)?o==="before"?e[r]=i.concat(e[r]):e[r]=e[r].concat(i):o==="before"?e[r].unshift(i):e[r].push(i):(t[r]||(t[r]=[]),typeof t[r]=="function"&&(t[r]=[t[r]]),Array.isArray(i)?o==="before"?t[r]=i.concat(t[r]):t[r]=t[r].concat(i):o==="before"?t[r].unshift(i):t[r].push(i))},Cb=e=>{if(typeof e=="number")return e;if(e.length<16){if(e.trim().length===0)return null;const t=Number(e);return Number.isNaN(t)?null:t}if(e.length===16){if(e.trim().length===0)return null;const t=Number(e);return Number.isNaN(t)||t.toString()!==e?null:t}return null},ys=e=>Cb(e)!==null;class Nb{constructor(t=console.error){this.onError=t,this.root=null,this.promises=[]}get size(){return this.promises.length}add(t){return this.promises.push(t),this.root||(this.root=this.drain()),t}async drain(){for(;this.promises.length>0;){try{await this.promises[0]}catch(t){this.onError(t)}this.promises.shift()}this.root=null}then(t,r){return(this.root??Promise.resolve()).then(t,r)}}const De=(e,t)=>{if(!e)return e;if(!Array.isArray(e)){if(typeof e=="function"||typeof e=="string")return t?{fn:e,subType:t}:{fn:e};if("fn"in e)return e}const r=[];for(const n of e)typeof n=="function"||typeof n=="string"?r.push(t?{fn:n,subType:t}:{fn:n}):"fn"in n&&r.push(n);return r},Tb=e=>({...e,start:De(e==null?void 0:e.start),request:De(e==null?void 0:e.request),parse:De(e==null?void 0:e.parse),transform:De(e==null?void 0:e.transform),beforeHandle:De(e==null?void 0:e.beforeHandle),afterHandle:De(e==null?void 0:e.afterHandle),mapResponse:De(e==null?void 0:e.mapResponse),afterResponse:De(e==null?void 0:e.afterResponse),trace:De(e==null?void 0:e.trace),error:De(e==null?void 0:e.error),stop:De(e==null?void 0:e.stop)}),Bc=e=>{var r,n,i,o,s,c,u,f,p,m,g;const t={};return(r=e.start)!=null&&r.map&&(t.start=e.start.map(l=>l.fn)),(n=e.request)!=null&&n.map&&(t.request=e.request.map(l=>l.fn)),(i=e.parse)!=null&&i.map&&(t.parse=e.parse.map(l=>l.fn)),(o=e.transform)!=null&&o.map&&(t.transform=e.transform.map(l=>l.fn)),(s=e.beforeHandle)!=null&&s.map&&(t.beforeHandle=e.beforeHandle.map(l=>l.fn)),(c=e.afterHandle)!=null&&c.map&&(t.afterHandle=e.afterHandle.map(l=>l.fn)),(u=e.mapResponse)!=null&&u.map&&(t.mapResponse=e.mapResponse.map(l=>l.fn)),(f=e.afterResponse)!=null&&f.map&&(t.afterResponse=e.afterResponse.map(l=>l.fn)),(p=e.trace)!=null&&p.map&&(t.trace=e.trace.map(l=>l.fn)),(m=e.error)!=null&&m.map&&(t.error=e.error.map(l=>l.fn)),(g=e.stop)!=null&&g.map&&(t.stop=e.stop.map(l=>l.fn)),t},fo=e=>({body:e.body,cookie:e.cookie,headers:e.headers,query:e.query,set:e.set,server:e.server,request:e.request,route:e.route}),gu=(e,t=302)=>Response.redirect(e,t),no=Symbol("ElysiaRequestId"),hu=()=>{const e=crypto.randomUUID();return e.slice(0,8)+e.slice(24,32)},_c=e=>{const t=[];for(let r=0;r<e.length;r++){const n=e[r];n.checksum&&(t.includes(n.checksum)&&(e.splice(r,1),r--),t.push(n.checksum))}return e},tt=(e,t="scoped")=>{if(e){if(t==="scoped"){for(const r of e)"scope"in r&&r.scope==="local"&&(r.scope="scoped");return}for(const r of e)"scope"in r&&(r.scope="global")}},sn=e=>e.charCodeAt(e.length-1)===47?e.slice(0,e.length-1):e+"/",Mt=e=>{if(!e)return!1;for(const t in e)return!0;return!1},_t=e=>Array.isArray(e)?e.length===0:!e,uo=e=>{const t={...e};return _t(e.afterHandle)&&delete t.afterHandle,_t(e.afterResponse)&&delete t.afterResponse,_t(e.beforeHandle)&&delete t.beforeHandle,_t(e.error)&&delete t.error,_t(e.mapResponse)&&delete t.mapResponse,_t(e.parse)&&delete t.parse,_t(e.request)&&delete t.request,_t(e.start)&&delete t.start,_t(e.stop)&&delete t.stop,_t(e.trace)&&delete t.trace,_t(e.transform)&&delete t.transform,t.type||delete t.type,t.detail&&!Object.keys(t.detail).length&&delete t.detail,t.body||delete t.body,t.cookie||delete t.cookie,t.headers||delete t.headers,t.query||delete t.query,t.params||delete t.params,t.response||delete t.response,t},Tn=(e,{dynamic:t=!1}={})=>{let r=encodeURIComponent(e).replace(/%2F/g,"/");return t&&(r=r.replace(/%3A/g,":").replace(/%3F/g,"?")),r},nn=typeof Bun<"u"?Bun.env:typeof process<"u"?process==null?void 0:process.env:void 0,ji=Symbol("ElysiaErrorCode"),Ei=((nn==null?void 0:nn.NODE_ENV)??(nn==null?void 0:nn.ENV))==="production";class tr{constructor(t,r){const n=r??(t in kc?kc[t]:t);this.code=ro[t]??t,this.response=n}}const $u=(e,t)=>new tr(e,t);class Mb extends Error{constructor(t){super(t??"INTERNAL_SERVER_ERROR"),this.code="INTERNAL_SERVER_ERROR",this.status=500}}class bu extends Error{constructor(t){super(t??"NOT_FOUND"),this.code="NOT_FOUND",this.status=404}}class Ub extends Error{constructor(){super("Bad Request"),this.code="PARSE",this.status=400}}class qc extends Error{constructor(t,r){super(r??`"${t}" has invalid cookie signature`),this.key=t,this.code="INVALID_COOKIE_SIGNATURE",this.status=400}}const Ht=e=>{if(!e)return{summary:void 0};const{message:t,path:r,value:n,type:i}=e,o=r.slice(1).replaceAll("/","."),s=r==="";switch(i){case 42:return{...e,summary:s?"Value should not be provided":`Property '${o}' should not be provided`};case 45:return{...e,summary:s?"Value is missing":`Property '${o}' is missing`};case 50:const c=t.indexOf("'"),u=t.slice(c+1,t.indexOf("'",c+1));return{...e,summary:s?"Value should be an email":`Property '${o}' should be ${u}`};case 54:return{...e,summary:`${t.slice(0,9)} property '${o}' to be ${t.slice(8)} but found: ${n}`};case 62:const f=e.schema.anyOf.map(p=>`'${(p==null?void 0:p.format)??p.type}'`).join(", ");return{...e,summary:s?`Value should be one of ${f}`:`Property '${o}' should be one of: ${f}`};default:return{summary:t,...e}}};class Y extends Error{constructor(t,r,n){var u,f;n&&typeof n=="object"&&n instanceof tr&&(n=n.response);const i=Ei?void 0:"Errors"in r?r.Errors(n).First():wr(r,n).First(),o=(u=i==null?void 0:i.schema)!=null&&u.message||((f=i==null?void 0:i.schema)==null?void 0:f.error)!==void 0?typeof i.schema.error=="function"?i.schema.error({type:t,validator:r,value:n,get errors(){return[...r.Errors(n)].map(Ht)}}):i.schema.error:void 0,s=(i==null?void 0:i.path)||"root";let c="";if(o!==void 0)c=typeof o=="object"?JSON.stringify(o):o+"";else if(Ei)c=JSON.stringify({type:"validation",on:t,summary:Ht(i).summary,message:i==null?void 0:i.message,found:n});else{const p=(r==null?void 0:r.schema)??r,m="Errors"in r?[...r.Errors(n)].map(Ht):[...wr(r,n)].map(Ht);let g;try{g=Hn(p)}catch(l){g={type:"Could not create expected value",message:l==null?void 0:l.message,error:l}}c=JSON.stringify({type:"validation",on:t,summary:Ht(i).summary,property:s,message:i==null?void 0:i.message,expected:g,found:n,errors:m},null,2)}super(c),this.type=t,this.validator=r,this.value=n,this.code="VALIDATION",this.status=422,Object.setPrototypeOf(this,Y.prototype)}get all(){return"Errors"in this.validator?[...this.validator.Errors(this.value)].map(Ht):[...wr(this.validator,this.value)].map(Ht)}static simplifyModel(t){const r="schema"in t?t.schema:t;try{return Hn(r)}catch{return r}}get model(){return Y.simplifyModel(this.validator)}toResponse(t){return new Response(this.message,{status:400,headers:{...t,"content-type":"application/json"}})}}const Ou=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,xu=/(?:Sun|Mon|Tue|Wed|Thu|Fri|Sat)\s(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s\d{2}\s\d{4}\s\d{2}:\d{2}:\d{2}\sGMT(?:\+|-)\d{4}\s\([^)]+\)/,wu=/^(?:(?:(?:(?:0?[1-9]|[12][0-9]|3[01])[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:19|20)\d{2})|(?:(?:19|20)\d{2}[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:0?[1-9]|[12][0-9]|3[01]))))(?:\s(?:1[012]|0?[1-9]):[0-5][0-9](?::[0-5][0-9])?(?:\s[AP]M)?)?$/,kb=ps.date,Lb=ps["date-time"];Xt("date")||dr("date",e=>{const t=e.replace(/"/g,"");if(Ou.test(t)||xu.test(t)||wu.test(t)||kb(t)){const r=new Date(t);if(!Number.isNaN(r.getTime()))return!0}return!1});Xt("date-time")||dr("date-time",e=>{const t=e.replace(/"/g,"");if(Ou.test(t)||xu.test(t)||wu.test(t)||Lb(t)){const r=new Date(t);if(!Number.isNaN(r.getTime()))return!0}return!1});Object.entries(ps).forEach(e=>{const[t,r]=e;Xt(t)||(r instanceof RegExp?dr(t,n=>r.test(n)):typeof r=="function"&&dr(t,r))});const I=Object.assign({},Tr),Kc=e=>{if(typeof e=="string")switch(e.slice(-1)){case"k":return+e.slice(0,e.length-1)*1024;case"m":return+e.slice(0,e.length-1)*1048576;default:return+e}return e},Hc=(e,t)=>e.startsWith(t)?!0:t.charCodeAt(t.length-1)===42&&t.charCodeAt(t.length-2)===47&&e.startsWith(t.slice(0,-1)),Fo=(e,t)=>{if(!(t instanceof Blob)||e.minSize&&t.size<Kc(e.minSize)||e.maxSize&&t.size>Kc(e.maxSize))return!1;if(e.extension){if(typeof e.extension=="string")return Hc(t.type,e.extension);for(let r=0;r<e.extension.length;r++)if(Hc(t.type,e.extension[r]))return!0;return!1}return!0},Db=Ru("File",Fo),Bb=Ru("Files",(e,t)=>{if(!Array.isArray(t))return Fo(e,t);if(e.minItems&&t.length<e.minItems||e.maxItems&&t.length>e.maxItems)return!1;for(let r=0;r<t.length;r++)if(!Fo(e,t[r]))return!1;return!0});Xt("numeric")||dr("numeric",e=>!!e&&!isNaN(+e));Xt("integer")||dr("integer",e=>!!e&&Number.isInteger(+e));Xt("boolean")||dr("boolean",e=>e==="true"||e==="false");Xt("ObjectString")||dr("ObjectString",e=>{let t=e.charCodeAt(0);if((t===9||t===10||t===32)&&(t=e.trimStart().charCodeAt(0)),t!==123&&t!==91)return!1;try{return JSON.parse(e),!0}catch{return!1}});Xt("ArrayString")||dr("ArrayString",e=>{let t=e.charCodeAt(0);if((t===9||t===10||t===32)&&(t=e.trimStart().charCodeAt(0)),t!==123&&t!==91)return!1;try{return JSON.parse(e),!0}catch{return!1}});Rr("UnionEnum")||xf("UnionEnum",(e,t)=>(typeof t=="number"||typeof t=="string"||t===null)&&e.enum.includes(t));const Dt={Numeric:e=>{const t=Tr.Number(e);return I.Transform(I.Union([I.String({format:"numeric",default:0}),I.Number(e)],e)).Decode(r=>{const n=+r;if(isNaN(n))return r;if(e&&!ge(t,n))throw new Y("property",t,n);return n}).Encode(r=>r)},Integer:e=>{const t=Tr.Integer(e);return I.Transform(I.Union([I.String({format:"integer",default:0}),Tr.Integer(e)],e)).Decode(r=>{const n=+r;if(!ge(t,n))throw new Y("property",t,n);return n}).Encode(r=>r)},Date:e=>{const t=Tr.Date(e),r=e!=null&&e.default?new Date(e.default):void 0;return I.Transform(I.Union([Tr.Date(e),I.String({format:"date",default:r==null?void 0:r.toISOString()}),I.String({format:"date-time",default:r==null?void 0:r.toISOString()}),I.Number({default:r==null?void 0:r.getTime()})],e)).Decode(n=>{if(typeof n=="number"){const o=new Date(n);if(!ge(t,o))throw new Y("property",t,o);return o}if(n instanceof Date)return n;const i=new Date(n);if(!i||isNaN(i.getTime()))throw new Y("property",t,i);if(!ge(t,i))throw new Y("property",t,i);return i}).Encode(n=>n.toISOString())},BooleanString:e=>{const t=Tr.Boolean(e);return I.Transform(I.Union([I.Boolean(e),I.String({format:"boolean",default:!1})],e)).Decode(r=>{if(typeof r=="string")return r==="true";if(r!==void 0&&!ge(t,r))throw new Y("property",t,r);return r}).Encode(r=>r)},ObjectString:(e,t)=>{const r=I.Object(e,t),n=JSON.stringify(Hn(r));let i;try{i=mn.Compile(r)}catch{}return I.Transform(I.Union([I.String({format:"ObjectString",default:n}),r])).Decode(o=>{if(typeof o=="string"){if(o.charCodeAt(0)!==123)throw new Y("property",r,o);try{o=JSON.parse(o)}catch{throw new Y("property",r,o)}if(i){if(!i.Check(o))throw new Y("property",r,o);return i.Decode(o)}if(!ge(r,o))throw new Y("property",r,o);return Mn(r,o)}return o}).Encode(o=>{if(typeof o=="string")try{o=JSON.parse(o)}catch{throw new Y("property",r,o)}if(!ge(r,o))throw new Y("property",r,o);return JSON.stringify(o)})},ArrayString:(e=I.String(),t)=>{const r=I.Array(e,t);let n;try{n=mn.Compile(r)}catch{}const i=(o,s=!1)=>{if(o.charCodeAt(0)===91){try{o=JSON.parse(o)}catch{throw new Y("property",r,o)}if(n){if(!n.Check(o))throw new Y("property",r,o);return n.Decode(o)}if(!ge(r,o))throw new Y("property",r,o);return Mn(r,o)}if(o.indexOf(",")!==-1){const c=o.split(",").map(u=>u.trim());if(n){if(!n.Check(c))throw new Y("property",r,o);return n.Decode(c)}if(!ge(r,c))throw new Y("property",r,c);return Mn(r,c)}if(s)return o;throw new Y("property",r,o)};return I.Transform(I.Union([I.String({format:"ArrayString",default:t==null?void 0:t.default}),r])).Decode(o=>{if(Array.isArray(o)){let s=[];for(let c=0;c<o.length;c++){const u=o[c];if(typeof u=="string"){const f=i(u,!0);Array.isArray(f)?s=s.concat(f):s.push(f);continue}s.push(u)}return s}return typeof o=="string"?i(o):o}).Encode(o=>{if(typeof o=="string")try{o=JSON.parse(o)}catch{throw new Y("property",r,o)}if(!ge(r,o))throw new Y("property",r,o);return JSON.stringify(o)})},File:Db,Files:(e={})=>I.Transform(Bb(e)).Decode(t=>Array.isArray(t)?t:[t]).Encode(t=>t),Nullable:(e,t)=>I.Union([e,I.Null()],t),MaybeEmpty:(e,t)=>I.Union([e,I.Null(),I.Undefined()],t),Cookie:(e,{domain:t,expires:r,httpOnly:n,maxAge:i,path:o,priority:s,sameSite:c,secure:u,secrets:f,sign:p,...m}={})=>{const g=I.Object(e,m);return g.config={domain:t,expires:r,httpOnly:n,maxAge:i,path:o,priority:s,sameSite:c,secure:u,secrets:f,sign:p},g},UnionEnum:(e,t={})=>{const r=e.every(n=>typeof n=="string")?{type:"string"}:e.every(n=>typeof n=="number")?{type:"number"}:e.every(n=>n===null)?{type:"null"}:{};if(e.some(n=>typeof n=="object"&&n!==null))throw new Error("This type does not support objects or arrays");return{default:e[0],...t,[R]:"UnionEnum",...r,enum:e}}};I.BooleanString=Dt.BooleanString;I.ObjectString=Dt.ObjectString;I.ArrayString=Dt.ArrayString;I.Numeric=Dt.Numeric;I.Integer=Dt.Integer;I.File=(e={})=>Dt.File({default:"File",...e,extension:e==null?void 0:e.type,type:"string",format:"binary"});I.Files=(e={})=>Dt.Files({...e,elysiaMeta:"Files",default:"Files",extension:e==null?void 0:e.type,type:"array",items:{...e,default:"Files",type:"string",format:"binary"}});I.Nullable=e=>Dt.Nullable(e);I.MaybeEmpty=Dt.MaybeEmpty;I.Cookie=Dt.Cookie;I.Date=Dt.Date;I.UnionEnum=Dt.UnionEnum;function Ru(e,t){return Rr(e)||xf(e,t),(r={})=>tu({...r,[R]:e})}const kn=e=>{const t=typeof e=="object"?e.fn.toString():typeof e=="string"?e.toString():e,r=t.indexOf(")");return t.charCodeAt(r+2)===61&&t.charCodeAt(r+5)!==123?!0:t.includes("return")},_b=e=>{e.startsWith("async")&&(e=e.slice(5)),e=e.trimStart();let t=-1;if(e.charCodeAt(0)===40&&(t=e.indexOf("=>",e.indexOf(")")),t!==-1)){let i=t;for(;i>0&&e.charCodeAt(--i)!==41;);let o=e.slice(t+2);return o.charCodeAt(0)===32&&(o=o.trimStart()),[e.slice(1,i),o,{isArrowReturn:o.charCodeAt(0)!==123}]}if(/^(\w+)=>/g.test(e)&&(t=e.indexOf("=>"),t!==-1)){let i=e.slice(t+2);return i.charCodeAt(0)===32&&(i=i.trimStart()),[e.slice(0,t),i,{isArrowReturn:i.charCodeAt(0)!==123}]}if(e.startsWith("function")){t=e.indexOf("(");const i=e.indexOf(")");return[e.slice(t+1,i),e.slice(i+2),{isArrowReturn:!1}]}const r=e.indexOf("(");if(r!==-1){const i=e.indexOf(`
`,2),o=e.slice(0,i),s=o.lastIndexOf(")")+1,c=e.slice(i+1);return[o.slice(r,s),"{"+c,{isArrowReturn:!1}]}const n=e.split(`
`,2);return[n[0],n[1],{isArrowReturn:!1}]},qb=e=>{const t=e.indexOf("{");if(t===-1)return[-1,0];let r=t+1,n=1;for(;r<e.length;r++){const i=e.charCodeAt(r);if(i===123?n++:i===125&&n--,n===0)break}return n!==0?[0,e.length]:[t,r+1]},Kb=e=>{const t=e.lastIndexOf("}");if(t===-1)return[-1,0];let r=t-1,n=1;for(;r>=0;r--){const i=e.charCodeAt(r);if(i===125?n++:i===123&&n--,n===0)break}return n!==0?[-1,0]:[r,t+1]},Iu=e=>{for(;;){const t=e.indexOf(":");if(t===-1)break;let r=e.indexOf(",",t);r===-1&&(r=e.indexOf("}",t)-1),r===-2&&(r=e.length),e=e.slice(0,t)+e.slice(r)}return e},Fu=e=>{let t=!1;e.charCodeAt(0)===40&&(e=e.slice(1,-1)),e.charCodeAt(0)===123&&(t=!0,e=e.slice(1,-1)),e=e.replace(/( |\t|\n)/g,"").trim();let r=[];for(;;){let[i,o]=qb(e);if(i===-1)break;r.push(e.slice(0,i-1)),e.charCodeAt(o)===44&&o++,e=e.slice(o)}e=Iu(e),e&&(r=r.concat(e.split(",")));const n=[];for(const i of r){if(i.indexOf(",")===-1){n.push(i);continue}for(const o of i.split(","))n.push(o.trim())}return r=n,{hasParenthesis:t,parameters:r}},Hb=(e,t)=>{const{parameters:r,hasParenthesis:n}=Fu(e);return!t.query&&r.includes("query")&&(t.query=!0),!t.headers&&r.includes("headers")&&(t.headers=!0),!t.body&&r.includes("body")&&(t.body=!0),!t.cookie&&r.includes("cookie")&&(t.cookie=!0),!t.set&&r.includes("set")&&(t.set=!0),!t.server&&r.includes("server")&&(t.server=!0),!t.request&&r.includes("request")&&(t.request=!0),!t.route&&r.includes("route")&&(t.route=!0),n?`{ ${r.join(", ")} }`:r.join(", ")},zc=(e,t,r)=>{const n=t.indexOf(e+`
`,r),i=t.indexOf(e+"	",r),o=t.indexOf(e+",",r),s=t.indexOf(e+";",r),c=t.indexOf(e+" ",r);return[n,i,o,s,c].filter(u=>u>0).sort((u,f)=>u-f)[0]||-1},Au=(e,t,r=0)=>{if(r>5)return[];const n=[];let i=t;for(;;){let o=zc(" = "+e,i);if(o===-1&&(o=zc("="+e,i)),o===-1){let f=i.indexOf(" = "+e);if(f===-1&&(f=i.indexOf("="+e)),f+3+e.length!==i.length)break;o=f}const s=i.slice(0,o),c=s.lastIndexOf(" ");let u=s.slice(c!==-1?c+1:-1);if(u==="}"){const[f,p]=Kb(s);n.push(Iu(i.slice(f,p))),i=i.slice(o+3+e.length);continue}for(;u.charCodeAt(0)===44;)u=u.slice(1);for(;u.charCodeAt(0)===9;)u=u.slice(1);u.includes("(")||n.push(u),i=i.slice(o+3+e.length)}for(const o of n){if(o.charCodeAt(0)===123)continue;const s=Au(o,t);s.length>0&&n.push(...s)}return n},zb=e=>{if(!e)return;if(e.charCodeAt(0)!==123)return e;if(e=e.slice(2,-2),!e.includes(","))return e.includes("...")?e.slice(e.indexOf("...")+3):void 0;const r=e.indexOf("...");if(r!==-1)return e.slice(r+3).trimEnd()},Jb=(e,t,r)=>{const n=(i,o)=>e.includes(o+"."+i)||e.includes(o+'["'+i+'"]')||e.includes(o+"['"+i+"']");for(const i of t)if(i){if(i.charCodeAt(0)===123){const o=Fu(i).parameters;!r.query&&o.includes("query")&&(r.query=!0),!r.headers&&o.includes("headers")&&(r.headers=!0),!r.body&&o.includes("body")&&(r.body=!0),!r.cookie&&o.includes("cookie")&&(r.cookie=!0),!r.set&&o.includes("set")&&(r.set=!0),!r.query&&o.includes("server")&&(r.server=!0),!r.request&&o.includes("request")&&(r.request=!0),!r.route&&o.includes("route")&&(r.route=!0);continue}if(!r.query&&n("query",i)&&(r.query=!0),(e.includes("return "+i)||e.includes("return "+i+".query"))&&(r.query=!0),!r.headers&&n("headers",i)&&(r.headers=!0),!r.body&&n("body",i)&&(r.body=!0),!r.cookie&&n("cookie",i)&&(r.cookie=!0),!r.set&&n("set",i)&&(r.set=!0),!r.server&&n("server",i)&&(r.server=!0),r.query&&r.headers&&r.body&&r.cookie&&r.set&&r.server&&r.server&&r.route)break}return t},Gb=(e,t,r)=>{try{const n=new RegExp(`(?:\\w)\\((?:.*)?${e}`,"gs");n.test(t);const i=t.charCodeAt(n.lastIndex);return i===41||i===44?(r.query=!0,r.headers=!0,r.body=!0,r.cookie=!0,r.set=!0,r.server=!0,r.route=!0,r.request=!0,!0):!1}catch{return console.log("[Sucrose] warning: unexpected isContextPassToFunction error, you may continue development as usual but please report the following to maintainers:"),console.log("--- body ---"),console.log(t),console.log("--- context ---"),console.log(e),!0}},Pu=(e,t={query:!1,headers:!1,body:!1,cookie:!1,set:!1,server:!1,request:!1,route:!1})=>{var n,i,o,s,c,u,f,p;const r=[];e.handler&&typeof e.handler=="function"&&r.push(e.handler),(n=e.request)!=null&&n.length&&r.push(...e.request),(i=e.beforeHandle)!=null&&i.length&&r.push(...e.beforeHandle),(o=e.parse)!=null&&o.length&&r.push(...e.parse),(s=e.error)!=null&&s.length&&r.push(...e.error),(c=e.transform)!=null&&c.length&&r.push(...e.transform),(u=e.afterHandle)!=null&&u.length&&r.push(...e.afterHandle),(f=e.mapResponse)!=null&&f.length&&r.push(...e.mapResponse),(p=e.afterResponse)!=null&&p.length&&r.push(...e.afterResponse);for(const m of r){if(!m)continue;const g="fn"in m?m.fn:m;if(typeof g!="function")continue;const[l,h,{isArrowReturn:a}]=_b(g.toString()),x=Hb(l,t),P=zb(x);if(P){const D=Au(P,h.slice(1,-1));D.splice(0,-1,P);let B=h;B.charCodeAt(0)===123&&B.charCodeAt(h.length-1)===125&&(B=B.slice(1,-1)),Gb(P,B,t)||Jb(B,D,t),!t.query&&B.includes("return "+P+".query")&&(t.query=!0)}if(t.query&&t.headers&&t.body&&t.cookie&&t.set&&t.server&&t.request&&t.route)break}return t};var Nn={},Jc;function Wb(){if(Jc)return Nn;Jc=1,Object.defineProperty(Nn,"__esModule",{value:!0}),Nn.parse=s,Nn.serialize=f;const e=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,t=/^[\u0021-\u003A\u003C-\u007E]*$/,r=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,n=/^[\u0020-\u003A\u003D-\u007E]*$/,i=Object.prototype.toString,o=(()=>{const g=function(){};return g.prototype=Object.create(null),g})();function s(g,l){const h=new o,a=g.length;if(a<2)return h;const x=(l==null?void 0:l.decode)||p;let P=0;do{const D=g.indexOf("=",P);if(D===-1)break;const B=g.indexOf(";",P),H=B===-1?a:B;if(D>H){P=g.lastIndexOf(";",D-1)+1;continue}const oe=c(g,P,D),N=u(g,D,oe),z=g.slice(oe,N);if(h[z]===void 0){let E=c(g,D+1,H),U=u(g,H,E);const ue=x(g.slice(E,U));h[z]=ue}P=H+1}while(P<a);return h}function c(g,l,h){do{const a=g.charCodeAt(l);if(a!==32&&a!==9)return l}while(++l<h);return h}function u(g,l,h){for(;l>h;){const a=g.charCodeAt(--l);if(a!==32&&a!==9)return l+1}return h}function f(g,l,h){const a=(h==null?void 0:h.encode)||encodeURIComponent;if(!e.test(g))throw new TypeError(`argument name is invalid: ${g}`);const x=a(l);if(!t.test(x))throw new TypeError(`argument val is invalid: ${l}`);let P=g+"="+x;if(!h)return P;if(h.maxAge!==void 0){if(!Number.isInteger(h.maxAge))throw new TypeError(`option maxAge is invalid: ${h.maxAge}`);P+="; Max-Age="+h.maxAge}if(h.domain){if(!r.test(h.domain))throw new TypeError(`option domain is invalid: ${h.domain}`);P+="; Domain="+h.domain}if(h.path){if(!n.test(h.path))throw new TypeError(`option path is invalid: ${h.path}`);P+="; Path="+h.path}if(h.expires){if(!m(h.expires)||!Number.isFinite(h.expires.valueOf()))throw new TypeError(`option expires is invalid: ${h.expires}`);P+="; Expires="+h.expires.toUTCString()}if(h.httpOnly&&(P+="; HttpOnly"),h.secure&&(P+="; Secure"),h.partitioned&&(P+="; Partitioned"),h.priority)switch(typeof h.priority=="string"?h.priority.toLowerCase():void 0){case"low":P+="; Priority=Low";break;case"medium":P+="; Priority=Medium";break;case"high":P+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${h.priority}`)}if(h.sameSite)switch(typeof h.sameSite=="string"?h.sameSite.toLowerCase():h.sameSite){case!0:case"strict":P+="; SameSite=Strict";break;case"lax":P+="; SameSite=Lax";break;case"none":P+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${h.sameSite}`)}return P}function p(g){if(g.indexOf("%")===-1)return g;try{return decodeURIComponent(g)}catch{return g}}function m(g){return i.call(g)==="[object Date]"}return Nn}var Su=Wb();const kr=[];for(let e=48;e<58;e++)kr[e]=e-48;for(let e=0;e<6;e++)kr[e+65]=kr[e+97]=e+10;const Yb=(e,t)=>e in kr&&t in kr?kr[e]<<4|kr[t]:255,ju=[...new Array(128).fill(0),...new Array(16).fill(1),...new Array(16).fill(2),...new Array(32).fill(3),4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,7,7,7,7,7,7,7,7,7,7,7,7,8,7,7,10,9,9,9,11,4,4,4,4,4,4,4,4,4,4,4],Qb=[0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,24,36,48,60,72,84,96,0,12,12,12,0,0,0,0,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,0,0,24,24,24,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,0,0,0,0,0,48,48,48,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,48,0,0,0,0,0,0,0,0,0,0],Gc=ju.map(e=>[127,63,63,63,0,31,15,15,15,7,7,7][e]),$r=e=>{let t=e.indexOf("%");if(t===-1)return e;let r=e.length-3;if(t>r)return null;let n="",i=0,o=0,s=t,c=12,u;for(;;){if(u=Yb(e.charCodeAt(t+1),e.charCodeAt(t+2)),c=Qb[c+ju[u]],c===0)return null;if(c===12){if(n+=e.substring(i,s),o=o<<6|u&Gc[u],o>65535?n+=String.fromCharCode(55232+(o>>10),56320+(o&1023)):n+=String.fromCharCode(o),i=t+3,t=e.indexOf("%",i),t===-1)return n+e.substring(i);if(t>r)return null;s=t,o=0}else{if(t+=3,t>r||e.charCodeAt(t)!==37)return null;o=o<<6|u&Gc[u]}}};class zn{constructor(t,r,n={}){this.name=t,this.jar=r,this.initial=n}get cookie(){return this.jar[this.name]??this.initial}set cookie(t){this.name in this.jar||(this.jar[this.name]=this.initial),this.jar[this.name]=t}get setCookie(){return this.name in this.jar||(this.jar[this.name]=this.initial),this.jar[this.name]}set setCookie(t){this.cookie=t}get value(){return this.cookie.value}set value(t){this.setCookie.value=t}get expires(){return this.cookie.expires}set expires(t){this.setCookie.expires=t}get maxAge(){return this.cookie.maxAge}set maxAge(t){this.setCookie.maxAge=t}get domain(){return this.cookie.domain}set domain(t){this.setCookie.domain=t}get path(){return this.cookie.path}set path(t){this.setCookie.path=t}get secure(){return this.cookie.secure}set secure(t){this.setCookie.secure=t}get httpOnly(){return this.cookie.httpOnly}set httpOnly(t){this.setCookie.httpOnly=t}get sameSite(){return this.cookie.sameSite}set sameSite(t){this.setCookie.sameSite=t}get priority(){return this.cookie.priority}set priority(t){this.setCookie.priority=t}get partitioned(){return this.cookie.partitioned}set partitioned(t){this.setCookie.partitioned=t}get secrets(){return this.cookie.secrets}set secrets(t){this.setCookie.secrets=t}update(t){return this.setCookie=Object.assign(this.cookie,typeof t=="function"?t(this.cookie):t),this}set(t){return this.setCookie=Object.assign({...this.initial,value:this.value},typeof t=="function"?t(this.cookie):t),this}remove(){if(this.value!==void 0)return this.set({expires:new Date(0),maxAge:0,value:""}),this}toString(){var t;return typeof this.value=="object"?JSON.stringify(this.value):((t=this.value)==null?void 0:t.toString())??""}}const Wc=(e,t,r)=>(e.cookie||(e.cookie={}),new Proxy(t,{get(n,i){return i in t?new zn(i,e.cookie,Object.assign({},r??{},t[i])):new zn(i,e.cookie,Object.assign({},r))}})),Eu=async(e,t,{secrets:r,sign:n,...i}={})=>{if(!t)return Wc(e,{},i);const o=typeof r=="string";n&&n!==!0&&!Array.isArray(n)&&(n=[n]);const s={},c=Su.parse(t);for(const[u,f]of Object.entries(c)){if(f===void 0)continue;let p=$r(f);if(n===!0||n!=null&&n.includes(u)){if(!r)throw new Error("No secret is provided to cookie plugin");if(o){const m=await Dc(p,r);if(m===!1)throw new qc(u);p=m}else{let m=!0;for(let g=0;g<r.length;g++){const l=await Dc(p,r[g]);if(l!==!1){m=!0,p=l;break}}if(!m)throw new qc(u)}}s[u]={value:p}}return Wc(e,s,i)},Cu=e=>{if(!e||!Mt(e))return;const t=[];for(const[r,n]of Object.entries(e)){if(!r||!n)continue;const i=n.value;i!=null&&t.push(Su.serialize(r,typeof i=="object"?JSON.stringify(i):i+"",n))}if(t.length!==0)return t.length===1?t[0]:t},br=(e,t)=>{const r=e.size;if(!t&&r||r&&t&&t.status!==206&&t.status!==304&&t.status!==412&&t.status!==416){if(t){if(t.headers instanceof Headers){let n={"accept-ranges":"bytes","content-range":`bytes 0-${r-1}/${r}`,"transfer-encoding":"chunked"};if(Pi)n=t.headers.toJSON();else{n={};for(const[i,o]of t.headers.entries())i in t.headers&&(n[i]=o)}return new Response(e,{status:t.status,headers:n})}if(Mt(t.headers))return new Response(e,{status:t.status,headers:Object.assign({"accept-ranges":"bytes","content-range":`bytes 0-${r-1}/${r}`,"transfer-encoding":"chunked"},t.headers)})}return new Response(e,{headers:{"accept-ranges":"bytes","content-range":`bytes 0-${r-1}/${r}`,"transfer-encoding":"chunked"}})}return new Response(e)},Nu=(e,t)=>{if(!e)return e;e.delete("set-cookie");for(let r=0;r<t.length;r++){const n=t[r].indexOf("=");e.append("set-cookie",`${t[r].slice(0,n)}=${t[r].slice(n+1)||""}`)}return e},Lr=(e,t)=>{if(t!=null&&t.headers){if(e)if(Pi)Object.assign(t.headers,e.headers.toJSON());else for(const[r,n]of e.headers.entries())r in t.headers&&(t.headers[r]=n);return t.status===200&&(t.status=e.status),t.headers["content-encoding"]&&delete t.headers["content-encoding"],t}if(!e)return{headers:{},status:(t==null?void 0:t.status)??200};if(Pi)return t={headers:e.headers.toJSON(),status:(t==null?void 0:t.status)??200},t.headers["content-encoding"]&&delete t.headers["content-encoding"],t;t={headers:{},status:(t==null?void 0:t.status)??200};for(const[r,n]of e.headers.entries())r!=="content-encoding"&&r in t.headers&&(t.headers[r]=n);return t},Nt=async(e,t,r)=>{let n=e.next();return n instanceof Promise&&(n=await n),n.done?t?pt(n.value,t,r):Or(n.value,r):(t!=null&&t.headers?(t.headers["transfer-encoding"]||(t.headers["transfer-encoding"]="chunked"),t.headers["content-type"]||(t.headers["content-type"]="text/event-stream; charset=utf-8")):t={status:200,headers:{"content-type":"text/event-stream; charset=utf-8","transfer-encoding":"chunked"}},new Response(new ReadableStream({async start(i){var s;let o=!1;if((s=r==null?void 0:r.signal)==null||s.addEventListener("abort",()=>{o=!0;try{i.close()}catch{}}),n.value!==void 0&&n.value!==null)if(typeof n.value=="object")try{i.enqueue(Buffer.from(JSON.stringify(n.value)))}catch{i.enqueue(Buffer.from(n.value.toString()))}else i.enqueue(Buffer.from(n.value.toString()));for await(const c of e){if(o)break;if(c!=null){if(typeof c=="object")try{i.enqueue(Buffer.from(JSON.stringify(c)))}catch{i.enqueue(Buffer.from(c.toString()))}else i.enqueue(Buffer.from(c.toString()));await new Promise(u=>setTimeout(()=>u(),0))}}try{i.close()}catch{}}}),t))};async function*Dr(e){const t=e.body;if(!t)return;const r=t.getReader(),n=new TextDecoder;try{for(;;){const{done:i,value:o}=await r.read();if(i)break;yield n.decode(o)}}finally{r.releaseLock()}}const Tu=e=>{if(typeof e.status=="string"&&(e.status=ro[e.status]),e.cookie&&Mt(e.cookie)){const t=Cu(e.cookie);t&&(e.headers["set-cookie"]=t)}e.headers["set-cookie"]&&Array.isArray(e.headers["set-cookie"])&&(e.headers=Nu(new Headers(e.headers),e.headers["set-cookie"]))},Ci=(e,t)=>{var n;e.status!==t.status&&t.status!==200&&(e.status<=300||e.status>400)&&(e=new Response(e.body,{headers:e.headers,status:t.status}));let r=!1;if(t.headers instanceof Headers)for(const i of t.headers.keys())if(i==="set-cookie"){if(r)continue;r=!0;for(const o of t.headers.getSetCookie())e.headers.append("set-cookie",o)}else e.headers.append(i,((n=t.headers)==null?void 0:n.get(i))??"");else for(const i in t.headers)e.headers.append(i,t.headers[i]);return e},pt=(e,t,r)=>{var n,i,o;if(Mt(t.headers)||t.status!==200||t.cookie)switch(Tu(t),(n=e==null?void 0:e.constructor)==null?void 0:n.name){case"String":return new Response(e,t);case"Array":case"Object":return Response.json(e,t);case"ElysiaFile":return br(e.value);case"Blob":return br(e,t);case"ElysiaCustomStatusResponse":return t.status=e.code,pt(e.response,t,r);case"ReadableStream":return(i=t.headers["content-type"])!=null&&i.startsWith("text/event-stream")||(t.headers["content-type"]="text/event-stream; charset=utf-8"),(o=r==null?void 0:r.signal)==null||o.addEventListener("abort",{handleEvent(){var s;r!=null&&r.signal&&!((s=r==null?void 0:r.signal)!=null&&s.aborted)&&e.cancel()}},{once:!0}),new Response(e,t);case void 0:return e?Response.json(e,t):new Response("",t);case"Response":return e=Ci(e,t),!e.headers.has("content-length")&&e.headers.get("transfer-encoding")==="chunked"?Nt(Dr(e),Lr(e,t),r):e;case"Error":return xr(e,t);case"Promise":return e.then(s=>pt(s,t,r));case"Function":return pt(e(),t,r);case"Number":case"Boolean":return new Response(e.toString(),t);case"Cookie":return e instanceof zn?new Response(e.value,t):new Response(e==null?void 0:e.toString(),t);case"FormData":return new Response(e,t);default:if(e instanceof Response)return e=Ci(e,t),e.headers.get("transfer-encoding")==="chunked"?Nt(Dr(e),Lr(e,t),r):e;if(e instanceof Promise)return e.then(s=>pt(s,t));if(e instanceof Error)return xr(e,t);if(e instanceof tr)return t.status=e.code,pt(e.response,t,r);if(typeof(e==null?void 0:e.next)=="function")return Nt(e,t,r);if(typeof(e==null?void 0:e.then)=="function")return e.then(s=>pt(s,t));if(typeof(e==null?void 0:e.toResponse)=="function")return pt(e.toResponse(),t);if("charCodeAt"in e){const s=e.charCodeAt(0);if(s===123||s===91)return t.headers["Content-Type"]||(t.headers["Content-Type"]="application/json"),new Response(JSON.stringify(e),t)}return new Response(e,t)}return e instanceof Response&&!e.headers.has("content-length")&&e.headers.get("transfer-encoding")==="chunked"?Nt(Dr(e),Lr(e,t),r):typeof(e==null?void 0:e.next)=="function"||e instanceof ReadableStream?Nt(e,t,r):Or(e,r)},dt=(e,t,r)=>{var n,i,o,s,c;if(e!=null)if(Mt(t.headers)||t.status!==200||t.cookie)switch(Tu(t),(n=e==null?void 0:e.constructor)==null?void 0:n.name){case"String":return new Response(e,t);case"Array":case"Object":return Response.json(e,t);case"ElysiaFile":return br(e.value);case"Blob":return br(e,t);case"ElysiaCustomStatusResponse":return t.status=e.code,dt(e.response,t,r);case"ReadableStream":return(i=t.headers["content-type"])!=null&&i.startsWith("text/event-stream")||(t.headers["content-type"]="text/event-stream; charset=utf-8"),(o=r==null?void 0:r.signal)==null||o.addEventListener("abort",{handleEvent(){var u;r!=null&&r.signal&&!((u=r==null?void 0:r.signal)!=null&&u.aborted)&&e.cancel()}},{once:!0}),new Response(e,t);case void 0:return e?Response.json(e,t):void 0;case"Response":return e=Ci(e,t),!e.headers.has("content-length")&&e.headers.get("transfer-encoding")==="chunked"?Nt(Dr(e),Lr(e,t),r):e;case"Promise":return e.then(u=>dt(u,t));case"Error":return xr(e,t);case"Function":return dt(e(),t);case"Number":case"Boolean":return new Response(e.toString(),t);case"FormData":return new Response(e);case"Cookie":return e instanceof zn?new Response(e.value,t):new Response(e==null?void 0:e.toString(),t);default:if(e instanceof Response)return e=Ci(e,t),e.headers.get("transfer-encoding")==="chunked"?Nt(Dr(e),Lr(e,t),r):e;if(e instanceof Promise)return e.then(u=>dt(u,t));if(e instanceof Error)return xr(e,t);if(e instanceof tr)return t.status=e.code,dt(e.response,t,r);if(typeof(e==null?void 0:e.next)=="function")return Nt(e,t,r);if(typeof(e==null?void 0:e.then)=="function")return e.then(u=>dt(u,t));if(typeof(e==null?void 0:e.toResponse)=="function")return dt(e.toResponse(),t);if("charCodeAt"in e){const u=e.charCodeAt(0);if(u===123||u===91)return t.headers["Content-Type"]||(t.headers["Content-Type"]="application/json"),new Response(JSON.stringify(e),t)}return new Response(e,t)}else switch((s=e==null?void 0:e.constructor)==null?void 0:s.name){case"String":return new Response(e);case"Array":case"Object":return Response.json(e,t);case"ElysiaFile":return br(e.value);case"Blob":return br(e,t);case"ElysiaCustomStatusResponse":return t.status=e.code,dt(e.response,t,r);case"ReadableStream":return(c=r==null?void 0:r.signal)==null||c.addEventListener("abort",{handleEvent(){var u;r!=null&&r.signal&&!((u=r==null?void 0:r.signal)!=null&&u.aborted)&&e.cancel()}},{once:!0}),new Response(e,{headers:{"Content-Type":"text/event-stream; charset=utf-8"}});case void 0:return e?new Response(JSON.stringify(e),{headers:{"content-type":"application/json"}}):new Response("");case"Response":return!e.headers.has("content-length")&&e.headers.get("transfer-encoding")==="chunked"?Nt(Dr(e),Lr(e),r):e;case"Promise":return e.then(u=>{const f=dt(u,t);if(f!==void 0)return f});case"Error":return xr(e,t);case"Function":return Or(e(),r);case"Number":case"Boolean":return new Response(e.toString());case"Cookie":return e instanceof zn?new Response(e.value,t):new Response(e==null?void 0:e.toString(),t);case"FormData":return new Response(e);default:if(e instanceof Response)return e;if(e instanceof Promise)return e.then(u=>dt(u,t));if(e instanceof Error)return xr(e,t);if(e instanceof tr)return t.status=e.code,dt(e.response,t,r);if(typeof(e==null?void 0:e.next)=="function")return Nt(e,t,r);if(typeof(e==null?void 0:e.then)=="function")return e.then(u=>dt(u,t));if(typeof(e==null?void 0:e.toResponse)=="function")return dt(e.toResponse(),t);if("charCodeAt"in e){const u=e.charCodeAt(0);if(u===123||u===91)return t.headers["Content-Type"]||(t.headers["Content-Type"]="application/json"),new Response(JSON.stringify(e),t)}return new Response(e)}},Or=(e,t)=>{var r,n;switch((r=e==null?void 0:e.constructor)==null?void 0:r.name){case"String":return new Response(e);case"Object":case"Array":return Response.json(e);case"ElysiaFile":return br(e.value);case"Blob":return br(e);case"ElysiaCustomStatusResponse":return pt(e.response,{status:e.code,headers:{}});case"ReadableStream":return(n=t==null?void 0:t.signal)==null||n.addEventListener("abort",{handleEvent(){var i;t!=null&&t.signal&&!((i=t==null?void 0:t.signal)!=null&&i.aborted)&&e.cancel()}},{once:!0}),new Response(e,{headers:{"Content-Type":"text/event-stream; charset=utf-8"}});case void 0:return e?new Response(JSON.stringify(e),{headers:{"content-type":"application/json"}}):new Response("");case"Response":return e.headers.get("transfer-encoding")==="chunked"?Nt(Dr(e),Lr(e),t):e;case"Error":return xr(e);case"Promise":return e.then(i=>Or(i,t));case"Function":return Or(e(),t);case"Number":case"Boolean":return new Response(e.toString());case"FormData":return new Response(e);default:if(e instanceof Response)return e;if(e instanceof Promise)return e.then(i=>Or(i,t));if(e instanceof Error)return xr(e);if(e instanceof tr)return pt(e.response,{status:e.code,headers:{}});if(typeof(e==null?void 0:e.next)=="function")return Nt(e,void 0,t);if(typeof(e==null?void 0:e.then)=="function")return e.then(i=>pt(i,set));if(typeof(e==null?void 0:e.toResponse)=="function")return Or(e.toResponse());if("charCodeAt"in e){const i=e.charCodeAt(0);if(i===123||i===91)return new Response(JSON.stringify(e),{headers:{"Content-Type":"application/json"}})}return new Response(e)}},xr=(e,t)=>new Response(JSON.stringify({name:e==null?void 0:e.name,message:e==null?void 0:e.message,cause:e==null?void 0:e.cause}),{status:(t==null?void 0:t.status)!==200?(t==null?void 0:t.status)??500:500,headers:t==null?void 0:t.headers}),Zb=(e,t,r={})=>{var i,o,s,c;if(typeof e=="function")return;const n=pt(e,{headers:r});if(!((i=t.parse)!=null&&i.length)&&!((o=t.transform)!=null&&o.length)&&!((s=t.beforeHandle)!=null&&s.length)&&!((c=t.afterHandle)!=null&&c.length))return n.clone.bind(n)},bi={name:"web-standard",isWebStandard:!0,handler:{mapResponse:pt,mapEarlyResponse:dt,mapCompactResponse:Or,createStaticHandler:Zb},composeHandler:{mapResponseContext:"c.request",preferWebstandardHeaders:!0,headers:`c.headers = {}
for (const [key, value] of c.request.headers.entries())c.headers[key] = value
`,parser:{json(e){return e?`try{c.body=await c.request.json()}catch{}
`:`c.body=await c.request.json()
`},text(){return`c.body=await c.request.text()
`},urlencoded(){return`c.body=parseQuery(await c.request.text())
`},arrayBuffer(){return`c.body=await c.request.arrayBuffer()
`},formData(e){let t=`
c.body={}
`;return e?t+="let form;try{form=await c.request.formData()}catch{}":t+=`const form=await c.request.formData()
`,t+`for(const key of form.keys()){if(c.body[key]) continue
const value=form.getAll(key)
if(value.length===1)c.body[key]=value[0]
else c.body[key]=value}`}}},composeGeneralHandler:{parameters:"r",createContext(e){var s,c;let t="",r="";const n=e.setHeaders;for(const u of Object.keys(e.singleton.decorator))t+=`,${u}: decorator['${u}']`;const i=((s=e.config.handler)==null?void 0:s.standardHostname)??!0,o=!!((c=e.event.trace)!=null&&c.length);return r+=`const u=r.url,s=u.indexOf('/',${i?11:7}),qi=u.indexOf('?', s + 1)
let p
if(qi===-1)p=u.substring(s)
else p=u.substring(s, qi)
`,o&&(r+=`const id=randomId()
`),r+="const c={request:r,store,qi,path:p,url:u,redirect,error,set:{headers:",r+=Object.keys(n??{}).length?"Object.assign({}, app.setHeaders)":"{}",r+=",status:200}",e.inference.server&&(r+=",get server(){return app.getServer()}"),o&&(r+=",[ELYSIA_REQUEST_ID]:id"),r+=t,r+=`}
`,r},websocket(e){let t="";const r=e.router.static.ws,n=e.router.http;if(n.build(),Object.keys(r).length||n.root.ws||n.history.find(i=>i[0]==="ws")){t+="if(r.method==='GET'){switch(p){";for(const[i,o]of Object.entries(r))t+=`case'${i}':`+(e.config.strictPath!==!0?`case'${sn(i)}':`:"")+`if(r.headers.get('upgrade')==='websocket')return ht[${o}].composed(c)
`;t+=`default:if(r.headers.get('upgrade')==='websocket'){const route=router.find('ws',p)
if(route){c.params=route.params
if(route.store.handler)return route.store.handler(c)
return (route.store.handler=route.store.compile())(c)}}break}}`}return t},error404(e,t){let r="if(route===null)return ";return t?r+=`app.handleError(c,notFound,false,${this.parameters})`:r+=e?"new Response(error404Message,{status:c.set.status===200?404:c.set.status,headers:c.set.headers})":"error404.clone()",{declare:t?"":`const error404Message=notFound.message.toString()
const error404=new Response(error404Message,{status:404})
`,code:r}}},composeError:{mapResponseContext:"",validationError:"return new Response(error.message,{headers:Object.assign({'content-type':'application/json'},set.headers),status:set.status})",unknownError:"return new Response(error.message,{headers:set.headers,status:error.status??set.status??500})"},listen(){return()=>{throw new Error("WebStandard does not support listen, you might want to export default Elysia.fetch instead")}}},Xb=(e,t,r={})=>{var i,o,s,c;if(typeof e=="function"||e instanceof Blob)return;if(typeof e=="object"&&(e==null?void 0:e.toString())==="[object HTMLBundle]")return()=>e;const n=pt(e,{headers:r});if(!((i=t.parse)!=null&&i.length)&&!((o=t.transform)!=null&&o.length)&&!((s=t.beforeHandle)!=null&&s.length)&&!((c=t.afterHandle)!=null&&c.length))return n.headers.has("content-type")||n.headers.append("content-type","text/plain;charset=utf-8"),n.clone.bind(n)},Yc={open(e){var t,r;(r=(t=e.data).open)==null||r.call(t,e)},message(e,t){var r,n;(n=(r=e.data).message)==null||n.call(r,e,t)},drain(e){var t,r;(r=(t=e.data).drain)==null||r.call(t,e)},close(e,t,r){var n,i;(i=(n=e.data).close)==null||i.call(n,e,t,r)}};class gi{constructor(t,r,n=void 0){var i;this.raw=t,this.data=r,this.body=n,this.validator=(i=t.data)==null?void 0:i.validator,this.sendText=t.sendText.bind(t),this.sendBinary=t.sendBinary.bind(t),this.close=t.close.bind(t),this.terminate=t.terminate.bind(t),this.publishText=t.publishText.bind(t),this.publishBinary=t.publishBinary.bind(t),this.subscribe=t.subscribe.bind(t),this.unsubscribe=t.unsubscribe.bind(t),this.isSubscribed=t.isSubscribed.bind(t),this.cork=t.cork.bind(t),this.remoteAddress=t.remoteAddress,this.binaryType=t.binaryType,this.data=t.data,this.send=this.send.bind(this),this.ping=this.ping.bind(this),this.pong=this.pong.bind(this),this.publish=this.publish.bind(this)}get id(){return this.data.id}send(t,r){var n;return Buffer.isBuffer(t)?this.raw.send(t,r):((n=this.validator)==null?void 0:n.Check(t))===!1?this.raw.send(new Y("message",this.validator,t).message):(typeof t=="object"&&(t=JSON.stringify(t)),this.raw.send(t,r))}ping(t){var r;return Buffer.isBuffer(t)?this.raw.ping(t):((r=this.validator)==null?void 0:r.Check(t))===!1?this.raw.send(new Y("message",this.validator,t).message):(typeof t=="object"&&(t=JSON.stringify(t)),this.raw.ping(t))}pong(t){var r;return Buffer.isBuffer(t)?this.raw.pong(t):((r=this.validator)==null?void 0:r.Check(t))===!1?this.raw.send(new Y("message",this.validator,t).message):(typeof t=="object"&&(t=JSON.stringify(t)),this.raw.pong(t))}publish(t,r,n){var i;return Buffer.isBuffer(r)?this.raw.publish(t,r,n):((i=this.validator)==null?void 0:i.Check(r))===!1?this.raw.send(new Y("message",this.validator,r).message):(typeof r=="object"&&(r=JSON.stringify(r)),this.raw.publish(t,r,n))}get readyState(){return this.raw.readyState}}const Vb=e=>{const t=typeof e=="function"?[e]:e;return async function(n,i){if(typeof i=="string"){const o=i==null?void 0:i.charCodeAt(0);if(o===34||o===47||o===91||o===123)try{i=JSON.parse(i)}catch{}else ys(i)?i=+i:i==="true"?i=!0:i==="false"?i=!1:i==="null"&&(i=null)}if(t)for(let o=0;o<t.length;o++){let s=t[o](n,i);if(s instanceof Promise&&(s=await s),s!==void 0)return s}return i}},vb=e=>{const t=(r,n)=>{if(n instanceof Promise)return n.then(s=>t(r,s));if(Buffer.isBuffer(n))return r.send(n.toString());if(n===void 0)return;const i=s=>{if((e==null?void 0:e.Check(s))===!1)return r.send(new Y("message",e,s).message);if(typeof s=="object")return r.send(JSON.stringify(s));r.send(s)};if(typeof(n==null?void 0:n.next)!="function")return void i(n);const o=n.next();if(o instanceof Promise)return(async()=>{const s=await o;if((e==null?void 0:e.Check(s))===!1)return r.send(new Y("message",e,s).message);if(i(s.value),!s.done)for await(const c of n)i(c)})();if(i(o.value),!o.done)for(const s of n)i(s)};return t},e0={...bi,name:"bun",handler:{...bi.handler,createNativeStaticHandler:Xb},composeHandler:{...bi.composeHandler,headers:Pi?`c.headers = c.request.headers.toJSON()
`:`c.headers = {}
for (const [key, value] of c.request.headers.entries())c.headers[key] = value
`},listen(e){return(t,r)=>{var o;if(typeof Bun>"u")throw new Error(".listen() is designed to run on Bun only. If you are running Elysia in other environment please use a dedicated plugin or export the handler via Elysia.fetch");if(e.compile(),typeof t=="string"){if(!ys(t))throw new Error("Port must be a numeric value");t=parseInt(t)}const n=e.fetch,i=typeof t=="object"?{development:!Ei,reusePort:!0,...e.config.serve||{},...t||{},static:{...e.router.static.http.static,...(o=e.config.serve)==null?void 0:o.static},websocket:{...e.config.websocket||{},...Yc||{}},fetch:n,error:e.outerErrorHandler}:{development:!Ei,reusePort:!0,...e.config.serve||{},static:e.router.static.http.static,websocket:{...e.config.websocket||{},...Yc||{}},port:t,fetch:n,error:e.outerErrorHandler};if(e.server=Bun==null?void 0:Bun.serve(i),e.event.start)for(let s=0;s<e.event.start.length;s++)e.event.start[s].fn(e);r&&r(e.server),process.on("beforeExit",()=>{var s,c;if(e.server&&((c=(s=e.server).stop)==null||c.call(s),e.server=null,e.event.stop))for(let u=0;u<e.event.stop.length;u++)e.event.stop[u].fn(e)}),e.promisedModules.then(()=>{Bun==null||Bun.gc(!1)})}},ws(e,t,r){const{parse:n,body:i,response:o,...s}=r,c=mt(i,{modules:e.definitions.typebox,models:e.definitions.type,normalize:e.config.normalize}),u=mt(o,{modules:e.definitions.typebox,models:e.definitions.type,normalize:e.config.normalize});e.route("$INTERNALWS",t,async f=>{const p=e.getServer(),{set:m,path:g,qi:l,headers:h,query:a,params:x}=f;if(f.validator=u,r.upgrade)if(typeof r.upgrade=="function"){const N=r.upgrade(f);N instanceof Promise&&await N}else r.upgrade&&Object.assign(m.headers,r.upgrade);if(m.cookie&&Mt(m.cookie)){const N=Cu(m.cookie);N&&(m.headers["set-cookie"]=N)}m.headers["set-cookie"]&&Array.isArray(m.headers["set-cookie"])&&(m.headers=Nu(new Headers(m.headers),m.headers["set-cookie"]));const P=vb(u),D=Vb(n);let B;const H=[...Array.isArray(r.error)?r.error:[r.error],...(e.event.error??[]).map(N=>typeof N=="function"?N:N.fn)],oe=H.length?async(N,z)=>{for(const E of H){let U=E(Object.assign(f,{error:z}));if(U instanceof Promise&&(U=await U),await P(N,U),U)break}}:()=>{};if(!(p!=null&&p.upgrade(f.request,{headers:Mt(m.headers)?m.headers:void 0,data:{...f,get id(){return B||(B=hu())},validator:u,ping(N){var z;(z=r.ping)==null||z.call(r,N)},pong(N){var z;(z=r.pong)==null||z.call(r,N)},open(N){var z;try{P(N,(z=r.open)==null?void 0:z.call(r,new gi(N,f)))}catch(E){oe(N,E)}},message:async(N,z)=>{var U;const E=await D(N,z);if((c==null?void 0:c.Check(E))===!1)return void N.send(new Y("message",c,E).message);try{P(N,(U=r.message)==null?void 0:U.call(r,new gi(N,f,E),E))}catch(ue){oe(N,ue)}},drain(N){var z;try{P(N,(z=r.drain)==null?void 0:z.call(r,new gi(N,f)))}catch(E){oe(N,E)}},close(N,z,E){var U;try{P(N,(U=r.close)==null?void 0:U.call(r,new gi(N,f),z,E))}catch(ue){oe(N,ue)}}}})))return m.status=400,"Expected a websocket connection"},{...s,websocket:r})}},t0=typeof Bun<"u";var Qc={};const Zc=t0?Bun.env:typeof process<"u"&&Qc?Qc:{},cn=/\+/g;function r0(e){const t={};if(typeof e!="string")return t;let r="",n="",i=-1,o=-1,s=0;const c=e.length;for(let u=0;u<c;u++)switch(e.charCodeAt(u)){case 38:const f=o>i;f||(o=u),r=e.slice(i+1,o),(f||r.length>0)&&(s&1&&(r=r.replace(cn," ")),s&2&&(r=$r(r)||r),t[r]||(f&&(n=e.slice(o+1,u),s&4&&(n=n.replace(cn," ")),s&8&&(n=$r(n)||n)),t[r]=n)),r="",n="",i=u,o=u,s=0;break;case 61:o<=i?o=u:s|=8;break;case 43:o>i?s|=4:s|=1;break;case 37:o>i?s|=8:s|=2;break}if(i<c){const u=o>i;r=e.slice(i+1,u?o:c),(u||r.length>0)&&(s&1&&(r=r.replace(cn," ")),s&2&&(r=$r(r)||r),t[r]||(u&&(n=e.slice(o+1,c),s&4&&(n=n.replace(cn," ")),s&8&&(n=$r(n)||n)),t[r]=n))}return t}const Oi=e=>{const t={};if(typeof e!="string")return t;const r=e.length;let n="",i="",o=-1,s=-1,c=!1,u=!1,f=!1,p=!1,m=!1,g=0;for(let l=0;l<r+1;l++)switch(l!==r?g=e.charCodeAt(l):g=38,g){case 38:{if(m=s>o,m||(s=l),n=e.slice(o+1,s),m||n.length>0){f&&(n=n.replace(cn," ")),c&&(n=$r(n)||n),m&&(i=e.slice(s+1,l),p&&(i=i.replace(cn," ")),u&&(i=$r(i)||i));const h=t[n];h===void 0?t[n]=i:h.pop?h.push(i):t[n]=[h,i]}i="",o=l,s=l,c=!1,u=!1,f=!1,p=!1;break}case 61:s<=o?s=l:u=!0;break;case 43:s>o?p=!0:f=!0;break;case 37:s>o?u=!0:c=!0;break}return t},gs=Symbol("ElysiaTrace"),ir=()=>{const{promise:e,resolve:t}=Promise.withResolvers(),{promise:r,resolve:n}=Promise.withResolvers(),{promise:i,resolve:o}=Promise.withResolvers(),s=[],c=[];return[u=>(u&&s.push(u),e),u=>{const f=[],p=[];let m=null;for(let l=0;l<(u.total??0);l++){const{promise:h,resolve:a}=Promise.withResolvers(),{promise:x,resolve:P}=Promise.withResolvers(),{promise:D,resolve:B}=Promise.withResolvers(),H=[],oe=[];f.push(N=>(N&&H.push(N),h)),p.push(N=>{const z={...N,end:x,error:D,index:l,onStop(E){return E&&oe.push(E),x}};a(z);for(let E=0;E<H.length;E++)H[E](z);return(E=null)=>{const U=performance.now();E&&(m=E);const ue={end:U,error:E,get elapsed(){return U-N.begin}};for(let we=0;we<oe.length;we++)oe[we](ue);P(U),B(E)}})}const g={...u,end:r,error:i,onEvent(l){for(let h=0;h<f.length;h++)f[h](l)},onStop(l){return l&&c.push(l),r}};t(g);for(let l=0;l<s.length;l++)s[l](g);return{resolveChild:p,resolve(l=null){const h=performance.now();!l&&m&&(l=m);const a={end:h,error:l,get elapsed(){return h-u.begin}};for(let x=0;x<c.length;x++)c[x](a);n(h),o(l)}}}]},n0=e=>t=>{const[r,n]=ir(),[i,o]=ir(),[s,c]=ir(),[u,f]=ir(),[p,m]=ir(),[g,l]=ir(),[h,a]=ir(),[x,P]=ir(),[D,B]=ir();return e({id:t[no],context:t,set:t.set,onRequest:r,onParse:i,onTransform:s,onBeforeHandle:u,onHandle:p,onAfterHandle:g,onMapResponse:x,onAfterResponse:D,onError:h}),{request:n,parse:o,transform:c,beforeHandle:f,handle:m,afterHandle:l,error:a,mapResponse:P,afterResponse:B}},Br={optional:Symbol.for("TypeBox.Optional"),kind:Symbol.for("TypeBox.Kind")},qt=e=>{if(!e)return!1;const t=e==null?void 0:e.schema;return(t==null?void 0:t[Br.kind])==="Import"?e.References().some(qt):!!t&&Br.optional in t},Ye=(e,t)=>t?e:"",i0=["json","text","urlencoded","arrayBuffer","formdata","application/json","text/plain","application/x-www-form-urlencoded","application/octet-stream","multipart/form-data"],Ct=e=>{if(!e)return!1;const t=(e==null?void 0:e.schema)??e;if(t[Br.kind]==="Import"&&e.References())return e.References().some(Ct);if(t.anyOf)return t.anyOf.some(Ct);if(t.someOf)return t.someOf.some(Ct);if(t.allOf)return t.allOf.some(Ct);if(t.not)return t.not.some(Ct);if(t.type==="object"){const r=t.properties;if("additionalProperties"in t)return t.additionalProperties;if("patternProperties"in t)return!1;for(const n of Object.keys(r)){const i=r[n];if(i.type==="object"){if(Ct(i))return!0}else if(i.anyOf){for(let o=0;o<i.anyOf.length;o++)if(Ct(i.anyOf[o]))return!0}return i.additionalProperties}return!1}return!1},hs=({context:e="c",trace:t=[],addFn:r})=>{if(!t.length)return()=>({resolveChild(){return()=>{}},resolve(){}});for(let n=0;n<t.length;n++)r(`let report${n}, reportChild${n}, reportErr${n}, reportErrChild${n};let trace${n} = ${e}[ELYSIA_TRACE]?.[${n}] ?? trace[${n}](${e});
`);return(n,{name:i,total:o=0}={})=>{i||(i="anonymous");const s=n==="error"?"reportErr":"report";for(let c=0;c<t.length;c++)r(`${s}${c} = trace${c}.${n}({id,event:'${n}',name:'${i}',begin:performance.now(),total:${o}})
`);return{resolve(){for(let c=0;c<t.length;c++)r(`${s}${c}.resolve()
`)},resolveChild(c){for(let u=0;u<t.length;u++)r(`${s}Child${u}=${s}${u}.resolveChild?.shift()?.({id,event:'${n}',name:'${c}',begin:performance.now()})
`);return u=>{for(let f=0;f<t.length;f++)r(u?`if(${u} instanceof Error){${s}Child${f}?.(${u}) }else{${s}Child${f}?.()}`:`${s}Child${f}?.()
`)}}}}},o0=({injectResponse:e="",normalize:t=!1,validator:r,encodeSchema:n=!1})=>({composeValidation:(i,o=`c.${i}`)=>`c.set.status=422;throw new ValidationError('${i}',validator.${i},${o})`,composeResponseValidation:(i="r")=>{let o=e+`
`;o+=`if(${i} instanceof ElysiaCustomStatusResponse){c.set.status=${i}.code
${i}=${i}.response}const isResponse=${i} instanceof Response
switch(c.set.status){`;for(const[s,c]of Object.entries(r.response))o+=`
case ${s}:if(!isResponse){`,t&&"Clean"in c&&!Ct(c)&&(o+=`${i}=validator.response['${s}'].Clean(${i})
`),n&&(c.hasTransform||typeof c.Decode=="function")&&(o+=`${i}=validator.response['${s}'].Encode(${i})
`),o+=`if(validator.response['${s}'].Check(${i})===false){c.set.status=422
throw new ValidationError('response',validator.response['${s}'],${i})}c.set.status = ${s}}
`,o+=`break
`;return o+"}"}}),hr=(e,t)=>{if(!t)return;const r=t.schema??t;if(r[Br.kind]==="Import")return t.References().some(n=>hr(e,n));if(r.type==="object"){const n=r.properties;if(!n)return!1;for(const i of Object.keys(n)){const o=n[i];if(e in o)return!0;if(o.type==="object"){if(hr(e,o))return!0}else if(o.anyOf){for(let s=0;s<o.anyOf.length;s++)if(hr(e,o.anyOf[s]))return!0}}return!1}return e in r},s0=Symbol.for("TypeBox.Transform"),Rt=e=>{if(!e)return!1;if(e.$ref&&e.$defs&&e.$ref in e.$defs&&Rt(e.$defs[e.$ref]))return!0;if(e.oneOf){for(let t=0;t<e.oneOf.length;t++)if(Rt(e.oneOf[t]))return!0}if(e.anyOf){for(let t=0;t<e.anyOf.length;t++)if(Rt(e.anyOf[t]))return!0}if(e.allOf){for(let t=0;t<e.allOf.length;t++)if(Rt(e.allOf[t]))return!0}if(e.not&&Rt(e.not))return!0;if(e.type==="object"&&e.properties){const t=e.properties;for(const r of Object.keys(t)){const n=t[r];if(Rt(n)||n.type==="array"&&n.items&&Rt(n.items))return!0}}return e.type==="array"&&e.items&&Rt(e.items)?!0:s0 in e},c0=/(?:return|=>) \S+\(/g,fn=e=>((e==null?void 0:e.fn)??e).constructor.name==="AsyncFunction",Te=e=>{const t=(e==null?void 0:e.fn)??e;if(t.constructor.name==="AsyncFunction")return!0;const r=t.toString();return r.includes("=> response.clone(")?!1:r.includes("await")||r.includes("async")?!0:r.includes("=>response.clone(")?!1:!!r.match(c0)},hi=e=>{const t=(e==null?void 0:e.fn)??e;return t.constructor.name==="AsyncGeneratorFunction"||t.constructor.name==="GeneratorFunction"},f0=({app:e,path:t,method:r,hooks:n,validator:i,handler:o,allowMeta:s=!1,inference:c,asManifest:u=!1})=>{var q,J,L,ae,Le,d,S,y,K,C,M,se,Ge,jt,at,wt,Nr,ii,oi,$s,bs,Os,xs,ws,Rs,Is,Fs,As,Ps,Ss,js,Es,Cs,Ns,Ts,Ms,Us,ks,Ls,Ds,Bs,_s,qs,Ks,Hs,zs,Js,Gs,Ws,Ys,Qs,Zs,Xs,Vs,vs,ec,tc,rc,si,nc,ci,ic,fi,oc,ui,sc,ai,cc,di,fc,li,uc,mi,ac,pi,dc;const f=e["~adapter"].composeHandler,p=e["~adapter"].handler,m=typeof o=="function";if(!m&&(o=p.mapResponse(o,{headers:e.setHeaders??{}}),(q=n.parse)!=null&&q.length&&((J=n.transform)!=null&&J.length)&&((L=n.beforeHandle)!=null&&L.length)&&((ae=n.afterHandle)!=null&&ae.length)))return o instanceof Response?Function("a","return function(){return a.clone()}")(o):Function("a","return function(){return a}")(o);const g=m?"handler(c)":"handler",l=!!((Le=n.afterResponse)!=null&&Le.length),h=!!((d=n.trace)!=null&&d.length);let a="";if(c=Pu(Object.assign({},n,{handler:o}),c),f.declare){const F=f.declare(c);F&&(a+=F)}c.server&&(a+=`Object.defineProperty(c,'server',{get:function(){return getServer()}})
`),(S=i.createBody)==null||S.call(i),(y=i.createQuery)==null||y.call(i),(K=i.createHeaders)==null||K.call(i),(C=i.createParams)==null||C.call(i),(M=i.createCookie)==null||M.call(i),(se=i.createResponse)==null||se.call(i);const x=i.body||i.headers||i.params||i.query||i.cookie||i.response,P=c.query||!!i.query,D=((Ge=n.parse)==null?void 0:Ge.length)===1&&n.parse[0].fn==="none",B=r!=="$INTERNALWS"&&r!=="GET"&&r!=="HEAD"&&(c.body||!!i.body||!!((jt=n.parse)!=null&&jt.length))&&!D;B&&(a+=`let isParsing=false
`);const H=e.setHeaders,oe=H&&!!Object.keys(H).length,N=c.headers||i.headers||f.preferWebstandardHeaders!==!0&&c.body,z=c.cookie||!!i.cookie,E=z?yu({modules:e.definitions.typebox,validator:i.cookie,defaultConfig:e.config.cookie,dynamic:!!e.config.aot,config:((at=i.cookie)==null?void 0:at.config)??{},models:e.definitions.type}):void 0,U=E==null?void 0:E.config;let ue="";if(U!=null&&U.sign){if(!U.secrets)throw new Error(`t.Cookie required secret which is not set in (${r}) ${t}.`);const F=U.secrets?typeof U.secrets=="string"?U.secrets:U.secrets[0]:void 0;if(ue+=`const _setCookie = c.set.cookie
if(_setCookie){`,U.sign===!0)ue+=`for(const [key, cookie] of Object.entries(_setCookie)){c.set.cookie[key].value=await signCookie(cookie.value,'${F}')}`;else for(const O of U.sign)ue+=`if(_setCookie['${O}']?.value){c.set.cookie['${O}'].value=await signCookie(_setCookie['${O}'].value,'${F}')}`;ue+=`}
`}const we=e.config.normalize,ze=(wt=e.config.experimental)==null?void 0:wt.encodeSchema,{composeValidation:le,composeResponseValidation:Z}=o0({normalize:we,validator:i,encodeSchema:ze});N&&(a+=f.headers),h&&(a+=`const id=c[ELYSIA_REQUEST_ID]
`);const _=hs({trace:n.trace,addFn:F=>{a+=F}});if(a+="try{",z){const F=(w,k)=>{const G=(U==null?void 0:U[w])??k;return G?typeof G=="string"?`${w}:'${G}',`:G instanceof Date?`${w}: new Date(${G.getTime()}),`:`${w}:${G},`:typeof k=="string"?`${w}:"${k}",`:`${w}:${k},`},O=U?`{secrets:${U.secrets!==void 0?typeof U.secrets=="string"?`'${U.secrets}'`:"["+U.secrets.reduce((w,k)=>w+`'${k}',`,"")+"]":"undefined"},sign:${U.sign===!0?!0:U.sign!==void 0?"["+U.sign.reduce((w,k)=>w+`'${k}',`,"")+"]":"undefined"},`+F("domain")+F("expires")+F("httpOnly")+F("maxAge")+F("path","/")+F("priority")+F("sameSite")+F("secure")+"}":"undefined";N?a+=`
c.cookie=await parseCookie(c.set,c.headers.cookie,${O})
`:a+=`
c.cookie=await parseCookie(c.set,c.request.headers.get('cookie'),${O})
`}if(P){const F=[];if(i.query&&i.query.schema.type==="object"){const O=i.query.schema.properties;if(!Ct(i.query))for(let[w,k]of Object.entries(O)){let G=k;const te=G.type==="array"||!!((Nr=G.anyOf)!=null&&Nr.some(et=>et.type==="string"&&et.format==="ArrayString"));G&&Br.optional in G&&G.type==="array"&&G.items&&(G=G.items);const{type:Re,anyOf:ot}=G;F.push({key:w,isArray:te,isNestedObjectArray:te&&((ii=G.items)==null?void 0:ii.type)==="object"||!!(($s=(oi=G.items)==null?void 0:oi.anyOf)!=null&&$s.some(et=>et.type==="object"||et.type==="array")),isObject:Re==="object"||(ot==null?void 0:ot.some(et=>et.type==="string"&&et.format==="ArrayString")),anyOf:!!ot})}}if(!F.length)a+="if(c.qi===-1){c.query={}}else{c.query=parseQueryFromURL(c.url.slice(c.qi + 1))}";else{a+=`if(c.qi!==-1){let url='&'+c.url.slice(c.qi + 1)
`;let O=0;for(const{key:w,isArray:k,isObject:G,isNestedObjectArray:te,anyOf:Re}of F){const ot=(O===0?"let ":"")+`memory=url.indexOf('&${w}=')
let a${O}
`;k?(a+=ot,te?a+=`while(memory!==-1){const start=memory+${w.length+2}
memory=url.indexOf('&',start)
if(a${O}===undefined)
a${O}=''
else
a${O}+=','
let temp
if(memory===-1)temp=decodeURIComponent(url.slice(start).replace(/\\+/g,' '))
else temp=decodeURIComponent(url.slice(start, memory).replace(/\\+/g,' '))
const charCode=temp.charCodeAt(0)
if(charCode!==91&&charCode !== 123)
temp='"'+temp+'"'
a${O}+=temp
if(memory===-1)break
memory=url.indexOf('&${w}=',memory)
if(memory===-1)break}try{if(a${O}.charCodeAt(0)===91)a${O} = JSON.parse(a${O})
else
a${O}=JSON.parse('['+a${O}+']')}catch{}
`:a+=`while(memory!==-1){const start=memory+${w.length+2}
memory=url.indexOf('&',start)
if(a${O}===undefined)a${O}=[]
if(memory===-1){const temp=decodeURIComponent(url.slice(start)).replace(/\\+/g,' ')
if(temp.includes(',')){a${O}=a${O}.concat(temp.split(','))}else{a${O}.push(decodeURIComponent(url.slice(start)).replace(/\\+/g,' '))}
break}else{const temp=decodeURIComponent(url.slice(start, memory)).replace(/\\+/g,' ')
if(temp.includes(',')){a${O}=a${O}.concat(temp.split(','))}else{a${O}.push(temp)}
}memory=url.indexOf('&${w}=',memory)
if(memory===-1) break
}`):G?a+=ot+`if(memory!==-1){const start=memory+${w.length+2}
memory=url.indexOf('&',start)
if(memory===-1)a${O}=decodeURIComponent(url.slice(start).replace(/\\+/g,' '))else a${O}=decodeURIComponent(url.slice(start,memory).replace(/\\+/g,' '))if(a${O}!==undefined)try{a${O}=JSON.parse(a${O})}catch{}}`:(a+=ot+`if(memory!==-1){const start=memory+${w.length+2}
memory=url.indexOf('&',start)
if(memory===-1)a${O}=decodeURIComponent(url.slice(start).replace(/\\+/g,' '))
else{a${O}=decodeURIComponent(url.slice(start,memory).replace(/\\+/g,' '))`,Re&&(a+=`
let deepMemory=url.indexOf('&${w}=',memory)
if(deepMemory!==-1){a${O}=[a${O}]
let first=true
while(true){const start=deepMemory+${w.length+2}
if(first)first=false
else deepMemory = url.indexOf('&', start)
let value
if(deepMemory===-1)value=url.slice(start).replace(/\\+/g,' ')
else value=url.slice(start, deepMemory).replace(/\\+/g,' ')
value=decodeURIComponent(value)
if(value===null){if(deepMemory===-1){break}else{continue}}
const vStart=value.charCodeAt(0)
const vEnd=value.charCodeAt(value.length - 1)
if((vStart===91&&vEnd===93)||(vStart===123&&vEnd===125))
try{a${O}.push(JSON.parse(value))}catch{a${O}.push(value)}if(deepMemory===-1)break}}`),a+="}}"),O++,a+=`
`}a+="c.query={"+F.map(({key:w},k)=>`'${w}':a${k}`).join(",")+"}",a+=`} else c.query = {}
`}}const T=typeof o=="function"&&Te(o),ve=h||(bs=n.afterResponse)!=null&&bs.length?"c.response= ":"",rr=z||B||T||!!((Os=n.parse)!=null&&Os.length)||!!((xs=n.afterHandle)!=null&&xs.some(Te))||!!((ws=n.beforeHandle)!=null&&ws.some(Te))||!!((Rs=n.transform)!=null&&Rs.some(Te))||!!((Is=n.mapResponse)!=null&&Is.some(Te)),me=(typeof o=="function"?hi(o):!1)||!!((Fs=n.beforeHandle)!=null&&Fs.some(hi))||!!((As=n.afterHandle)!=null&&As.some(hi))||!!((Ps=n.transform)!=null&&Ps.some(hi)),ie=c.cookie||c.set||N||h||i.response||m&&oe||me,ne=f.mapResponseContext?`,${f.mapResponseContext}`:"";(h||c.route)&&(a+=`c.route=\`${t}\`
`);const Je=_("parse",{total:(Ss=n.parse)==null?void 0:Ss.length});if(B){const F=qt(i.body),O=!!((js=n.parse)!=null&&js.length)||c.body||i.body;f.parser.declare&&(a+=f.parser.declare),a+=`
isParsing=true
`;const w=typeof n.parse=="string"?n.parse:Array.isArray(n.parse)&&n.parse.length===1?typeof n.parse[0]=="string"?n.parse[0]:typeof n.parse[0].fn=="string"?n.parse[0].fn:void 0:void 0;if(w&&i0.includes(w)){const k=_("parse",{total:(Es=n.parse)==null?void 0:Es.length});switch(w){case"json":case"application/json":a+=f.parser.json(F);break;case"text":case"text/plain":a+=f.parser.text(F);break;case"urlencoded":case"application/x-www-form-urlencoded":a+=f.parser.urlencoded(F);break;case"arrayBuffer":case"application/octet-stream":a+=f.parser.arrayBuffer(F);break;case"formdata":case"multipart/form-data":a+=f.parser.formData(F);break;default:w[0]in e["~parser"]&&(a+=N?"let contentType = c.headers['content-type']":"let contentType = c.request.headers.get('content-type')",a+=`
if(contentType){const index=contentType.indexOf(';')
if(index!==-1)contentType=contentType.substring(0, index)}
else{contentType=''}c.contentType=contentType
`,a+=`let result=parser['${w}'](c, contentType)
if(result instanceof Promise)result=await result
if(result instanceof ElysiaCustomStatusResponse)throw result
if(result!==undefined)c.body=result
delete c.contentType
`);break}k.resolve()}else if(O){a+=`
`,a+=N?"let contentType = c.headers['content-type']":"let contentType = c.request.headers.get('content-type')",a+=`
if(contentType){const index=contentType.indexOf(';')
if(index!==-1)contentType=contentType.substring(0, index)}
else{contentType=''}c.contentType=contentType
`,(Cs=n.parse)!=null&&Cs.length&&(a+=`let used=false
`);const k=_("parse",{total:(Ns=n.parse)==null?void 0:Ns.length});let G=!1;if(n.parse)for(let te=0;te<n.parse.length;te++){const Re=`bo${te}`;if(te!==0&&(a+=`
if(!used){`),typeof n.parse[te].fn=="string"){const ot=k.resolveChild(n.parse[te].fn);switch(n.parse[te].fn){case"json":case"application/json":G=!0,a+=f.parser.json(F);break;case"text":case"text/plain":G=!0,a+=f.parser.text(F);break;case"urlencoded":case"application/x-www-form-urlencoded":G=!0,a+=f.parser.urlencoded(F);break;case"arrayBuffer":case"application/octet-stream":G=!0,a+=f.parser.arrayBuffer(F);break;case"formdata":case"multipart/form-data":G=!0,a+=f.parser.formData(F);break;default:a+=`${Re}=parser['${n.parse[te].fn}'](c,contentType)
if(${Re} instanceof Promise)${Re}=await ${Re}
if(${Re}!==undefined){c.body=${Re};used=true}
`}ot()}else{const ot=k.resolveChild(n.parse[te].fn.name);a+=`let ${Re}=e.parse[${te}]
${Re}=${Re}(c,contentType)
if(${Re} instanceof Promise)${Re}=await ${Re}
if(${Re}!==undefined){c.body=${Re};used=true}`,ot()}if(te!==0&&(a+="}"),G)break}if(k.resolve(),!G){(Ts=n.parse)!=null&&Ts.length&&(a+=`
if(!used){
if(!contentType) throw new ParseError()
`),a+="switch(contentType){",a+=`case 'application/json':
`+f.parser.json(F)+`break
case 'text/plain':`+f.parser.text(F)+`break
case 'application/x-www-form-urlencoded':`+f.parser.urlencoded(F)+`break
case 'application/octet-stream':`+f.parser.arrayBuffer(F)+`break
case 'multipart/form-data':`+f.parser.formData(F)+`break
`;for(const te of Object.keys(e["~parser"]))a+=`case '${te}':let bo${te}=parser['${te}'](c,contentType)
if(bo${te} instanceof Promise)bo${te}=await bo${te}
if(bo${te} instanceof ElysiaCustomStatusResponse)throw result
if(bo${te}!==undefined)c.body=bo${te}
break
`;(Ms=n.parse)!=null&&Ms.length&&(a+="}"),a+="}"}}a+=`
delete c.contentType`,a+=`
isParsing=false
`}if(Je.resolve(),n!=null&&n.transform){const F=_("transform",{total:n.transform.length});n.transform.length&&(a+=`let transformed
`);for(let O=0;O<n.transform.length;O++){const w=n.transform[O],k=F.resolveChild(w.fn.name);a+=Te(w)?`transformed=await e.transform[${O}](c)
`:`transformed=e.transform[${O}](c)
`,w.subType==="mapDerive"?a+=`if(transformed instanceof ElysiaCustomStatusResponse)throw transformed
else{transformed.request=c.request
transformed.store=c.store
transformed.qi=c.qi
transformed.path=c.path
transformed.url=c.url
transformed.redirect=c.redirect
transformed.set=c.set
transformed.error=c.error
c=transformed}`:a+=`if(transformed instanceof ElysiaCustomStatusResponse)throw transformed
else Object.assign(c,transformed)
`,k()}F.resolve()}if(i){if(i.headers){if(we&&"Clean"in i.headers&&!Ct(i.headers)&&(a+=`c.headers=validator.headers.Clean(c.headers);
`),hr("default",i.headers))for(const[F,O]of Object.entries(jn(i.headers.schema,{}))){const w=typeof O=="object"?JSON.stringify(O):typeof O=="string"?`'${O}'`:O;w!==void 0&&(a+=`c.headers['${F}']??=${w}
`)}qt(i.headers)&&(a+="if(isNotEmpty(c.headers)){"),a+="if(validator.headers.Check(c.headers) === false){"+le("headers")+"}",Rt(i.headers.schema)&&(a+=`c.headers=validator.headers.Decode(c.headers)
`),qt(i.headers)&&(a+="}")}if(i.params){if(hr("default",i.params))for(const[F,O]of Object.entries(jn(i.params.schema,{}))){const w=typeof O=="object"?JSON.stringify(O):typeof O=="string"?`'${O}'`:O;w!==void 0&&(a+=`c.params['${F}']??=${w}
`)}a+="if(validator.params.Check(c.params)===false){"+le("params")+"}",Rt(i.params.schema)&&(a+=`c.params=validator.params.Decode(c.params)
`)}if(i.query){if(we&&"Clean"in i.query&&!Ct(i.query)&&(a+=`c.query=validator.query.Clean(c.query)
`),hr("default",i.query))for(const[F,O]of Object.entries(jn(i.query.schema,{}))){const w=typeof O=="object"?JSON.stringify(O):typeof O=="string"?`'${O}'`:O;w!==void 0&&(a+=`if(c.query['${F}']===undefined)c.query['${F}']=${w}
`)}qt(i.query)&&(a+="if(isNotEmpty(c.query)){"),a+="if(validator.query.Check(c.query)===false){"+le("query")+"}",Rt(i.query.schema)&&(a+=`c.query=validator.query.Decode(Object.assign({},c.query))
`),qt(i.query)&&(a+="}")}if(i.body){we&&"Clean"in i.body&&!Ct(i.body)&&(a+=`c.body=validator.body.Clean(c.body)
`);const F=Rt(i.body.schema);if((F||qt(i.body))&&(a+=`const isNotEmptyObject=c.body&&(typeof c.body==="object"&&isNotEmpty(c.body))
`),hr("default",i.body)){const O=i.body.schema,w=jn(O,O.type==="object"||O[Br.kind]==="Import"&&O.$defs[O.$ref][Br.kind]==="Object"?{}:void 0),k=typeof w=="object"?JSON.stringify(w):typeof w=="string"?`'${w}'`:w;a+="if(validator.body.Check(c.body)===false){",w!=null&&(a+=`if(typeof c.body==='object')c.body=Object.assign(${k},c.body)
else c.body=${k}
`),qt(i.body)?a+="if(isNotEmptyObject&&validator.body.Check(c.body)===false){"+le("body")+"}":a+="if(validator.body.Check(c.body)===false){"+le("body")+"}",a+="}"}else qt(i.body)?a+="if(isNotEmptyObject&&validator.body.Check(c.body)===false){"+le("body")+"}":a+="if(validator.body.Check(c.body)===false){"+le("body")+"}";F&&(a+=`if(isNotEmptyObject)c.body=validator.body.Decode(c.body)
`)}if(E&&Mt(((Us=E==null?void 0:E.schema)==null?void 0:Us.properties)??((ks=E==null?void 0:E.schema)==null?void 0:ks.schema)??{})){if(a+=`const cookieValue={}
for(const [key,value] of Object.entries(c.cookie))cookieValue[key]=value.value
`,hr("default",E))for(const[F,O]of Object.entries(jn(E.schema,{})))a+=`cookieValue['${F}'] = ${typeof O=="object"?JSON.stringify(O):O}
`;qt(i.cookie)&&(a+="if(isNotEmpty(c.cookie)){"),a+="if(validator.cookie.Check(cookieValue)===false){"+le("cookie","cookieValue")+"}",Rt(i.cookie.schema)&&(a+=`for(const [key,value] of Object.entries(validator.cookie.Decode(cookieValue)))c.cookie[key].value=value
`),qt(i.cookie)&&(a+="}")}}if(n!=null&&n.beforeHandle){const F=_("beforeHandle",{total:n.beforeHandle.length});let O=!1;for(let w=0;w<n.beforeHandle.length;w++){const k=n.beforeHandle[w],G=F.resolveChild(k.fn.name),te=kn(k);if(k.subType==="resolve"||k.subType==="mapResolve")O||(O=!0,a+=`
let resolved
`),a+=Te(k)?`resolved=await e.beforeHandle[${w}](c);
`:`resolved=e.beforeHandle[${w}](c);
`,k.subType==="mapResolve"?a+=`if(resolved instanceof ElysiaCustomStatusResponse)throw resolved
else{resolved.request = c.request
resolved.store = c.store
resolved.qi = c.qi
resolved.path = c.path
resolved.url = c.url
resolved.redirect = c.redirect
resolved.set = c.set
resolved.error = c.error
c = resolved}`:a+=`if(resolved instanceof ElysiaCustomStatusResponse)throw resolved
else Object.assign(c, resolved)
`;else if(!te)a+=Te(k)?`await e.beforeHandle[${w}](c)
`:`e.beforeHandle[${w}](c)
`,G();else{if(a+=Te(k)?`be=await e.beforeHandle[${w}](c)
`:`be=e.beforeHandle[${w}](c)
`,G("be"),a+="if(be!==undefined){",F.resolve(),(Ls=n.afterHandle)!=null&&Ls.length){_("handle",{name:m?o.name:void 0}).resolve();const et=_("afterHandle",{total:n.afterHandle.length});for(let vt=0;vt<n.afterHandle.length;vt++){const en=n.afterHandle[vt],Uu=kn(en),ku=et.resolveChild(en.fn.name);a+=`c.response = be
`,Uu?(a+=Te(en.fn)?`af = await e.afterHandle[${vt}](c)
`:`af = e.afterHandle[${vt}](c)
`,a+=`if(af!==undefined) c.response=be=af
`):a+=Te(en.fn)?`await e.afterHandle[${vt}](c, be)
`:`e.afterHandle[${vt}](c, be)
`,ku("af")}et.resolve()}i.response&&(a+=Z("be"));const ot=_("mapResponse",{total:(Ds=n.mapResponse)==null?void 0:Ds.length});if((Bs=n.mapResponse)!=null&&Bs.length){a+=`c.response=be
`;for(let et=0;et<n.mapResponse.length;et++){const vt=n.mapResponse[et],en=ot.resolveChild(vt.fn.name);a+=`if(mr===undefined){mr=${fn(vt)?"await ":""}e.mapResponse[${et}](c)
if(mr!==undefined)be=c.response=mr}`,en()}}ot.resolve(),a+=ue,a+=`return mapEarlyResponse(${ve}be,c.set${ne})}
`}}F.resolve()}if((_s=n.afterHandle)!=null&&_s.length){const F=_("handle",{name:m?o.name:void 0});n.afterHandle.length?a+=T?`let r=c.response=await ${g}
`:`let r=c.response=${g}
`:a+=T?`let r=await ${g}
`:`let r=${g}
`,F.resolve();const O=_("afterHandle",{total:n.afterHandle.length});for(let k=0;k<n.afterHandle.length;k++){const G=n.afterHandle[k],te=kn(G),Re=O.resolveChild(G.fn.name);te?(a+=Te(G.fn)?`af=await e.afterHandle[${k}](c)
`:`af=e.afterHandle[${k}](c)
`,Re("af"),i.response?(a+="if(af!==undefined){",O.resolve(),a+=Z("af"),a+="c.response=af}"):(a+="if(af!==undefined){",O.resolve(),a+="c.response=af}")):(a+=Te(G.fn)?`await e.afterHandle[${k}](c)
`:`e.afterHandle[${k}](c)
`,Re())}O.resolve(),a+=`r=c.response
`,i.response&&(a+=Z()),a+=ue;const w=_("mapResponse",{total:(qs=n.mapResponse)==null?void 0:qs.length});if((Ks=n.mapResponse)!=null&&Ks.length)for(let k=0;k<n.mapResponse.length;k++){const G=n.mapResponse[k],te=w.resolveChild(G.fn.name);a+=`mr=${fn(G)?"await ":""}e.mapResponse[${k}](c)
if(mr!==undefined)r=c.response=mr
`,te()}w.resolve(),ie?a+=`return mapResponse(${ve}r,c.set${ne})
`:a+=`return mapCompactResponse(${ve}r${ne})
`}else{const F=_("handle",{name:m?o.name:void 0});if(i.response||(Hs=n.mapResponse)!=null&&Hs.length){a+=T?`let r=await ${g}
`:`let r=${g}
`,F.resolve(),i.response&&(a+=Z()),_("afterHandle").resolve();const O=_("mapResponse",{total:(zs=n.mapResponse)==null?void 0:zs.length});if((Js=n.mapResponse)!=null&&Js.length){a+=`
c.response=r
`;for(let w=0;w<n.mapResponse.length;w++){const k=n.mapResponse[w],G=O.resolveChild(k.fn.name);a+=`
if(mr===undefined){mr=${fn(k)?"await ":""}e.mapResponse[${w}](c)
if(mr!==undefined)r=c.response=mr}
`,G()}}O.resolve(),a+=ue,o instanceof Response?(a+=c.set?`if(isNotEmpty(c.set.headers)||c.set.status!==200||c.set.redirect||c.set.cookie)return mapResponse(${ve}${g}.clone(),c.set${ne})else return ${g}.clone()`:`return ${g}.clone()`,a+=`
`):ie?a+=`return mapResponse(${ve}r,c.set${ne})
`:a+=`return mapCompactResponse(${ve}r${ne})
`}else if(z||h){a+=T?`let r=await ${g}
`:`let r=${g}
`,F.resolve(),_("afterHandle").resolve();const O=_("mapResponse",{total:(Gs=n.mapResponse)==null?void 0:Gs.length});if((Ws=n.mapResponse)!=null&&Ws.length){a+=`c.response= r
`;for(let w=0;w<n.mapResponse.length;w++){const k=n.mapResponse[w],G=O.resolveChild(k.fn.name);a+=`if(mr===undefined){mr=${fn(k)?"await ":""}e.mapResponse[${w}](c)
if(mr!==undefined)r=c.response=mr}`,G()}}O.resolve(),a+=ue,ie?a+=`return mapResponse(${ve}r,c.set${ne})
`:a+=`return mapCompactResponse(${ve}r${ne})
`}else{F.resolve();const O=T?`await ${g}`:g;_("afterHandle").resolve(),o instanceof Response?a+=c.set?`if(isNotEmpty(c.set.headers)||c.set.status!==200||c.set.redirect||c.set.cookie)return mapResponse(${ve}${g}.clone(),c.set${ne})
else return ${g}.clone()
`:`return ${g}.clone()
`:ie?a+=`return mapResponse(${ve}${O},c.set${ne})
`:a+=`return mapCompactResponse(${ve}${O}${ne})
`}}if(a+=`
}catch(error){`,B&&(a+=`if(isParsing)error=new ParseError()
`),rr||(a+="return(async()=>{"),a+=`const set=c.set
if(!set.status||set.status<300)set.status=error?.status||500
`,h&&n.trace)for(let F=0;F<n.trace.length;F++)a+=`report${F}?.resolve(error);reportChild${F}?.(error)
`;const ft=_("error",{total:(Ys=n.error)==null?void 0:Ys.length});if((Qs=n.error)!=null&&Qs.length){a+=`c.error=error
`,x?a+=`if(error instanceof TypeBoxError){c.code="VALIDATION"
c.set.status=422}else{c.code=error.code??error[ERROR_CODE]??"UNKNOWN"}`:a+=`c.code=error.code??error[ERROR_CODE]??"UNKNOWN"
`,a+=`let er
`;for(let F=0;F<n.error.length;F++){const O=ft.resolveChild(n.error[F].fn.name);Te(n.error[F])?a+=`er=await e.error[${F}](c)
`:a+=`er=e.error[${F}](c)
if(er instanceof Promise)er=await er
`,O();const w=_("mapResponse",{total:(Zs=n.mapResponse)==null?void 0:Zs.length});if((Xs=n.mapResponse)!=null&&Xs.length)for(let k=0;k<n.mapResponse.length;k++){const G=n.mapResponse[k],te=w.resolveChild(G.fn.name);a+=`c.response=er
er=e.mapResponse[${k}](c)
if(er instanceof Promise)er=await er
`,te()}if(w.resolve(),a+=`er=mapEarlyResponse(er,set${ne})
`,a+="if(er){",h&&n.trace){for(let k=0;k<n.trace.length;k++)a+=`report${k}.resolve()
`;ft.resolve()}a+="return er}"}}if(ft.resolve(),a+="return handleError(c,error,true)",rr||(a+="})()"),a+="}",l||h){a+="finally{ ",rr||(a+=";(async()=>{");const F=_("afterResponse",{total:(Vs=n.afterResponse)==null?void 0:Vs.length});if(l&&n.afterResponse)for(let O=0;O<n.afterResponse.length;O++){const w=F.resolveChild(n.afterResponse[O].fn.name);a+=`
await e.afterResponse[${O}](c)
`,w()}F.resolve(),rr||(a+="})()"),a+="}"}const ut=f.inject?Object.keys(f.inject).join(",")+",":"";let ye="const {handler,handleError,hooks:e, "+Ye("validator,",x)+"mapResponse,mapCompactResponse,mapEarlyResponse,isNotEmpty,utils:{"+Ye("parseQuery,",B)+Ye("parseQueryFromURL,",P)+"},error:{"+Ye("ValidationError,",x)+"InternalServerError,"+Ye("ParseError",B)+"},schema,definitions,ERROR_CODE,"+Ye("parseCookie,",z)+Ye("signCookie,",z)+Ye("decodeURIComponent,",P)+"ElysiaCustomStatusResponse,"+Ye("ELYSIA_TRACE,",h)+Ye("ELYSIA_REQUEST_ID,",h)+Ye("parser,",(vs=n.parse)==null?void 0:vs.length)+Ye("getServer,",c.server)+ut+Ye("TypeBoxError",x)+`}=hooks
const trace=e.trace?.map(x=>typeof x==='function'?x:x.fn)??[]
return ${rr?"async ":""}function handle(c){`;(ec=n.beforeHandle)!=null&&ec.length&&(ye+=`let be
`),(tc=n.afterHandle)!=null&&tc.length&&(ye+=`let af
`),(rc=n.mapResponse)!=null&&rc.length&&(ye+=`let mr
`),s&&(ye+=`c.schema = schema
c.defs = definitions
`),ye+=a+"}";try{return u?Function("hooks",ye):Function("hooks",ye)({handler:o,hooks:Bc(n),validator:x?i:void 0,handleError:e.handleError,mapResponse:p.mapResponse,mapCompactResponse:p.mapCompactResponse,mapEarlyResponse:p.mapEarlyResponse,isNotEmpty:Mt,utils:{parseQuery:B?Oi:void 0,parseQueryFromURL:P?r0:void 0},error:{ValidationError:x?Y:void 0,InternalServerError:Mb,ParseError:B?Ub:void 0},schema:e.router.history,definitions:e.definitions.type,ERROR_CODE:ji,parseCookie:z?Eu:void 0,signCookie:z?Si:void 0,decodeURIComponent:P?$r:void 0,ElysiaCustomStatusResponse:tr,ELYSIA_TRACE:h?gs:void 0,ELYSIA_REQUEST_ID:h?no:void 0,getServer:()=>e.getServer(),TypeBoxError:x?ke:void 0,parser:e["~parser"],...f.inject})}catch(F){const O=Bc(n);console.log("[Composer] failed to generate optimized handler"),console.log("---"),console.log({handler:typeof o=="function"?o.toString():o,instruction:ye,hooks:{...O,transform:(nc=(si=O==null?void 0:O.transform)==null?void 0:si.map)==null?void 0:nc.call(si,w=>w.toString()),resolve:(ic=(ci=O==null?void 0:O.resolve)==null?void 0:ci.map)==null?void 0:ic.call(ci,w=>w.toString()),beforeHandle:(oc=(fi=O==null?void 0:O.beforeHandle)==null?void 0:fi.map)==null?void 0:oc.call(fi,w=>w.toString()),afterHandle:(sc=(ui=O==null?void 0:O.afterHandle)==null?void 0:ui.map)==null?void 0:sc.call(ui,w=>w.toString()),mapResponse:(cc=(ai=O==null?void 0:O.mapResponse)==null?void 0:ai.map)==null?void 0:cc.call(ai,w=>w.toString()),parse:(fc=(di=O==null?void 0:O.parse)==null?void 0:di.map)==null?void 0:fc.call(di,w=>w.toString()),error:(uc=(li=O==null?void 0:O.error)==null?void 0:li.map)==null?void 0:uc.call(li,w=>w.toString()),afterResponse:(ac=(mi=O==null?void 0:O.afterResponse)==null?void 0:mi.map)==null?void 0:ac.call(mi,w=>w.toString()),stop:(dc=(pi=O==null?void 0:O.stop)==null?void 0:pi.map)==null?void 0:dc.call(pi,w=>w.toString())},validator:i,definitions:e.definitions.type,error:F,fnLiteral:a}),console.log("---"),process.exit(1)}},ao=(e,{asManifest:t=!1}={})=>{var h,a,x,P,D,B,H,oe,N,z;const r=e["~adapter"].composeGeneralHandler;e.router.http.build();const n=r.error404(!!((h=e.event.request)!=null&&h.length),!!((a=e.event.error)!=null&&a.length)),i=(x=e.event.trace)==null?void 0:x.length;let o="";const s=e.router;let c="const route=router.find(r.method,p)";c+=s.http.root.ALL?`??router.find("ALL",p)
`:`
`,c+=n.code,c+=`
c.params=route.params
if(route.store.handler)return route.store.handler(c)
return (route.store.handler=route.store.compile())(c)
`;let u="";for(const[E,U]of Object.entries(s.static.http.map)){u+=`case'${E}':`,e.config.strictPath!==!0&&(u+=`case'${sn(E)}':`);const ue=Tn(E);E!==ue&&(u+=`case'${ue}':`),u+=`switch(r.method){${U.code}
`+(U.all??"default: break map")+"}"}const f=!!((P=e.event.request)!=null&&P.some(Te)),p=r.inject?Object.keys(r.inject).join(",")+",":"";o+=`
const {app,mapEarlyResponse,NotFoundError,randomId,handleError,error,redirect,`+Ye("ELYSIA_TRACE,",i)+Ye("ELYSIA_REQUEST_ID,",i)+p+`}=data
const store=app.singleton.store
const decorator=app.singleton.decorator
const staticRouter=app.router.static.http
const ht=app.router.history
const router=app.router.http
const trace=app.event.trace?.map(x=>typeof x==='function'?x:x.fn)??[]
const notFound=new NotFoundError()
const hoc=app.extender.higherOrderFunctions.map(x=>x.fn)
`,(D=e.event.request)!=null&&D.length&&(o+=`const onRequest=app.event.request.map(x=>x.fn)
`),o+=n.declare,(B=e.event.trace)!=null&&B.length&&(o+="const "+e.event.trace.map((E,U)=>`tr${U}=app.event.trace[${U}].fn`).join(",")+`
`),o+=`${f?"async ":""}function map(${r.parameters}){`,(H=e.event.request)!=null&&H.length&&(o+=`let re
`),o+=r.createContext(e),(oe=e.event.trace)!=null&&oe.length&&(o+="c[ELYSIA_TRACE]=["+e.event.trace.map((E,U)=>`tr${U}(c)`).join(",")+`]
`);const g=hs({trace:e.event.trace,addFn(E){o+=E}})("request",{total:(N=e.event.request)==null?void 0:N.length});if((z=e.event.request)!=null&&z.length){o+="try{";for(let E=0;E<e.event.request.length;E++){const U=e.event.request[E],ue=kn(U),we=Te(U),ze=g.resolveChild(e.event.request[E].fn.name);ue?(o+=`re=mapEarlyResponse(${we?"await ":""}onRequest[${E}](c),c.set)
`,ze("re"),o+=`if(re!==undefined)return re
`):(o+=`${we?"await ":""}onRequest[${E}](c)
`,ze())}o+="}catch(error){return app.handleError(c,error,false)}"}if(g.resolve(),o+=r.websocket(e),o+=`
map:switch(p){
`+u+"default:break}"+c+`}
`,e.extender.higherOrderFunctions.length){let E="map";for(let U=0;U<e.extender.higherOrderFunctions.length;U++)E=`hoc[${U}](${E},${r.parameters})`;o+=`return function hocMap(${r.parameters}){return ${E}(${r.parameters})}`}else o+="return map";const l=Mu(e);return e.handleError=l,Function("data",o)({app:e,mapEarlyResponse:e["~adapter"].handler.mapEarlyResponse,NotFoundError:bu,randomId:hu,handleError:l,error:$u,redirect:gu,ELYSIA_TRACE:i?gs:void 0,ELYSIA_REQUEST_ID:i?no:void 0,...r.inject})},Mu=e=>{var f,p,m,g,l,h,a,x,P;const t=e.event;let r="";const n=e["~adapter"].composeError,i=n.inject?Object.keys(n.inject).join(",")+",":"",o=!!((f=e.event.trace)!=null&&f.length);r+="const {app:{event:{error:onErrorContainer,afterResponse:resContainer,mapResponse:_onMapResponse,trace:_trace}},mapResponse,ERROR_CODE,ElysiaCustomStatusResponse,"+Ye("ELYSIA_TRACE,",o)+Ye("ELYSIA_REQUEST_ID,",o)+i+`}=inject
`,r+=`const trace=_trace?.map(x=>typeof x==='function'?x:x.fn)??[]
const onMapResponse=[]
if(_onMapResponse)for(let i=0;i<_onMapResponse.length;i++)onMapResponse.push(_onMapResponse[i].fn??_onMapResponse[i])
delete _onMapResponse
const onError=onErrorContainer?.map(x=>x.fn)??[]
const res=resContainer?.map(x=>x.fn)??[]
return ${(p=e.event.error)!=null&&p.find(Te)||(m=e.event.mapResponse)!=null&&m.find(Te)?"async ":""}function(context,error,skipGlobal){`,r+="",o&&(r+=`const id=context[ELYSIA_REQUEST_ID]
`);const s=hs({context:"context",trace:t.trace,addFn:D=>{r+=D}});r+=`const set=context.set
let _r
if(!context.code)context.code=error.code??error[ERROR_CODE]
if(!(context.error instanceof Error))context.error=error
if(error instanceof ElysiaCustomStatusResponse){set.status=error.status=error.code
error.message=error.response}`,n.declare&&(r+=n.declare);const c=o||(g=t.afterResponse)!=null&&g.length||(l=t.afterResponse)!=null&&l.length?"context.response = ":"";if(e.event.error)for(let D=0;D<e.event.error.length;D++){const B=e.event.error[D],H=`${Te(B)?"await ":""}onError[${D}](context)
`;if(r+="if(skipGlobal!==true){",kn(B)){r+=`_r=${H}
if(_r!==undefined){if(_r instanceof Response)return mapResponse(_r,set${n.mapResponseContext})
if(_r instanceof ElysiaCustomStatusResponse){error.status=error.code
error.message = error.response}if(set.status===200||!set.status)set.status=error.status
`;const oe=s("mapResponse",{total:(h=t.mapResponse)==null?void 0:h.length,name:"context"});if((a=t.mapResponse)!=null&&a.length)for(let N=0;N<t.mapResponse.length;N++){const z=t.mapResponse[N],E=oe.resolveChild(z.fn.name);r+=`context.response=_r_r=${fn(z)?"await ":""}onMapResponse[${N}](context)
`,E()}oe.resolve(),r+=`return mapResponse(${c}_r,set${n.mapResponseContext})}`}else r+=H;r+="}"}r+=`if(error.constructor.name==="ValidationError"||error.constructor.name==="TransformDecodeError"){if(error.error)error=error.error
set.status=error.status??422
`+n.validationError+"}",r+="if(error instanceof Error){"+n.unknownError+"}";const u=s("mapResponse",{total:(x=t.mapResponse)==null?void 0:x.length,name:"context"});if(r+=`
if(!context.response)context.response=error.message??error
`,(P=t.mapResponse)!=null&&P.length){r+=`let mr
`;for(let D=0;D<t.mapResponse.length;D++){const B=t.mapResponse[D],H=u.resolveChild(B.fn.name);r+=`if(mr===undefined){mr=${fn(B)?"await ":""}onMapResponse[${D}](context)
if(mr!==undefined)error=context.response=mr}`,H()}}return u.resolve(),r+=`
return mapResponse(${c}error,set${n.mapResponseContext})}`,Function("inject",r)({app:e,mapResponse:e["~adapter"].handler.mapResponse,ERROR_CODE:ji,ElysiaCustomStatusResponse:tr,ELYSIA_TRACE:o?gs:void 0,ELYSIA_REQUEST_ID:o?no:void 0,...n.inject})},lo=(e,t)=>{for(const[r,n]of Object.entries(e.schema.properties))t[r]??(t[r]=n.default)},Xc=e=>{const{mapResponse:t,mapEarlyResponse:r}=e["~adapter"].handler;return async n=>{var p,m,g,l,h,a,x,P,D,B,H,oe,N,z,E,U,ue,we,ze;const i=n.url,o=i.indexOf("/",11),s=i.indexOf("?",o+1),c=s===-1?i.substring(o):i.substring(o,s),u={cookie:{},status:200,headers:{}},f=Object.assign({},e.singleton.decorator,{set:u,store:e.singleton.store,request:n,path:c,qi:s,error:$u,redirect:gu});try{if(e.event.request)for(let q=0;q<e.event.request.length;q++){const J=e.event.request[q].fn;let L=J(f);if(L instanceof Promise&&(L=await L),L=r(L,u),L)return f.response=L}const le=e.router.dynamic.find(n.method,c)??e.router.dynamic.find("ALL",c);if(!le)throw new bu;const{handle:Z,hooks:_,validator:T,content:ve,route:rr}=le.store;let me;if(n.method!=="GET"&&n.method!=="HEAD")if(ve)switch(ve){case"application/json":me=await n.json();break;case"text/plain":me=await n.text();break;case"application/x-www-form-urlencoded":me=Oi(await n.text());break;case"application/octet-stream":me=await n.arrayBuffer();break;case"multipart/form-data":me={};const q=await n.formData();for(const J of q.keys()){if(me[J])continue;const L=q.getAll(J);L.length===1?me[J]=L[0]:me[J]=L}break}else{let q=n.headers.get("content-type");if(q){const J=q.indexOf(";");if(J!==-1&&(q=q.slice(0,J)),f.contentType=q,_.parse)for(let L=0;L<_.parse.length;L++){const ae=_.parse[L].fn;let Le=ae(f,q);if(Le instanceof Promise&&(Le=await Le),Le){me=Le;break}}if(delete f.contentType,me===void 0)switch(q){case"application/json":me=await n.json();break;case"text/plain":me=await n.text();break;case"application/x-www-form-urlencoded":me=Oi(await n.text());break;case"application/octet-stream":me=await n.arrayBuffer();break;case"multipart/form-data":me={};const L=await n.formData();for(const ae of L.keys()){if(me[ae])continue;const Le=L.getAll(ae);Le.length===1?me[ae]=Le[0]:me[ae]=Le}break}}}f.route=rr,f.body=me,f.params=(le==null?void 0:le.params)||void 0,f.query=s===-1?{}:Oi(i.substring(s+1)),f.headers={};for(const[q,J]of n.headers.entries())f.headers[q]=J;const ie=Object.assign({},(p=e.config)==null?void 0:p.cookie,(m=T==null?void 0:T.cookie)==null?void 0:m.config),ne=n.headers.get("cookie");f.cookie=await Eu(f.set,ne,ie?{secrets:ie.secrets!==void 0?typeof ie.secrets=="string"?ie.secrets:ie.secrets.join(","):void 0,sign:ie.sign===!0?!0:ie.sign!==void 0?typeof ie.sign=="string"?ie.sign:ie.sign.join(","):void 0}:void 0);const Je=(g=T==null?void 0:T.createHeaders)==null?void 0:g.call(T);Je&&lo(Je,f.headers);const ft=(l=T==null?void 0:T.createParams)==null?void 0:l.call(T);ft&&lo(ft,f.params);const ut=(h=T==null?void 0:T.createQuery)==null?void 0:h.call(T);if(ut&&lo(ut,f.query),_.transform)for(let q=0;q<_.transform.length;q++){const J=_.transform[q],L=J.fn(f);J.subType==="derive"?L instanceof Promise?Object.assign(f,await L):Object.assign(f,L):L instanceof Promise&&await L}if(T){if(Je){const q=structuredClone(f.headers);for(const[J,L]of n.headers)q[J]=L;if(T.headers.Check(q)===!1)throw new Y("header",T.headers,q)}else(a=T.headers)!=null&&a.Decode&&(f.headers=T.headers.Decode(f.headers));if((ft==null?void 0:ft.Check(f.params))===!1)throw new Y("params",T.params,f.params);if((x=T.params)!=null&&x.Decode&&(f.params=T.params.Decode(f.params)),(ut==null?void 0:ut.Check(f.query))===!1)throw new Y("query",T.query,f.query);if((P=T.query)!=null&&P.Decode&&(f.query=T.query.Decode(f.query)),(D=T.createCookie)!=null&&D.call(T)){let q={};for(const[J,L]of Object.entries(f.cookie))q[J]=L.value;if(T.cookie.Check(q)===!1)throw new Y("cookie",T.cookie,q);(B=T.cookie)!=null&&B.Decode&&(q=T.cookie.Decode(q))}if(((oe=(H=T.createBody)==null?void 0:H.call(T))==null?void 0:oe.Check(me))===!1)throw new Y("body",T.body,me);(N=T.body)!=null&&N.Decode&&(f.body=T.body.Decode(me))}if(_.beforeHandle)for(let q=0;q<_.beforeHandle.length;q++){const J=_.beforeHandle[q];let L=J.fn(f);if(J.subType==="resolve"){if(L instanceof tr){const ae=r(L,f.set);if(ae)return f.response=ae}L instanceof Promise?Object.assign(f,await L):Object.assign(f,L);continue}else L instanceof Promise&&(L=await L);if(L!==void 0){if(f.response=L,_.afterHandle)for(let Le=0;Le<_.afterHandle.length;Le++){let d=_.afterHandle[Le].fn(f);d instanceof Promise&&(d=await d),d&&(L=d)}const ae=r(L,f.set);if(ae)return f.response=ae}}let ye=typeof Z=="function"?Z(f):Z;if(ye instanceof Promise&&(ye=await ye),_.afterHandle)if(_.afterHandle.length){f.response=ye;for(let q=0;q<_.afterHandle.length;q++){let J=_.afterHandle[q].fn(f);J instanceof Promise&&(J=await J);const L=r(J,f.set);if(L!==void 0){const ae=(U=T==null?void 0:T.response)==null?void 0:U[L.status];if((ae==null?void 0:ae.Check(L))===!1)throw new Y("response",ae,L);return ae!=null&&ae.Decode&&(ye=ae.Decode(ye)),f.response=L}}}else{const q=ye instanceof tr?ye.code:u.status?typeof u.status=="string"?ro[u.status]:u.status:200,J=(E=(z=T==null?void 0:T.createResponse)==null?void 0:z.call(T))==null?void 0:E[q];if((J==null?void 0:J.Check(ye))===!1)throw new Y("response",J,ye);J!=null&&J.Decode&&(ye=J.Decode(ye))}if(f.set.cookie&&(ie!=null&&ie.sign)){const q=ie.secrets?typeof ie.secrets=="string"?ie.secrets:ie.secrets[0]:void 0;if(ie.sign===!0)for(const[J,L]of Object.entries(f.set.cookie))f.set.cookie[J].value=await Si(L.value,"${secret}");else{const J=(we=(ue=T==null?void 0:T.cookie)==null?void 0:ue.schema)==null?void 0:we.properties;for(const L of ie.sign)L in J&&(ze=f.set.cookie[L])!=null&&ze.value&&(f.set.cookie[L].value=await Si(f.set.cookie[L].value,q))}}return t(f.response=ye,f.set)}catch(le){const Z=le instanceof cu&&le.error?le.error:le;return e.handleError(f,Z)}finally{if(e.event.afterResponse)for(const le of e.event.afterResponse)await le.fn(f)}}},u0=e=>{const{mapResponse:t}=e["~adapter"].handler;return async(r,n)=>{const i=Object.assign(r,{error:n,code:n.code});if(i.set=r.set,e.event.error)for(let o=0;o<e.event.error.length;o++){let c=e.event.error[o].fn(i);if(c instanceof Promise&&(c=await c),c!=null)return r.response=t(c,r.set)}return new Response(typeof n.cause=="string"?n.cause:n.message,{headers:r.set.headers,status:n.status??500})}};class Kt{constructor(t={}){this.server=null,this.dependencies={},this._routes={},this._types={Prefix:"",Singleton:{},Definitions:{},Metadata:{}},this._ephemeral={},this._volatile={},this.singleton={decorator:{},store:{},derive:{},resolve:{}},this.definitions={typebox:I.Module({}),type:{},error:{}},this.extender={macros:[],higherOrderFunctions:[]},this.validator={global:null,scoped:null,local:null,getCandidate(){return En(En(this.global,this.scoped),this.local)}},this.event={},this.telemetry={stack:void 0},this.router={"~http":void 0,get http(){return this["~http"]||(this["~http"]=new pc({lazy:!0})),this["~http"]},"~dynamic":void 0,get dynamic(){return this["~dynamic"]||(this["~dynamic"]=new pc),this["~dynamic"]},static:{http:{static:{},map:{},all:""},ws:{}},history:[]},this.routeTree=new Map,this.inference={body:!1,cookie:!1,headers:!1,query:!1,set:!1,server:!1,request:!1,route:!1},this["~parser"]={},this.handle=async r=>this.fetch(r),this.fetch=r=>(this.fetch=this.config.aot?ao(this):Xc(this))(r),this.handleError=async(r,n)=>(this.handleError=this.config.aot?Mu(this):u0(this))(r,n),this.outerErrorHandler=r=>new Response(r.message||r.name||"Error",{status:(r==null?void 0:r.status)??500}),this.listen=(r,n)=>(this["~adapter"].listen(this)(r,n),this),this.stop=async r=>{var n;if(!this.server)throw new Error("Elysia isn't running. Call `app.listen` to start the server.");if(this.server&&(this.server.stop(r),this.server=null,(n=this.event.stop)!=null&&n.length))for(let i=0;i<this.event.stop.length;i++)this.event.stop[i].fn(this)},t.tags&&(t.detail?t.detail.tags=t.tags:t.detail={tags:t.tags}),t.nativeStaticResponse===void 0&&(t.nativeStaticResponse=!0),this.config={},this.applyConfig(t??{}),this["~adapter"]=t.adapter??(typeof Bun<"u"?e0:bi),t!=null&&t.analytic&&(t!=null&&t.name||(t==null?void 0:t.seed)!==void 0)&&(this.telemetry.stack=new Error().stack)}get store(){return this.singleton.store}get decorator(){return this.singleton.decorator}get routes(){return this.router.history}getGlobalRoutes(){return this.router.history}getServer(){return this.server}getParent(){return null}get promisedModules(){return this._promisedModules||(this._promisedModules=new Nb),this._promisedModules}env(t,r=Zc){if(mt(t,{modules:this.definitions.typebox,dynamic:!0,additionalProperties:!0,coerce:!0}).Check(r)===!1){const i=new Y("env",t,r);throw new Error(i.all.map(o=>o.summary).join(`
`))}return this}wrap(t){return this.extender.higherOrderFunctions.push({checksum:Cn(JSON.stringify({name:this.config.name,seed:this.config.seed,content:t.toString()})),fn:t}),this}applyMacro(t){if(this.extender.macros.length){const r=Eb({globalHook:this.event,localHook:t}),n={events:{global:this.event,local:t},get onParse(){return r("parse")},get onTransform(){return r("transform")},get onBeforeHandle(){return r("beforeHandle")},get onAfterHandle(){return r("afterHandle")},get mapResponse(){return r("mapResponse")},get onAfterResponse(){return r("afterResponse")},get onError(){return r("error")}};for(const i of this.extender.macros)jb(i.fn(n),t,r)}}applyConfig(t){return this.config={prefix:"",aot:Zc.ELYSIA_AOT!=="false",normalize:!0,...t,cookie:{path:"/",...t==null?void 0:t.cookie},experimental:(t==null?void 0:t.experimental)??{},seed:(t==null?void 0:t.seed)===void 0?"":t==null?void 0:t.seed},this}get models(){const t={};for(const r of Object.keys(this.definitions.type))t[r]=mt(this.definitions.typebox.Import(r));return t.modules=this.definitions.typebox,t}add(t,r,n,i,{allowMeta:o=!1,skipPrefix:s=!1}={allowMeta:!1,skipPrefix:!1}){var le;if(i=uo(Tb(i)),r!==""&&r.charCodeAt(0)!==47&&(r="/"+r),this.config.prefix&&!s&&(r=this.config.prefix+r),i!=null&&i.type)switch(i.type){case"text":i.type="text/plain";break;case"json":i.type="application/json";break;case"formdata":i.type="multipart/form-data";break;case"urlencoded":i.type="application/x-www-form-urlencoded";break;case"arrayBuffer":i.type="application/octet-stream";break}const c=this.definitions.type,u=!this.config.aot,f={...this.validator.getCandidate()},p={body:(i==null?void 0:i.body)??(f==null?void 0:f.body),headers:(i==null?void 0:i.headers)??(f==null?void 0:f.headers),params:(i==null?void 0:i.params)??(f==null?void 0:f.params),query:(i==null?void 0:i.query)??(f==null?void 0:f.query),cookie:(i==null?void 0:i.cookie)??(f==null?void 0:f.cookie),response:(i==null?void 0:i.response)??(f==null?void 0:f.response)},m=()=>{var Z;return p.cookie?yu({modules:l,validator:p.cookie,defaultConfig:this.config.cookie,config:((Z=p.cookie)==null?void 0:Z.config)??{},dynamic:u,models:c}):void 0},g=this.config.normalize,l=this.definitions.typebox,h=this.config.precompile===!0||typeof this.config.precompile=="object"&&this.config.precompile.schema===!0?{body:mt(p.body,{modules:l,dynamic:u,models:c,normalize:g,additionalCoerce:Tc()}),headers:mt(p.headers,{modules:l,dynamic:u,models:c,additionalProperties:!this.config.normalize,coerce:!0,additionalCoerce:Mr()}),params:mt(p.params,{modules:l,dynamic:u,models:c,coerce:!0,additionalCoerce:Mr()}),query:mt(p.query,{modules:l,dynamic:u,models:c,normalize:g,coerce:!0,additionalCoerce:Mr()}),cookie:m(),response:Nc(p.response,{modules:l,dynamic:u,models:c,normalize:g})}:{createBody(){return this.body?this.body:this.body=mt(p.body,{modules:l,dynamic:u,models:c,normalize:g,additionalCoerce:Tc()})},createHeaders(){return this.headers?this.headers:this.headers=mt(p.headers,{modules:l,dynamic:u,models:c,additionalProperties:!g,coerce:!0,additionalCoerce:Mr()})},createParams(){return this.params?this.params:this.params=mt(p.params,{modules:l,dynamic:u,models:c,coerce:!0,additionalCoerce:Mr()})},createQuery(){return this.query?this.query:this.query=mt(p.query,{modules:l,dynamic:u,models:c,coerce:!0,additionalCoerce:Mr()})},createCookie(){return this.cookie?this.cookie:this.cookie=m()},createResponse(){return this.response?this.response:this.response=Nc(p.response,{modules:l,dynamic:u,models:c,normalize:g})}};i=nr(i,uo(f)),i.tags&&(i.detail?i.detail.tags=i.tags:i.detail={tags:i.tags}),Mt(this.config.detail)&&(i.detail=lt(Object.assign({},this.config.detail),i.detail)),this.applyMacro(i);const a=uo(nr(this.event,i));if(this.config.aot===!1){this.router.dynamic.add(t,r,{validator:h,hooks:a,content:i==null?void 0:i.type,handle:n,route:r});const Z=Tn(r,{dynamic:!0});if(r!==Z&&this.router.dynamic.add(t,Z,{validator:h,hooks:a,content:i==null?void 0:i.type,handle:n,route:r}),this.config.strictPath===!1){const _=sn(r);this.router.dynamic.add(t,_,{validator:h,hooks:a,content:i==null?void 0:i.type,handle:n,route:r});const T=Tn(_);_!==T&&this.router.dynamic.add(t,_,{validator:h,hooks:a,content:i==null?void 0:i.type,handle:n,route:r})}this.router.history.push({method:t,path:r,composed:null,handler:n,hooks:a});return}const x=this.config.precompile===!0||typeof this.config.precompile=="object"&&this.config.precompile.compose===!0,P=fo(this.inference),D=this["~adapter"].handler,B=typeof n!="function"&&typeof D.createStaticHandler=="function"?D.createStaticHandler(n,a,this.setHeaders):void 0,H=typeof n!="function"?(le=D.createNativeStaticHandler)==null?void 0:le.call(D,n,a,this.setHeaders):void 0;this.config.nativeStaticResponse===!0&&H&&(t==="GET"||t==="ALL")&&(this.router.static.http.static[r]=H());let oe=(Z=!1)=>f0({app:this,path:r,method:t,hooks:a,validator:h,handler:typeof n!="function"&&typeof D.createStaticHandler!="function"?()=>n:n,allowMeta:o,inference:P,asManifest:Z}),N;if(this.routeTree.has(t+r))for(let Z=0;Z<this.router.history.length;Z++){const _=this.router.history[Z];if(_.path===r&&_.method===t){N=Z;break}}else this.routeTree.set(t+r,this.router.history.length);const z=this.router.history,E=N??this.router.history.length,U=x?oe():Z=>{const _=(z[E].composed=oe())(Z);return oe=void 0,_};x&&(oe=void 0);const ue=t==="$INTERNALWS";N!==void 0?this.router.history[N]=Object.assign({method:t,path:r,composed:U,handler:n,hooks:a},i.webSocket?{websocket:i.websocket}:{}):this.router.history.push(Object.assign({method:t,path:r,composed:U,handler:n,hooks:a},i.webSocket?{websocket:i.websocket}:{}));const we=this.router.static.http,ze={handler:x?U:void 0,compile(){return this.handler=oe()}};if(ue){this.router.http.add("ws",r,ze),this.config.strictPath||this.router.http.add("ws",sn(r),ze);const Z=Tn(r,{dynamic:!0});Z!==r&&this.router.http.add("ws",Z,ze);return}if(r.indexOf(":")===-1&&r.indexOf("*")===-1){we.map[r]||(we.map[r]={code:""});const Z=B?"":"c";t==="ALL"?we.map[r].all=`default:return ht[${E}].composed(${Z})
`:we.map[r].code=`case '${t}':return ht[${E}].composed(${Z})
${we.map[r].code}`,!this.config.strictPath&&this.config.nativeStaticResponse===!0&&H&&(t==="GET"||t==="ALL")&&(this.router.static.http.static[sn(r)]=H())}else{if(this.router.http.add(t,r,ze),!this.config.strictPath){const _=sn(r);this.config.nativeStaticResponse===!0&&B&&(t==="GET"||t==="ALL")&&(this.router.static.http.static[_]=B()),this.router.http.add(t,_,ze)}const Z=Tn(r,{dynamic:!0});r!==Z&&(this.router.http.add(t,Z,ze),this.config.nativeStaticResponse===!0&&B&&(t==="GET"||t==="ALL")&&(this.router.static.http.static[Z]=B()),this.router.http.add(t,Z,ze))}}headers(t){return t?(this.setHeaders||(this.setHeaders={}),this.setHeaders=lt(this.setHeaders,t),this):this}onStart(t){return this.on("start",t),this}onRequest(t){return this.on("request",t),this}onParse(t,r){return r?this.on(t,"parse",r):typeof t=="string"?this.on("parse",this["~parser"][t]):this.on("parse",t)}parser(t,r){return this["~parser"][t]=r,this}onTransform(t,r){return r?this.on(t,"transform",r):this.on("transform",t)}resolve(t,r){r||(r=t,t={as:"local"});const n={subType:"resolve",fn:r};return this.onBeforeHandle(t,n)}mapResolve(t,r){r||(r=t,t={as:"local"});const n={subType:"mapResolve",fn:r};return this.onBeforeHandle(t,n)}onBeforeHandle(t,r){return r?this.on(t,"beforeHandle",r):this.on("beforeHandle",t)}onAfterHandle(t,r){return r?this.on(t,"afterHandle",r):this.on("afterHandle",t)}mapResponse(t,r){return r?this.on(t,"mapResponse",r):this.on("mapResponse",t)}onAfterResponse(t,r){return r?this.on(t,"afterResponse",r):this.on("afterResponse",t)}trace(t,r){r||(r=t,t={as:"local"}),Array.isArray(r)||(r=[r]);for(const n of r)this.on(t,"trace",n0(n));return this}error(t,r){switch(typeof t){case"string":return r.prototype[ji]=t,this.definitions.error[t]=r,this;case"function":return this.definitions.error=t(this.definitions.error),this}for(const[n,i]of Object.entries(t))i.prototype[ji]=n,this.definitions.error[n]=i;return this}onError(t,r){return r?this.on(t,"error",r):this.on("error",t)}onStop(t){return this.on("stop",t),this}on(t,r,n){var s,c,u,f,p,m,g,l,h,a,x,P,D;let i;switch(typeof t){case"string":i=t,n=r;break;case"object":i=r,!Array.isArray(r)&&typeof r=="object"&&(n=r);break}Array.isArray(n)?n=De(n):typeof n=="function"?n=[{fn:n}]:n=[n];const o=n;for(const B of o)B.scope=typeof t=="string"?"local":(t==null?void 0:t.as)??"local",(i==="resolve"||i==="derive")&&(B.subType=i);i!=="trace"&&Pu({[i]:o.map(B=>B.fn)},this.inference);for(const B of o){const H=Pb(B,"global",{skipIfHasType:!0});switch(i){case"start":(s=this.event).start??(s.start=[]),this.event.start.push(H);break;case"request":(c=this.event).request??(c.request=[]),this.event.request.push(H);break;case"parse":(u=this.event).parse??(u.parse=[]),this.event.parse.push(H);break;case"transform":(f=this.event).transform??(f.transform=[]),this.event.transform.push(H);break;case"derive":(p=this.event).transform??(p.transform=[]),this.event.transform.push(De(H,"derive"));break;case"beforeHandle":(m=this.event).beforeHandle??(m.beforeHandle=[]),this.event.beforeHandle.push(H);break;case"resolve":(g=this.event).beforeHandle??(g.beforeHandle=[]),this.event.beforeHandle.push(De(H,"resolve"));break;case"afterHandle":(l=this.event).afterHandle??(l.afterHandle=[]),this.event.afterHandle.push(H);break;case"mapResponse":(h=this.event).mapResponse??(h.mapResponse=[]),this.event.mapResponse.push(H);break;case"afterResponse":(a=this.event).afterResponse??(a.afterResponse=[]),this.event.afterResponse.push(H);break;case"trace":(x=this.event).trace??(x.trace=[]),this.event.trace.push(H);break;case"error":(P=this.event).error??(P.error=[]),this.event.error.push(H);break;case"stop":(D=this.event).stop??(D.stop=[]),this.event.stop.push(H);break}}return this}propagate(){return tt(this.event.parse),tt(this.event.transform),tt(this.event.beforeHandle),tt(this.event.afterHandle),tt(this.event.mapResponse),tt(this.event.afterResponse),tt(this.event.trace),tt(this.event.error),this}as(t){const r={plugin:"scoped",scoped:"scoped",global:"global"}[t];return tt(this.event.parse,r),tt(this.event.transform,r),tt(this.event.beforeHandle,r),tt(this.event.afterHandle,r),tt(this.event.mapResponse,r),tt(this.event.afterResponse,r),tt(this.event.trace,r),tt(this.event.error,r),t==="plugin"?(this.validator.scoped=En(this.validator.scoped,this.validator.local),this.validator.local=null):t==="global"&&(this.validator.global=En(this.validator.global,En(this.validator.scoped,this.validator.local)),this.validator.scoped=null,this.validator.local=null),this}group(t,r,n){var c,u;const i=new Kt({...this.config,prefix:""});i.singleton={...this.singleton},i.definitions={...this.definitions},i.getServer=()=>this.getServer(),i.inference=fo(this.inference),i.extender={...this.extender};const o=typeof r=="object",s=(o?n:r)(i);return this.singleton=lt(this.singleton,i.singleton),this.definitions=lt(this.definitions,i.definitions),(c=s.event.request)!=null&&c.length&&(this.event.request=[...this.event.request||[],...s.event.request||[]]),(u=s.event.mapResponse)!=null&&u.length&&(this.event.mapResponse=[...this.event.mapResponse||[],...s.event.mapResponse||[]]),this.model(s.definitions.type),Object.values(i.router.history).forEach(({method:f,path:p,handler:m,hooks:g})=>{if(p=(o?"":this.config.prefix)+t+p,o){const l=r,h=g;this.add(f,p,m,nr(l,{...h||{},error:h.error?Array.isArray(h.error)?[...h.error||{},...s.event.error||{}]:[h.error,...s.event.error||{}]:s.event.error}))}else this.add(f,p,m,nr(g,{error:s.event.error}),{skipPrefix:!0})}),this}guard(t,r){var o,s,c,u,f,p,m,g;if(!r){if(typeof t=="object"){this.applyMacro(t);const l=t.as??"local";return this.validator[l]={body:t.body??((o=this.validator[l])==null?void 0:o.body),headers:t.headers??((s=this.validator[l])==null?void 0:s.headers),params:t.params??((c=this.validator[l])==null?void 0:c.params),query:t.query??((u=this.validator[l])==null?void 0:u.query),response:t.response??((f=this.validator[l])==null?void 0:f.response),cookie:t.cookie??((p=this.validator[l])==null?void 0:p.cookie)},t.parse&&this.on({as:l},"parse",t.parse),t.transform&&this.on({as:l},"transform",t.transform),t.derive&&this.on({as:l},"derive",t.derive),t.beforeHandle&&this.on({as:l},"beforeHandle",t.beforeHandle),t.resolve&&this.on({as:l},"resolve",t.resolve),t.afterHandle&&this.on({as:l},"afterHandle",t.afterHandle),t.mapResponse&&this.on({as:l},"mapResponse",t.mapResponse),t.afterResponse&&this.on({as:l},"afterResponse",t.afterResponse),t.error&&this.on({as:l},"error",t.error),t.detail&&(this.config.detail?this.config.detail=lt(Object.assign({},this.config.detail),t.detail):this.config.detail=t.detail),t!=null&&t.tags&&(this.config.detail?this.config.detail.tags=t.tags:this.config.detail={tags:t.tags}),this}return this.guard({},t)}const n=new Kt({...this.config,prefix:""});n.singleton={...this.singleton},n.definitions={...this.definitions},n.inference=fo(this.inference),n.extender={...this.extender};const i=r(n);return this.singleton=lt(this.singleton,n.singleton),this.definitions=lt(this.definitions,n.definitions),i.getServer=()=>this.server,(m=i.event.request)!=null&&m.length&&(this.event.request=[...this.event.request||[],...i.event.request||[]]),(g=i.event.mapResponse)!=null&&g.length&&(this.event.mapResponse=[...this.event.mapResponse||[],...i.event.mapResponse||[]]),this.model(i.definitions.type),Object.values(n.router.history).forEach(({method:l,path:h,handler:a,hooks:x})=>{this.add(l,h,a,nr(t,{...x||{},error:x.error?Array.isArray(x.error)?[...x.error||{},...i.event.error||[]]:[x.error,...i.event.error||[]]:i.event.error}))}),this}use(t,r){if(Array.isArray(t)){let n=this;for(const i of t)n=n.use(i);return n}if(r!=null&&r.scoped)return this.guard({},n=>n.use(t));if(Array.isArray(t)){let n=this;for(const i of t)n=this.use(i);return n}return t instanceof Promise?(this.promisedModules.add(t.then(n=>{if(typeof n=="function")return n(this);if(n instanceof Kt)return this._use(n).compile();if(n.constructor.name==="Elysia")return this._use(n).compile();if(typeof n.default=="function")return n.default(this);if(n.default instanceof Kt)return this._use(n.default);if(n.constructor.name==="Elysia")return this._use(n.default);if(n.constructor.name==="_Elysia")return this._use(n.default);try{return this._use(n.default)}catch(i){throw console.error('Invalid plugin type. Expected Elysia instance, function, or module with "default" as Elysia instance or function that returns Elysia instance.'),i}}).then(n=>(n&&typeof n.compile=="function"&&n.compile(),n))),this):this._use(t)}propagatePromiseModules(t){if(t.promisedModules.size<=0)return this;for(const r of t.promisedModules.promises)this.promisedModules.add(r.then(n=>{if(!n)return;const i=this._use(n);return i instanceof Promise?i.then(o=>{o?o.compile():n.compile()}):n.compile()}));return this}_use(t){var o,s,c;if(typeof t=="function"){const u=t(this);return u instanceof Promise?(this.promisedModules.add(u.then(f=>{if(f instanceof Kt){f.getServer=()=>this.getServer(),f.getGlobalRoutes=()=>this.getGlobalRoutes(),f.model(this.definitions.type),f.error(this.definitions.error);for(const{method:p,path:m,handler:g,hooks:l}of Object.values(f.router.history))this.add(p,m,g,nr(l,{error:f.event.error}));return f.compile(),f===this?void 0:(this.propagatePromiseModules(f),f)}return typeof f=="function"?f(this):typeof f.default=="function"?f.default(this):this._use(f)}).then(f=>(f&&typeof f.compile=="function"&&f.compile(),f))),this):u}this.propagatePromiseModules(t);const{name:r,seed:n}=t.config;if(t.getParent=()=>this,t.getServer=()=>this.getServer(),t.getGlobalRoutes=()=>this.getGlobalRoutes(),t.model(this.definitions.type),t.error(this.definitions.error),this["~parser"]={...t["~parser"],...this["~parser"]},this.headers(t.setHeaders),r){r in this.dependencies||(this.dependencies[r]=[]);const u=n!==void 0?Cn(r+JSON.stringify(n)):0;this.dependencies[r].some(({checksum:f})=>u===f)||(this.extender.macros=this.extender.macros.concat(t.extender.macros),this.extender.higherOrderFunctions=this.extender.higherOrderFunctions.concat(t.extender.higherOrderFunctions))}else this.extender.macros=this.extender.macros.concat(t.extender.macros),this.extender.higherOrderFunctions=this.extender.higherOrderFunctions.concat(t.extender.higherOrderFunctions);_c(this.extender.macros),_c(this.extender.higherOrderFunctions);const i=[];for(let u=0;u<this.extender.higherOrderFunctions.length;u++){const f=this.extender.higherOrderFunctions[u];f.checksum&&(i.includes(f.checksum)&&(this.extender.higherOrderFunctions.splice(u,1),u--),i.push(f.checksum))}this.inference={body:this.inference.body||t.inference.body,cookie:this.inference.cookie||t.inference.cookie,headers:this.inference.headers||t.inference.headers,query:this.inference.query||t.inference.query,set:this.inference.set||t.inference.set,server:this.inference.server||t.inference.server,request:this.inference.request||t.inference.request,route:this.inference.route||t.inference.route},this.decorate(t.singleton.decorator),this.state(t.singleton.store),this.model(t.definitions.type),this.error(t.definitions.error),t.extender.macros=this.extender.macros.concat(t.extender.macros);for(const{method:u,path:f,handler:p,hooks:m}of Object.values(t.router.history))this.add(u,f,p,nr(m,{error:t.event.error}));if(r){r in this.dependencies||(this.dependencies[r]=[]);const u=n!==void 0?Cn(r+JSON.stringify(n)):0;if(this.dependencies[r].some(({checksum:f})=>u===f))return this;this.dependencies[r].push((o=this.config)!=null&&o.analytic?{name:t.config.name,seed:t.config.seed,checksum:u,dependencies:t.dependencies,stack:t.telemetry.stack,routes:t.router.history,decorators:t.singleton,store:t.singleton.store,error:t.definitions.error,derive:(s=t.event.transform)==null?void 0:s.filter(f=>(f==null?void 0:f.subType)==="derive").map(f=>({fn:f.toString(),stack:new Error().stack??""})),resolve:(c=t.event.transform)==null?void 0:c.filter(f=>(f==null?void 0:f.subType)==="resolve").map(f=>({fn:f.toString(),stack:new Error().stack??""}))}:{name:t.config.name,seed:t.config.seed,checksum:u,dependencies:t.dependencies}),this.event=Mc(this.event,Uc(t.event),u)}else this.event=Mc(this.event,Uc(t.event));return this.validator.global=nr(this.validator.global,{...t.validator.global}),this.validator.local=nr(this.validator.local,{...t.validator.scoped}),this}macro(t){if(typeof t=="function"){const r={checksum:Cn(JSON.stringify({name:this.config.name,seed:this.config.seed,content:t.toString()})),fn:t};this.extender.macros.push(r)}else if(typeof t=="object"){for(const n of Object.keys(t))if(typeof t[n]=="object"){const i={...t[n]};t[n]=o=>{if(o===!0)return i}}const r={checksum:Cn(JSON.stringify({name:this.config.name,seed:this.config.seed,content:Object.entries(t).map(([n,i])=>`${n}+${i}`).join(",")})),fn:()=>t};this.extender.macros.push(r)}return this}mount(t,r){if(t instanceof Kt||typeof t=="function"||t.length===0||t==="/"){const o=typeof t=="function"?t:t instanceof Kt?t.compile().fetch:r instanceof Kt?r.compile().fetch:r,s=({request:c,path:u})=>o(new Request(Cc(c.url,u),{method:c.method,headers:c.headers,signal:c.signal,credentials:c.credentials,referrerPolicy:c.referrerPolicy,duplex:c.duplex,redirect:c.redirect,mode:c.mode,keepalive:c.keepalive,integrity:c.integrity,body:c.body}));return this.all("/*",s,{parse:"none"}),this}if(!r)return this;const n=t.length-(t.endsWith("*")?1:0);r instanceof Kt&&(r=r.compile().fetch);const i=({request:o,path:s})=>r(new Request(Cc(o.url,s.slice(n)||"/"),{method:o.method,headers:o.headers,signal:o.signal,credentials:o.credentials,referrerPolicy:o.referrerPolicy,duplex:o.duplex,redirect:o.redirect,mode:o.mode,keepalive:o.keepalive,integrity:o.integrity,body:o.body}));return this.all(t,i,{parse:"none"}),this.all(t+(t.endsWith("/")?"*":"/*"),i,{parse:"none"}),this}get(t,r,n){return this.add("GET",t,r,n),this}post(t,r,n){return this.add("POST",t,r,n),this}put(t,r,n){return this.add("PUT",t,r,n),this}patch(t,r,n){return this.add("PATCH",t,r,n),this}delete(t,r,n){return this.add("DELETE",t,r,n),this}options(t,r,n){return this.add("OPTIONS",t,r,n),this}all(t,r,n){return this.add("ALL",t,r,n),this}head(t,r,n){return this.add("HEAD",t,r,n),this}connect(t,r,n){return this.add("CONNECT",t,r,n),this}route(t,r,n,i){return this.add(t.toUpperCase(),r,n,i,i==null?void 0:i.config),this}ws(t,r){return this["~adapter"].ws?this["~adapter"].ws(this,t,r):console.warn("Current adapter doesn't support WebSocket"),this}state(t,r,n){r===void 0?(n=t,t={as:"append"},r=""):n===void 0&&(typeof t=="string"?(n=r,r=t,t={as:"append"}):typeof t=="object"&&(n=r,r=""));const{as:i}=t;if(typeof r!="string")return this;switch(typeof n){case"object":return r?(r in this.singleton.store?this.singleton.store[r]=lt(this.singleton.store[r],n,{override:i==="override"}):this.singleton.store[r]=n,this):n===null?this:(this.singleton.store=lt(this.singleton.store,n,{override:i==="override"}),this);case"function":return r?(i==="override"||!(r in this.singleton.store))&&(this.singleton.store[r]=n):this.singleton.store=n(this.singleton.store),this;default:return(i==="override"||!(r in this.singleton.store))&&(this.singleton.store[r]=n),this}}decorate(t,r,n){r===void 0?(n=t,t={as:"append"},r=""):n===void 0&&(typeof t=="string"?(n=r,r=t,t={as:"append"}):typeof t=="object"&&(n=r,r=""));const{as:i}=t;if(typeof r!="string")return this;switch(typeof n){case"object":return r?(r in this.singleton.decorator?this.singleton.decorator[r]=lt(this.singleton.decorator[r],n,{override:i==="override"}):this.singleton.decorator[r]=n,this):n===null?this:(this.singleton.decorator=lt(this.singleton.decorator,n,{override:i==="override"}),this);case"function":return r?(i==="override"||!(r in this.singleton.decorator))&&(this.singleton.decorator[r]=n):this.singleton.decorator=n(this.singleton.decorator),this;default:return(i==="override"||!(r in this.singleton.decorator))&&(this.singleton.decorator[r]=n),this}}derive(t,r){r||(r=t,t={as:"local"});const n={subType:"derive",fn:r};return this.onTransform(t,n)}model(t,r){var i;const n=o=>Io(o,[{from:I.Number(),to:s=>I.Numeric(s),untilObjectFound:!0},{from:I.Boolean(),to:s=>I.BooleanString(s),untilObjectFound:!0}]);switch(typeof t){case"object":const o={},s=Object.entries(t);for(const[f,p]of s)f in this.definitions.type||(o[f]=this.definitions.type[f]=n(p),(i=o[f]).$id??(i.$id=`#/components/schemas/${f}`));return this.definitions.typebox=I.Module({...this.definitions.typebox.$defs,...o}),this;case"function":const c=n(t(this.definitions.type));return this.definitions.type=c,this.definitions.typebox=I.Module(c),this;case"string":if(!r)break;const u={...r,id:r.$id??`#/components/schemas/${t}`};return this.definitions.type[t]=r,this.definitions.typebox=I.Module({...this.definitions.typebox.$defs,...u}),this}return this.definitions.type[t]=r,this.definitions.typebox=I.Module({...this.definitions.typebox.$defs,[t]:r}),this}mapDerive(t,r){r||(r=t,t={as:"local"});const n={subType:"mapDerive",fn:r};return this.onTransform(t,n)}affix(t,r,n){if(n==="")return this;const i=["_","-"," "],o=f=>f[0].toUpperCase()+f.slice(1),s=t==="prefix"?(f,p)=>i.includes(f.at(-1)??"")?f+p:f+o(p):i.includes(n.at(-1)??"")?(f,p)=>p+f:(f,p)=>p+o(f),c=f=>{const p={};switch(f){case"decorator":for(const m in this.singleton.decorator)p[s(n,m)]=this.singleton.decorator[m];this.singleton.decorator=p;break;case"state":for(const m in this.singleton.store)p[s(n,m)]=this.singleton.store[m];this.singleton.store=p;break;case"model":for(const m in this.definitions.type)p[s(n,m)]=this.definitions.type[m];this.definitions.type=p;break;case"error":for(const m in this.definitions.error)p[s(n,m)]=this.definitions.error[m];this.definitions.error=p;break}},u=Array.isArray(r)?r:[r];for(const f of u.some(p=>p==="all")?["decorator","state","model","error"]:u)c(f);return this}prefix(t,r){return this.affix("prefix",t,r)}suffix(t,r){return this.affix("suffix",t,r)}compile(){var t,r;return this["~adapter"].isWebStandard?(this.fetch=this.config.aot?ao(this):Xc(this),typeof((t=this.server)==null?void 0:t.reload)=="function"&&this.server.reload({...this.server||{},fetch:this.fetch}),this):(typeof((r=this.server)==null?void 0:r.reload)=="function"&&this.server.reload(this.server||{}),this._handle=ao(this),this)}get modules(){return this.promisedModules}}const a0={},Vc=new a0("local.db"),vc=new Kt().get("/topics",e=>{const t=e.query.sort;let r="";return t==="hk_percent"&&(r="ORDER BY avg_hk_percent DESC"),Vc.prepare(`SELECT * FROM topic_view ${r}`).all()},{query:I.Object({sort:I.Optional(I.String())})}).get("/questions",e=>{const t=e.query.t_id,r=e.query.sort,n=e.query.year;let i,o="year, q_num",s=[];r==="hk_percent"&&(o="hk_percent DESC"),t&&s.push(`mc_topic_questions.t_id = ${t}`),n&&s.push(`mc_questions.year = ${n}`);let c="";return s.length>0&&(c=`WHERE ${s.join(" AND ")}`),i=Vc.query(`
      SELECT mc_questions.*, mc_topic_questions.t_id as t_id
      FROM mc_questions
      LEFT JOIN mc_topic_questions ON mc_questions.q_id = mc_topic_questions.q_id
      ${c}
      ORDER BY ${o}
    `).all(),i},{query:I.Object({t_id:I.Optional(I.String()),sort:I.Optional(I.String()),year:I.Optional(I.String())})}).listen(3e3);var ef,tf;console.log(` Elysia is running at ${(ef=vc.server)==null?void 0:ef.hostname}:${(tf=vc.server)==null?void 0:tf.port}`);
